function startplay(id){with(document)if(ns){var n=getElementById(id);n&&(n.style[styleProperty]=activateState)}else{var theItem=all.item(id);theItem&&eval("theItem.style."+styleProperty+" = '"+activateState+"'")}}function endplay(id){with(document)if(ns){var n=getElementById(id);n&&(n.style[styleProperty]=inactivateState)}else{var theItem=all.item(id);theItem&&eval("theItem.style."+styleProperty+" = '"+inactivateState+"'")}}function getplayer(a){var b=document.getElementById(a);return b}function boutonStop(){getplayer("player").pause()}function playFrom(a){var b=document.getElementById("karaoke");if(b&&b.checked){for(var c=0;c<idlist.length&&idlist[c]!=a;)c++;var d=timelist_starts[c]/1e3,e=getplayer("player");e&&(e.addEventListener("seeked",function(){e.play()},!0),setposition(a,d),e.addEventListener("timeupdate",timeUpdate,!0))}else playOne(a)}function playOne(a){for(var b=0;b<idlist.length&&idlist[b]!=a;)b++;var c=timelist_starts[b]/1e3,d=getplayer("player");d&&(d.addEventListener("seeked",function(){d.play()},!0),setposition(a,c),d.addEventListener("timeupdate",timeUpdate,!0),duration=timelist_ends[b]-timelist_starts[b],setTimeout(function(){d.pause()},duration))}function playFrom_W(a){for(var b=0;b<idlist.length&&idlist[b]!=a;)b++;var c=timelist_starts[b]/1e3,d=getplayer("player");d&&(d.addEventListener("seeked",function(){d.play()},!0),setposition(a,c),d.addEventListener("timeupdate",timeUpdate,!0),duration=timelist_ends[b]-timelist_starts[b],setTimeout(function(){d.pause()},duration),d.currentTime>=timelist_ends[b]&&getplayer("player").pause())}function placement(a,b){var a=getplayer("player");a.currentTime=b,a.play(),dohighlight(a.currentTime)}function timeUpdate(){var a=getplayer("player");dohighlight(a.currentTime)}function setposition(a,b){var c=getplayer("player");c.currentTime=b,dohighlight(b)}function dohighlight(a){a*=1e3;for(var b=0;b<timelist_starts.length;b++){var c=$(".eastlingShape#"+idlist[b]).parent().find(".segmentInfo");if(timelist_starts[b]<a){if(timelist_ends[b]>a){c.css("background-color",highlight_color),$(document).scrollTop(c.position().top),currentSentenceId!=b&&(currentSentenceId=b,console.log(b));break}c.css("background-color","")}}var d=idlist[currentSentenceId];$.each(timewordlist_starts2[d],function(b){if(this<a&&timewordlist_ends2[d][b]>a){var c=$("#"+idwordlist2[d][b]);return c.mouseover(),!1}$("#"+idwordlist2[d][b]).mouseout()})}function word_highlight(a,b,c,d){b?(a.css("border-style","solid"),a.css("border-width",c+"px"),a.css("border-color","#"+d)):(a.css("border-style","none"),a.css("border-width","0px"))}function sortJSON(a,b,c){a=a.sort(function(a,d){return c?a[b]>d[b]?1:a[b]<d[b]?-1:0:d[b]>a[b]?1:d[b]<a[b]?-1:0})}function bindAutocomplete(){$(".autocomplete.isolangue").each(function(){$(this);$(this).next(".results_autocomplete").remove();var a=$("<div></div>");a.addClass("results_autocomplete"),a.css("position","absolute"),a.css("left","0"),a.css("-webkit-transform-origin","center top"),a.css("-ms-transform-origin","center top"),a.css("transform-origin","center top"),a.css("background","#fff"),a.css("z-index","998"),a.css("border-radius",".30rem"),a.css("border","1px solid #d4d4d5"),$(this).after(a),$(this).on("keyup",function(){var a=$(this),b=a.val(),c=$(this).attr("acin");return $(this).next(".results_autocomplete").empty().show(),!(b.length<3)&&void $.post("getLanguageFromISO",{YII_CSRF_TOKEN:token,search:b,in:c},function(b){var c=$.parseJSON(b);$.each(c,function(){a.next(".results_autocomplete").append('<a class="result"><div class="">'+this.langue+" / "+this.codeISO+"</div></a>")}),$(".results_autocomplete .result").on("click",function(){var a=$(this).parent().parent().find("input"),b=a.attr("id"),c=a.attr("actarget"),d=a.attr("acin"),e=$(this).text(),f=e.split(" / ")[0],g=e.split(" / ")[1];if(c===b?a.val(g):"Id"===d?(a.val(g),a.parent().parent().find("#"+c).val(f)):(a.val(f),a.parent().parent().find("#"+c).val(g)),$(this).parent().empty().hide(),$.inArray(a.attr("id"),["codelangue_1","subject_1"])){var h=new Date;$("#identifier-doc").html("crdo-"+$("#codelangue_1").val().toUpperCase()+"_"+$("#user").val()+"_"+h.getTime().toString())}})})})})}function preview(a,b){selected_areas=o_imgAreaSelect.getSelections()}function notifier(a,b,c){c=c||"#annotations";var d="yellow";switch(b){case"success":d="green";break;case"error":d="red";break;default:d="yellow"}var e='<div class="ui '+d+' message">'+a+"</div>";$("#notification").popup({position:"top left",target:c,transition:"fade up",html:e,onShow:function(){setTimeout(function(){$("#notification").popup("hide")},3e3)}}),$("#notification").popup("show"),$(".ui.popup").bind("click",function(){$(this).remove()})}function Annotation2Json(a){var b=($('#annotations .title[id-selection="'+a+'"]'),$('#annotations .content[id-selection="'+a+'"]')),c=b.children(".recording").find(".audio.start").val(),d=b.children(".recording").find(".audio.end").val(),e=new Array;b.find(">.image > .input > .input.image > div").each(function(){var a=$(this).attr("image"),b=parseInt($(this).attr("x1")),c=parseInt($(this).attr("y1")),d=parseInt($(this).attr("h")),f=parseInt($(this).attr("w"));e.push({image:a,x1:b,y1:c,x2:b+f,y2:c+d,w:f,h:d})});var f=[],g=[];b.children(".transcriptions").children(".input").each(function(){var a=$(this).find(".transcription input").val(),b=$(this).find(".selection > .menu> .item.active").attr("data-value");f.push({lang:b,transcription:a})}),b.children(".traductions").children(".input").each(function(){var a=$(this).find(".traduction input").val(),b=$(this).find(".traduction-lang input").val();g.push({lang:b,traduction:a})});var h=$('.title[id-selection="'+a+'"]').attr("typeannotation");return result={id:a,typeselection:h,startPosition:c,endPosition:d,areas:e,transcriptions:f,traductions:g},$.each(o_Currentdocument.annotations.sentences,function(){"sentence"==h?a==this.id&&(this.startPosition=c,this.endPosition=d,this.areas=e,this.transcriptions=f,this.traductions=g):$.each(this.children,function(){a==this.id&&(this.startPosition=c,this.endPosition=d,this.areas=e,this.transcriptions=f,this.traductions=g)})}),result}function createMetadataInput(a,b,c){var d=$('<div class="metadata '+a+'"></div>');d.append('<h5 class="ui header">'+a+"</h5>");var e=$('<input disabled type="text">');e.attr("value",b),e.attr("text",b),d.append(e),d.append('<div class="edit-metadata ui icon button"><i class="green pencil icon"></i></div>'),c.append(d)}function displayMetadata(a,b,c,d){var e=$("<div></div>"),f=$("<div>Titre</div>");f.addClass("title"),f.append('<i class="dropdown icon"></i>');var g=$("<div></div>");g.addClass("content"),g.css("background-color","rgba(0,0,0,0.1)");var h=$('<div class="ui form"></div>'),i=$('<div class="inline fields"></div>'),j=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');j.val(a.title.title);var k=$('<div class="field"></div>'),l=$('<input size="3" id="metadata-title-lang" class="metadata-title" type="text" name="metadata-title-lang"/>');l.val(a.title.lang);var m=$('<div class="field"></div>');k.append(j),m.append(l),i.append(k).append(m),h.append(i),g.append(h),e.append(f),e.append(g),e.addClass("ui accordion"),e.accordion({exclusive:!1}),b.append(e);var e=$("<div></div>"),f=$("<div>Titres alternatifs</div>");f.addClass("title"),f.append('<i class="dropdown icon"></i>');var g=$("<div></div>");g.addClass("content"),g.css("background-color","rgba(0,0,0,0.1)");var h=$('<div class="ui form"></div>');$.each(a.alternatives,function(){var a=$('<div class="inline fields"></div>'),b=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');b.val(this.alternative);var c=$('<div class="field"></div>'),d=$('<input size="3" id="metadata-title-lang" class="metadata-title" type="text" name="metadata-title-lang"/>');d.val(this.lang);var e=$('<div class="field"></div>');c.append(b),e.append(d),a.append(c).append(e),h.append(a),g.append(h)}),e.append(f),e.append(g),e.addClass("ui accordion"),e.accordion({exclusive:!1}),b.append(e);var e=$("<div></div>"),f=$("<div>Objets</div>");f.addClass("title"),f.append('<i class="dropdown icon"></i>');var g=$("<div></div>");g.addClass("content"),g.css("background-color","rgba(0,0,0,0.1)");var h=$('<div class="ui form"></div>');$.each(a.subject,function(){var a=$('<div class="inline fields"></div>'),b=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');b.val(this.subject);var c=$('<div class="field"></div>'),d=$('<input size="3" id="metadata-title-lang" class="metadata-title" type="text" name="metadata-title-lang"/>');d.val(this.codelang);var e=$('<div class="field"></div>');c.append(b),e.append(d),a.append(c).append(e),h.append(a),g.append(h)}),e.append(f),e.append(g),e.addClass("ui accordion"),e.accordion({exclusive:!1}),b.append(e);var e=$("<div></div>"),f=$("<div>Langues</div>");f.addClass("title"),f.append('<i class="dropdown icon"></i>');var g=$("<div></div>");g.addClass("content"),g.css("background-color","rgba(0,0,0,0.1)");var h=$('<div class="ui form"></div>');$.each(a.languages,function(){var a=$('<div class="inline fields"></div>'),b=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');b.val(this);var c=$('<div class="field"></div>');c.append(b),a.append(c),h.append(a),g.append(h)}),e.append(f),e.append(g),e.addClass("ui accordion"),e.accordion({exclusive:!1}),b.append(e);var e=$("<div></div>"),f=$("<div>Géographie</div>");f.addClass("title"),f.append('<i class="dropdown icon"></i>');var g=$("<div></div>");g.addClass("content"),g.css("background-color","rgba(0,0,0,0.1)");var h=$('<div class="ui form"></div>'),i=$('<div class="inline fields"></div>'),j=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');j.val(a.spatial.countrycode);var k=$('<div class="field"></div>');k.append(j),i.append(k),h.append(i);var i=$('<div class="inline fields"></div>'),j=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');j.val(a.spatial.geo.east);var k=$('<div class="field"></div>');k.append(j),i.append(k),h.append(i);var i=$('<div class="inline fields"></div>'),j=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');j.val(a.spatial.geo.north);var k=$('<div class="field"></div>');k.append(j),i.append(k),h.append(i);var i=$('<div class="inline fields"></div>'),j=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');j.val(a.spatial.lang);var k=$('<div class="field"></div>');k.append(j),i.append(k),h.append(i);var i=$('<div class="inline fields"></div>'),j=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');j.val(a.spatial.place);var k=$('<div class="field"></div>');k.append(j),i.append(k),h.append(i);var e=$("<div></div>"),f=$("<div>Contributeurs</div>");f.addClass("title"),f.append('<i class="dropdown icon"></i>');var g=$("<div></div>");g.addClass("content"),g.css("background-color","rgba(0,0,0,0.1)");var h=$('<div class="ui form"></div>');$.each(a.contributors,function(){var a=$('<div class="inline fields"></div>'),b=$('<input size="40" id="metadata-title" class="metadata-title" type="text" name="metadata-title"/>');b.val(this.contributor);var c=$('<div class="field"></div>');c.append(b),a.append(c),h.append(a),g.append(h)}),e.append(f),e.append(g),e.addClass("ui accordion"),e.accordion({exclusive:!1}),b.append(e),g.append(h),e.append(f),e.append(g),e.addClass("ui accordion"),e.accordion({exclusive:!1}),b.append(e)}function displayAnnotation(a,b,c,d,e,f){var g=$("<div></div>"),h=$("<div></div>");h.addClass("title"),h.attr("id-selection",a.id),h.attr("typeannotation",e),h.attr("idparent",f),a.hasOwnProperty("areas")&&a.areas[0]&&(h.attr("x1",a.areas[0].x1),h.attr("y1",a.areas[0].y1),h.attr("w",a.areas[0].w),h.attr("h",a.areas[0].h),h.attr("image",a.areas[0].image)),h.append('<i class="dropdown icon"></i>');var i=a.transcriptions[0].transcription;$.each(a.transcriptions,function(){"phono"===this.lang&&(i=this.transcription)}),h.append(i);var j=$("<div></div>");j.append('<i class="delete-selection ui red trash icon"></i>'),j.addClass("content"),j.attr("id-selection",a.id),j.attr("startposition",a.startPosition),j.attr("endposition",a.endPosition),j.css("background-color","rgba(0,0,0,0.1)");var k=$("<div></div>");k.addClass("recording"),k.append('<h5 class="ui header">Audio position</h5>');var l=$('<div class="play-selection ui icon button"><i class="dark icon play"></i></div>'),m=$('<div class="line input"></div>'),n=$('<div class="ui input audio"></div>');n.append('Start : <input class="audio start" disabled type="text" value="'+a.startPosition+'" text="'+a.startPosition+'">'),n.append('End : <input class="audio end" disabled type="text" value="'+a.endPosition+'" text="'+a.endPosition+'">'),m.append(n),m.append(l),m.append('<div class="edit-audio ui icon button"><i class="green pencil icon"></i></div>'),m.append('<div class="delete-audio ui icon button"><i class="red trash icon"></i></div>'),m.appendTo(k),k.appendTo(j),j.append('<div class="ui divider"></div>');var o=$("<div></div>");o.addClass("image"),o.append('<h5 class="ui header">Image position</h5>');var m=$('<div class="line input"></div>'),p=$('<div class="ui input image"></div>');a.hasOwnProperty("areas")&&a.areas[0]&&$.each(a.areas,function(){var a=this,b=$("<img>"),c=$("<div>"),d=window.location.href.split("index.php")[0]+"documents/"+user+"/"+o_Currentdocument.id+"/",e="";$.each(images,function(){image_str=this.file.toString(),this.id==a.image&&(e=image_str)}),b.attr("src",d+e),b.attr("width",a.w),b.attr("height",a.h),c.css("display","block"),c.css("position","relative"),c.css("padding","0px"),c.css("width",a.w),c.css("height",a.h),c.css("background-image","url("+d+e+")"),c.css("background-position-x",0-a.x1),c.css("background-position-y",0-a.y1);var f=$("<a>View Image on screen</a>");f.attr("href","#"),a?(c.attr("x1",a.x1),c.attr("y1",a.y1),c.attr("w",a.w),c.attr("h",a.h),c.attr("image",a.image)):(c.attr("x1",0),c.attr("y1",0),c.attr("w",0),c.attr("h",0),c.attr("image","")),p.append(c)}),m.append(p),m.append('<div class="edit-image ui icon button"><i class="green pencil icon"></i></div>'),m.append('<div class="delete-image ui icon button"><i class="red trash icon"></i></div>'),m.appendTo(o),o.appendTo(j),j.append('<div class="ui divider"></div>');var q=$("<div></div>");q.addClass("transcriptions"),q.append('<h5 class="ui header">Transcriptions</h5>');var r=!0;$.each(a.transcriptions,function(){var a=$("<div></div>");a.addClass("line input");var b=$("<div></div>");b.addClass("ui input transcription"),b.append('<input disabled lang="'+this.lang+'" type="text" value="'+this.transcription+'" text="'+this.transcription+'">');var c=$("<div></div>");c.addClass("ui input transcription-lang"),c.append('<input disabled type="text" value="'+this.lang+'" maxlength=10 size=2>');var d=$('<div class="ui selection dropdown disabled"></div>');d.append('<input type="hidden" name="transcription-lang">');var e=$('<div class="text">Transcription<i class="dropdown icon"></i></div>'),f=$('<div class="menu"></div>');f.append('<div class="item" data-value="phono">Phonologique</div>'),f.append('<div class="item" data-value="phone">Phonétique</div>'),f.append('<div class="item" data-value="ortho">Orthographique</div>'),f.append('<div class="item" data-value="transliter">Translittération</div>'),d.append(e).append(f),a.append(b).append(d),a.append('<div class="edit-annotation edit-transcription ui icon button"><i class="green pencil icon"></i></div>'),r||a.append('<div class="delete-annotation delete-transcription ui icon button"><i class="red trash icon"></i></div>'),a.appendTo(q),r=!1,d.dropdown("set selected",this.lang),d.dropdown("destroy")}),q.append('<br><div class="add-transcription ui icon tiny button"><i class="blue plus icon"></i></div>'),q.appendTo(j),j.append('<div class="ui divider"></div>');var s=$("<div></div>");s.addClass("traductions"),s.append('<h5 class="ui header">'+messages("Traductions")+"</h5>");var r=!0;if($.each(a.traductions,function(){var b=$("<div></div>");b.addClass("line input");var c=$("<div></div>");c.addClass("ui input traduction"),c.append('<input disabled lang="'+this.lang+'" type="text" value="'+this.traduction+'" text="'+this.traduction+'">');var d=$("<div></div>");d.addClass("ui input traduction-lang"),d.append('<input id="traduction-lang_'+a.id+'" class="autocomplete isolangue" actarget="traduction-lang_'+a.id+'" acin="Id" disabled type="text" value="'+this.lang+'" maxlength=3 size=2>'),b.append(c).append(d),b.append('<div class="edit-annotation edit-traduction ui icon button"><i class="green pencil icon"></i></div>'),r||b.append('<div class="delete-annotation delete-traduction ui icon button"><i class="red trash icon"></i></div>'),b.appendTo(s),r=!1}),s.append('<br><div class="add-traduction ui icon tiny button"><i class="blue plus icon"></i></div>'),s.appendTo(j),0==f){j.append('<div class="ui divider"></div>');var t=$("<div></div>");t.addClass("words").addClass("segment sortable"),t.append('<h5 class="ui header">'+messages("Mots")+"</h5>"),$.each(a.children,function(){displayAnnotation(this,t,"rgba(255, 0, 0, 0.2)","dotted","word",a.id)}),t.appendTo(j),t.append('<div class="add-word ui icon tiny button"><i class="blue plus icon"></i></div>')}$(".sortable").sortable({stop:function(a,b){var c=b.item[0].firstChild.attributes.typeannotation.nodeValue,d=b.item[0].firstChild.attributes.idparent.nodeValue,e=[];if("sentence"==c){$('#annotations-sentences [typeannotation="sentence"]').each(function(){e.push($(this).attr("id-selection"))});var f=[];$.each(e,function(){var a=this;$.each(o_Currentdocument.annotations.sentences,function(){this.id==a&&f.push(this)})}),o_Currentdocument.annotations.sentences=f}else if("word"==c){$('#annotations-sentences [id-selection="'+d+'"] [typeannotation="word"]').each(function(){e.push($(this).attr("id-selection"))});var f=[];$.each(o_Currentdocument.annotations.sentences,function(){var a=this;a.id==d&&($.each(e,function(){var b=this;$.each(a.children,function(){this.id==b&&f.push(this)})}),this.children=f)})}$.ajax({url:"sortAnnotations",data:{YII_CSRF_TOKEN:token,user:user,iddoc:o_Currentdocument.id,idparent:d,sortedIds:e},type:"POST",success:function(a){},error:function(){}})}}),$(".sortable").disableSelection(),g.append(h),g.append(j),g.addClass("ui accordion"),g.accordion({exclusive:!1,callback:function(){var a=$('<i class="red trash icon"></i>'),b=$('<div class="delete-selection ui icon"></div>');h.append(a),b.append(a)}}),b.append(g);var u=parseInt($("body").css("font-size")),v=0,w=0,x=0,y=0,z="";a.areas&&a.areas.length>0&&(v=parseInt(a.areas[0].x1)+u,w=parseInt(a.areas[0].y1)+u,x=parseInt(a.areas[0].w),y=parseInt(a.areas[0].h),z=a.areas[0].image);var A=$('<div id="maskSelection_'+a.id+'" style="cursor:pointer;float: left; position: absolute; display: block; border-style: '+d+"; border-width: 1px; background-color: "+c+';"></div>');A.css("left",v),A.css("top",w),A.css("width",x),A.css("height",y),A.css("display","none"),$("img[id='"+z+"']").before(A)}function checkMissingAnnotations(){$("#annotations-sentences .title i.icon.red").remove(),$(".words .content .input input.audio.end").each(function(){var a=$(this).parent().parent().parent().parent().prev();0==$(this).val()&&a.text().indexOf("(")===-1&&a.text().indexOf(")")===-1&&(a.addClass("ui message warning"),a.append('<i class="icon red music"></i>'))}),$(".words .transcriptions").each(function(){if(0==$(this).find(".line.input").length){var a=$(this).parent().prev();a.text().indexOf("(")===-1&&a.text().indexOf(")")===-1&&(a.addClass("ui message warning"),a.append('<i class="icon red code"></i>'))}}),$("#annotations-sentences .content").each(function(){$(this).find(".icon.red.code").length+$(this).find(".icon.red.music").length>0&&$(this).prev().addClass("ui message warning")})}function generateNewId(a){var b=o_Currentdocument.id.replace("crdo-",""),c=0,d=0,e=0,f=b+"_"+a;return $("#annotations-sentences > div > .title").each(function(){ids=$(this).attr("id-selection").split(b+"_S"),id=parseInt(ids[1]),d=id>d?id:d}),$(".words > div > .title").each(function(){ids=$(this).attr("id-selection").split(b+"_W"),id=parseInt(ids[1]),e=id>e?id:e}),o_Currentdocument.hasOwnProperty("annotations")?(c="S"==a?d:e,digit=c+1,f+=digit):(o_Currentdocument.annotations={},o_Currentdocument.annotations.sentences=[],f+="1"),f}function refreshAnnotations(a){null==a&&(a=o_Currentdocument),$("#annotations-sentences").empty();var b=a.id;displayMetadata(a.metadata,$("#metadata-data"),"rgba(0,0,0,0.2)","dashed"),$.each(a.annotations.sentences,function(){displayAnnotation(this,$("#annotations-sentences"),"rgba(0, 0, 0, 0.2)","dashed","sentence",0)}),$("#annotations-sentences .words .accordion").accordion(),$(".add-word").bind("click",function(){var a=$(this).parent().parent().attr("id-selection"),b=generateNewId("W"),c={id:b,startPosition:0,endPosition:0,areas:[],transcriptions:[{lang:"phono",transcription:" "}],traductions:[{lang:"phono",traduction:" "}],children:[]};$.ajax({url:"createAnnotation",dataType:"json",data:{YII_CSRF_TOKEN:token,user:user,iddoc:o_Currentdocument.id,annotation:c,idparent:a},type:"POST",success:function(b){notifier(messages("Création de l'annotation réussie."),"success"),$.each(o_Currentdocument.annotations.sentences,function(){this.id==a&&(this.children.push(c),refreshAnnotations())}),o_imgAreaSelect.cancelSelections(),$("wave region").remove(),checkMissingAnnotations()},error:function(a,b,c){notifier(messages("Erreur lors de la création de l'annotation (createAnnotation).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}})}),$(".add-transcription,.add-traduction").bind("click",function(){var a=$(this).parent().find(".line.input:last"),c=a.clone();a.after(c),$(this).hide(),c.find("input").each(function(){$(this).val(""),$(this).removeAttr("disabled"),$(this).parent().hasClass("dropdown")&&$(this).parent().dropdown()}),c.find(".button.edit-annotation").addClass("save-edit-annotation").find(".pencil").removeClass("pencil").addClass("save"),c.find(".button.edit-annotation").bind("click",function(){var a;a=$(this).hasClass("edit-traduction")?"traduction":"transcription";var c,d,e=$(this).parent().parent().parent().attr("id-selection"),f=$(this).parent().find(".input:nth-of-type(1) input");f.val();$(this).parent().find(".ui.dropdown").length>0?d=$(this).parent().find(".ui.dropdown").dropdown("get value"):(c=$(this).parent().find(".input:nth-of-type(2) input"),d=c.val()),newvalues=Annotation2Json(e),$.ajax({url:"updateAnnotation",data:{YII_CSRF_TOKEN:token,iddoc:b,user:user,json:newvalues},type:"POST",success:function(a){notifier(messages("Mise à jour de l'annotation réussie."),"success"),$("wave region").remove(),checkMissingAnnotations()},error:function(a,b,c){notifier(messages("Erreur lors de la mise à jour de l'annotation (updateAnnotation).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}}),$(this).removeClass("save-edit-annotation"),$(this).find(".save").removeClass("save").addClass("pencil"),$(this).after('<div class="delete-annotation delete-transcription ui icon button"><i class="red trash icon"></i></div>'),f.attr("disabled","disabled"),c.attr("disabled","disabled"),$(".delete-annotation").bind("click",function(){$(".basic.modal").find(".header").html("Supprimer"),$(".basic.modal").find(".content .right").html("Supprimer l'annotation ?");var a,c=$(this).parent();a=$(this).hasClass("delete-traduction")?"traduction":"transcription";var d=c.parent().parent().attr("id-selection"),e=$(this).parent().find(".input:nth-of-type(1) input"),f=e.val(),g=e.attr("lang");$(".basic.modal").modal("setting",{closable:!1,onDeny:function(){},onApprove:function(){$.ajax({url:"delAnnotation",data:{YII_CSRF_TOKEN:token,iddoc:o_Currentdocument.id,user:user,typeannotation:a,idannotation:d,text:f,lang:g},type:"POST",success:function(a){notifier(messages("Suppression de l'annotation réussie."),"success"),c.remove(),refreshContent(b)},error:function(a,b,c){notifier(messages("Erreur lors de la suppression de l'annotation (delAnnotation).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}})}}).modal("show")})}),$(this).show()}),$(".delete-annotation").bind("click",function(){$(".basic.modal").find(".header").html("Supprimer"),$(".basic.modal").find(".content .right").html("Supprimer l'annotation ?");var a,c=$(this).parent();a=$(this).hasClass("delete-traduction")?"traduction":"transcription";var d=c.parent().parent().attr("id-selection"),e=$(this).parent().find(".input:nth-of-type(1) input"),f=e.val(),g=e.attr("lang");$(".basic.modal").modal("setting",{closable:!1,onDeny:function(){},onApprove:function(){$.ajax({url:"delAnnotation",data:{YII_CSRF_TOKEN:token,document:b,directory:user,typeannotation:a,idannotation:d,text:f,lang:g},type:"POST",success:function(a){notifier(messages("Suppression de l'annotation réussie."),"success"),c.remove(),refreshContent(b)},error:function(a,b,c){notifier(messages("Erreur lors de la suppression de l'annotation (delAnnotation).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}})}}).modal("show")}),$(".button.edit-annotation").bind("click",function(){var a;a=$(this).hasClass("edit-traduction")?"traduction":"transcription";var c,d=$(this).parent().parent().parent().attr("id-selection"),e=$(this).parent().find(".input:nth-of-type(1) input"),f=(e.val(),$(this).parent().find(".input:nth-of-type(2) input"));c=$(this).parent().find(".ui.dropdown").length>0?$(this).parent().find(".ui.dropdown").dropdown("get value"):f.val();e.attr("text"),e.attr("lang");$(this).hasClass("save-edit-annotation")?(newvalues=Annotation2Json(d),$.ajax({url:"updateAnnotation",data:{YII_CSRF_TOKEN:token,iddoc:b,user:user,json:newvalues},type:"POST",success:function(b){notifier(messages("Mise à jour de l'annotation réussie."),"success"),$("wave region").remove(),"transcription"==a&&refreshAnnotations(),checkMissingAnnotations()},error:function(a,b,c){notifier(messages("Erreur lors de la mise à jour de l'annotation (updateAnnotation).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}}),$(this).removeClass("save-edit-annotation"),$(this).find(".save").removeClass("save").addClass("pencil"),e.attr("disabled","disabled"),f.attr("disabled","disabled"),$(this).parent().find(".ui.dropdown").dropdown("destroy"),$(this).next(".cancel-edition").remove()):($(this).addClass("save-edit-annotation"),$(this).find(".pencil").removeClass("pencil").addClass("save"),e.removeAttr("disabled"),f.removeAttr("disabled"),$(this).parent().find(".ui.dropdown").dropdown(),$(this).after('<div class="button cancel-edition ui icon"><i class="blue icon undo"></i></div>'),$(".button.cancel-edition").bind("click",function(){$(this).parent().find(".save").removeClass("save").addClass("pencil"),$(this).parent().find(".save-edit-annotation").removeClass("save-edit-annotation"),e.attr("disabled","disabled"),f.attr("disabled","disabled"),$(this).parent().find(".ui.dropdown").dropdown("destroy"),$(this).remove()}))}),$(".button.edit-audio").bind("click",function(){var a=$(this).parent().parent().parent().attr("id-selection"),c=$('.title[id-selection="'+a+'"]').attr("typeannotation"),d=$(this).parent().find(".input.audio > .start"),e=(d.val(),$(this).parent().find(".input.audio > .end"));e.val();$(this).hasClass("save-edit-annotation")?(newvalues=Annotation2Json(a),$.ajax({url:"updateAnnotation",data:{YII_CSRF_TOKEN:token,iddoc:b,user:user,json:newvalues},type:"POST",success:function(a){notifier(messages("Mise à jour de l'annotation réussie."),"success"),$("wave region").remove(),checkMissingAnnotations()},error:function(a,b,c){notifier(messages("Erreur lors de la mise à jour de l'annotation (updateAnnotation).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}}),$(this).removeClass("save-edit-annotation"),$(this).find(".save").removeClass("save").addClass("pencil"),d.attr("disabled","disabled"),e.attr("disabled","disabled"),$(this).next(".cancel-edition").remove()):($(".edit-audio.save-edit-annotation").removeClass("save-edit-annotation").find(".save").removeClass("save").addClass("pencil"),$(this).addClass("save-edit-annotation"),$(this).find(".pencil").removeClass("pencil").addClass("save"),d.removeAttr("disabled"),e.removeAttr("disabled"),(0===parseFloat(d)&&0===parseFloat(e)||""===d&&""===e)&&(d.val($("#startPosition").val()),e.val($("#endPosition").val())),$(this).after('<div class="button cancel-edition ui icon"><i class="blue icon undo"></i></div>'),$(".button.cancel-edition").bind("click",function(){$(this).parent().find(".save").removeClass("save").addClass("pencil"),$(this).parent().find(".save-edit-annotation").removeClass("save-edit-annotation"),$.each(o_Currentdocument.annotations.sentences,function(){"sentence"==c?this.id==a&&(d.val(this.startPosition),e.val(this.endPosition)):$.each(this.children,function(){this.id==a&&(d.val(this.startPosition),e.val(this.endPosition))})}),d.attr("disabled","disabled"),e.attr("disabled","disabled"),$(this).remove()}))}),$(".button.edit-image").bind("click",function(){var a,c=this;0!=$(this).parent().find(".input.image > div").length?a=$(this).parent().find(".input.image > div"):(a=$("<div></div>"),a.css("display","block"),a.css("position","relative"),a.css("padding","0px"),$(this).parent().find(".input.image").append(a));var d=$(this).parent().parent().parent().attr("id-selection"),e=new Array,f=$('[id-selection="'+d+'"]:first');$.each(o_imgAreaSelect.getSelections(),function(){e.push({image:$(".images-tab a.item.active").attr("image"),area:this})}),$(this).hasClass("save-edit-annotation")?(e.length>0&&($(this).parent().find(".input.image > div").remove(),$.each(e,function(){var a,b=this.area.x1,d=this.area.y1,e=this.area.x2,f=this.area.y2,g=e-b,h=f-d,i=isNaN(parseInt($(".ui.tab.segment.active").css("padding-top")))?0:parseInt($(".ui.tab.segment.active").css("padding-top")),j=b+i,k=d+i;a=$("<div></div>"),a.css("display","block"),a.css("position","relative"),a.css("padding","0px"),$(c).parent().find(".input.image").append(a),a.css("background-image","url("+$(".images-tab .tab.active img").attr("src")+")"),a.attr("x1",j),a.attr("y1",k),a.attr("h",h),a.attr("w",g),a.attr("image",this.image),a.css("background-position-x","-"+j+"px"),a.css("background-position-y","-"+k+"px"),a.css("width",g),a.css("height",h)}),f.attr("x1",e[0].x1),f.attr("y1",e[0].y1),f.attr("h",e[0].h),f.attr("w",e[0].w),f.attr("image",e[0].image),newvalues=Annotation2Json(d),$.ajax({url:"updateAnnotation",data:{YII_CSRF_TOKEN:token,iddoc:b,user:user,json:newvalues},type:"POST",success:function(a){notifier(messages("Mise à jour de l'annotation réussie."),"success"),$("wave region").remove(),checkMissingAnnotations(),o_imgAreaSelect.cancelSelections()},error:function(a,b,c){notifier(messages("Erreur lors de la mise à jour de l'annotation (updateAnnotation).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}}),$(this).removeClass("save-edit-annotation"),$(this).find(".save").removeClass("save").addClass("pencil")),$(this).parent().find(".cancel-edition").click()):($(".edit-image.save-edit-annotation").removeClass("save-edit-annotation").find(".save").removeClass("save").addClass("pencil"),$(this).addClass("save-edit-annotation"),$(this).find(".pencil").removeClass("pencil").addClass("save"),$(this).after('<div class="button cancel-edition ui icon"><i class="blue icon undo"></i></div>'),$(".button.cancel-edition").bind("click",function(){$(this).parent().find(".save").removeClass("save").addClass("pencil"),$(this).parent().find(".save-edit-annotation").removeClass("save-edit-annotation"),$(this).remove()}));
}),$('[id^="annotations-"] .title').bind("mouseover",function(){var a=isNaN(parseInt($(".ui.tab.segment.active").css("padding-top")))?0:parseInt($(".ui.tab.segment.active").css("padding-top")),b=parseInt($(this).attr("x1"))+a,c=parseInt($(this).attr("y1"))+a,d=parseInt($(this).attr("w")),e=parseInt($(this).attr("h")),f=$(this).attr("image");$(".images-tab .item.active").attr("image")==f&&($("div#maskCurrentSelection").css("left",b),$("div#maskCurrentSelection").css("top",c),$("div#maskCurrentSelection").css("width",d),$("div#maskCurrentSelection").css("height",e),$("div#maskCurrentSelection").css("display","block"))}),$('[id^="annotations-"] .input.image a').bind("mouseover",function(){var a=isNaN(parseInt($(".ui.tab.segment.active").css("padding-top")))?0:parseInt($(".ui.tab.segment.active").css("padding-top")),b=parseInt($(this).attr("x1"))+a,c=parseInt($(this).attr("y1"))+a,d=parseInt($(this).attr("w")),e=parseInt($(this).attr("h")),f=$(this).attr("image");$(".images-tab .item.active").attr("image")==f&&($("div#maskCurrentSelection").css("left",b),$("div#maskCurrentSelection").css("top",c),$("div#maskCurrentSelection").css("width",d),$("div#maskCurrentSelection").css("height",e),$("div#maskCurrentSelection").css("display","block"))}),$('[id^="annotations-"] .title').bind("mouseout",function(){$("div#maskCurrentSelection").css("display","none")}),$('[id^="annotations-"] .input.image a').bind("mouseout",function(){$("div#maskCurrentSelection").css("display","none")}),$(".play-selection").bind("click",function(){if($(this).hasClass("stop"))$(this).removeClass("stop"),$(this).find("i").removeClass("stop").addClass("play"),wavesurfer.pause();else{$(this).addClass("stop"),$(this).find("i").removeClass("play").addClass("stop");var a=parseFloat($(this).parent().find("input.audio.start").val()),b=parseFloat($(this).parent().find("input.audio.end").val());wavesurfer.play(a,b)}}),$(".delete-selection").bind("click",function(){var a,b=$(this).parent().attr("id-selection");a=$('.title[id-selection="'+b+'"]').attr("typeannotation"),$(".basic.modal").find(".header").html(messages("Supprimer")),$(".basic.modal").find(".content .right").html(messages("Supprimer la sélection ?")),$(".basic.modal").modal("setting",{closable:!1,onDeny:function(){},onApprove:function(){$.ajax({url:"deleteSelection",data:{YII_CSRF_TOKEN:token,iddoc:o_Currentdocument.id,user:user,idselection:b,motphrase:a},type:"POST",success:function(c){notifier(messages("Suppression de la sélection réussie."),"success"),$.each(o_Currentdocument.annotations.sentences,function(c){var d=this;"sentence"==a?this.id==b&&(o_Currentdocument.annotations.sentences.splice(c,1),refreshAnnotations(o_Currentdocument)):$.each(d.children,function(a){this.id==b&&(o_Currentdocument.annotations.sentences[c].children.splice(a,1),refreshAnnotations(o_Currentdocument))})})},error:function(a,b,c){notifier(messages("Suppression en erreur.")+" "+messages("Veuillez reporter l'incident à l'équipe informatique."),"error")}})}}).modal("show")}),$("#select-ressources > tbody > tr > td > i.trash").on("click",function(){var a=$(this).parent().parent().attr("id"),c=$(this).parent().parent().attr("type");$("#file-to-delete").html(a),$(".basic.modal").find(".header").html(messages("Supprimer")),$(".basic.modal").find(".content .right").html(messages("Supprimer la ressource ?")),$(".basic.modal").modal("setting",{closable:!1,onDeny:function(){},onApprove:function(){$.ajax({url:"delResource",data:{YII_CSRF_TOKEN:token,iddoc:b,user:user,idresource:a,typeresource:c},type:"POST",success:function(a){localStorage.setItem("step",$("#steps .step:nth(1)").attr("id")),location.reload(),notifier(messages("Suppression de la ressource réussie."),"success")},error:function(a,b,c){notifier(messages("Erreur lors de la suppression de la ressource (delResource).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}})}}).modal("show")}),checkMissingAnnotations()}function refreshContent(a){var b=[];$("#annotations .title.active").each(function(){b.push($(this).attr("id-selection"))}),$.post("getDoc",{YII_CSRF_TOKEN:token,metadata_file:a,directory:user},function(a){o_Currentdocument=$.parseJSON(a),refreshAnnotations(o_Currentdocument),refreshPreview(o_Currentdocument),$.each(b,function(){$('[id-selection="'+this+'"]').show().addClass("active")}),bindAutocomplete()})}function refreshPreview(a){null==a&&(a=o_Currentdocument);var b=window.location.href.split("index.php")[0]+"documents/"+user+"/"+a.id+"/",c=b+a.metadata_file,d=new Array;$.each(o_Currentdocument.resources.images,function(){var a=b+this.file;d.push({id:this.id,url:a})});var e="333333",f=4,g="ffffff",h=0;$(".eastling").parent().children(":not(.eastling,.preview)").remove(),$(".eastling").eastlingplayer({idref:c,local:!0,localDocument:{annotations:a.annotations.sentences,metadata:a.metadata,url_images:d,url_audio:b+a.resources.audio},strokeColor:e,strokeWidth:f,fillColor:g,fillOpacity:h,callback:function(){$(".map").maphilight(),$(".eastling").eastlingShape(),$(".word").bind("mouseover",function(){var a=$(this).attr("link");$("#"+a).mouseover(),word_highlight($(this),!0,f,e)}).bind("mouseout",function(){var a=$(this).attr("link");$("#"+a).mouseout(),word_highlight($(this),!1,"","")}),$("area").bind("mouseover",function(){var a=$(this).attr("id");word_highlight($("[link='"+a+"']"),!0,f,e)}).bind("mouseout",function(){var a=$(this).attr("id");word_highlight($("[link='"+a+"']"),!1,"","")})}})}function getDoc(a){var b=0;$("#loading .loader").html(messages("Chargement du document")),$("#loading").addClass("active"),$(".images-tab").empty(),$("#images-compo > div:not(.images-tab)").remove(),$.post("getDoc",{YII_CSRF_TOKEN:token,metadata_file:a,user:user},function(c){o_Currentdocument=$.parseJSON(c),$("#select-ressources tbody").empty(),$("#selected-doc").html(" : <b>"+o_Currentdocument.metadata.crdos[0].title.title+"</b>&nbsp;<div class='ui icon green button'><i class='icon download disk'></i></div>"),$("#selected-doc .button").bind("click",function(){$.ajax({url:"zipDoc",data:{YII_CSRF_TOKEN:token,metadata_file:$("#select-document > tbody > tr.active").attr("id"),directory:$("#user").val()},type:"POST",dataType:"text",success:function(a){var b=window.location.href.split("index.php")[0]+"documents/"+user+"/"+a,c=document.createElement("a");document.body.appendChild(c),c.href=b,c.download=$("#select-document > tbody > tr.active").attr("id")+".zip",c.click(),notifier(messages("Création de l'archive réussie."),"success")},error:function(a,b,c){notifier(messages("Erreur lors de la création de l'archive (zipDoc).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}})});var d=0,e=baseUrl+"/documents/"+o_Currentdocument.user+"/",f=o_Currentdocument.metadata.crdos[0].spatial[1].spatial.split(";");f[0].split("=")[1],f[1].split("=")[1];if($.each(o_Currentdocument.metadata.crdos,function(){var a="",c=this;if(""===this.type){var f=new Array("jpg","jpeg","png","tiff","pdf","bmp","gif"),g=new Array("mp3","wav","ogg");$.each(this.isFormatOf,function(a,b){var d=this.split("."),e=d[d.length-1].toLowerCase();$.inArray(e,f)>=0&&(c.type="Image"),$.inArray(e,g)>=0&&(c.type="Sound")})}if("Sound"==this.type)a="music",$.each(this.isFormatOf,function(a,b){b.toLowerCase().indexOf("mp3")>=0?file_mp3=b:b.toLowerCase().indexOf("wav")>=0&&(file_wav=b)}),""!=file_mp3?(file_mp3.indexOf("http://")>=0?$("#src-mp3").attr("src",file_mp3):$("#src-mp3").attr("src",e+file_mp3),$("#src-mp3").attr("type","audio/mpeg")):(file_wav.indexOf("http://")>=0?$("#src-wav").attr("src",file_wav):$("#src-wav").attr("src",e+file_wav),$("#src-wav").attr("type","audio/wav"));else if("Image"==this.type){a="photo";var h=this.isFormatOf,i=this.id;$.each(h,function(){var a=this;images.push(a),$.ajax({url:e+a,type:"get",error:function(a,c,d){404===a.status&&(notifier("Fichier image introuvable.","error","tr#"+i),b++,$("tr#"+i).addClass("error"))},success:function(b){d++;var f='<a class="teal item" data-tab="tab_image_'+d+'" image="'+c.id+'">...'+c.id.slice(-12)+"</a>",g='<div class="ui tab segment" style="position:relative;" data-tab="tab_image_'+d+'">';g+='<div id="maskCurrentSelection" style="display:none;float: left;position: absolute;left: 59px;top: 150px;width: 934px;height: 76px;background-color: rgba(110,207,245,0.3);"></div>',g+='<img src="'+e+a+'" id="'+c.id+'" />',g+="</div>",$(".images-tab").append(f),$(".images-tab").after(g)}})})}else if("Text"==this.type){a="file outline";var j=this.identifier,k=this.id;$.ajax({url:e+j,type:"get",error:function(a,c,d){404===a.status&&(notifier("Fichier d'annotation introuvable.","error","tr#"+k),b++,$("tr#"+k).addClass("error"))},success:function(a){}})}var l='<tr id="'+this.id+'">';l+="<td>"+this.id+"</td>",l+="<td>"+this.type+' <i class="icon '+a+'"></i></td>',l+="<td>","Sound"!==this.type.trim()&&"Image"!==this.type.trim()||(l+='<i class="icon red trash"></i>'),l+="</td>",l+="</tr>",$("#select-ressources > tbody").append(l)}),$("#metadata .ui.form").empty(),$("#annotations-sentences").empty(),$("#annotations-words").empty(),$(".imgareaselect-box").remove(),$(".imgareaselect-closebtn").remove(),refreshContent(a),""!==file_mp3)if(file_mp3.indexOf("http://")>=0)wavesurfer.load(file_mp3);else{var e=baseUrl+"/documents/"+o_Currentdocument.user+"/";wavesurfer.load(e+file_mp3)}}).done(function(){$("#loading").removeClass("active")})}function addSelectionToDOM(a){var b="phrase"==a.motphrase?"S":"W",c=o_Currentdocument.id.replace("crdo-",""),d=0,e=0,f=0,g=c+"_"+b;$("#annotations-sentences > div > .title").each(function(){id=parseInt($(this).attr("id-selection").substr(c.length+2)),e=id>e?id:e}),$(".words > div > .title").each(function(){id=parseInt($(this).attr("id-selection").substr(c.length+2)),f=id>f?id:f}),o_Currentdocument.hasOwnProperty("annotations")?(d="S"==b?e:f,digit=d+1,g+=digit):(o_Currentdocument.annotations={},o_Currentdocument.annotations.sentences=[],g+="1");var h=[];if("S"==b){var i=a.transcriptions[0].transcription.split(" ");$.each(i,function(){f++,digit=f+1;var b=c+"_W"+digit;h.push({id:b,startPosition:a.startPosition,endPosition:a.endPosition,areas:[],traductions:[],transcriptions:[{lang:a.transcriptions[0].lang,transcription:this}]})})}var j={id:g,startPosition:a.startPosition,endPosition:a.endPosition,areas:a.selectedAreas,traductions:a.traductions,transcriptions:a.transcriptions,children:h};console.log(j),"S"==b?o_Currentdocument.annotations.sentences.push(j):$.each(o_Currentdocument.annotations.sentences,function(){this.id==a.idParent&&this.children.push(j)}),refreshAnnotations()}function addInfoRessource(a){var b='<tr id="'+a.id+'" type="'+a.type+'">';b+="<td>"+a.id+"</td>",b+="<td>"+a.type+' <i class="icon '+("image"==a.type?"photo":"music")+'"></i></td>',b+="<td>","audio"!==a.type.trim()&&"image"!==a.type.trim()||(b+='<i class="icon red trash"></i>'),b+="</td>",b+="</tr>",$("#select-ressources > tbody").append(b)}function progressCompute(a,b){var c=0,d=0,e=0;return $.each(a,function(e){c+=a[e],d+=b[e]}),e=d/c*100,100==e&&$("#loading").removeClass("active"),e}function getDocument(){var a=baseUrl+"/documents/"+user+"/"+o_Currentdocument.id+"/",b=0,c=0;if(fileids=[],toload=[],loaded=[],$("#annotations-sentences").empty(),$("#metadata-data").empty(),$("#select-ressources > tbody").empty(),$("#images-compo").empty(),wavesurfer.empty(),o_Currentdocument.hasOwnProperty("resources")){if(o_Currentdocument.resources.hasOwnProperty("images")&&o_Currentdocument.resources.images.length>0){c=o_Currentdocument.resources.images.length;var d=$('<div class="images-tab ui pointing secondary menu"></div>');$.each(o_Currentdocument.resources.images,function(){var c=this,e=this.file;images.push({id:this.id,file:this.file}),addInfoRessource({id:this.id,type:"image"}),b++,fileids.push(c.id),toload.push(1e5),loaded.push(0);var f=1==b?"active":"",g=$('<a class="teal '+f+' item" data-tab="tab_image_'+b+'" image="'+c.id+'">...'+c.id.slice(-12)+"</a>"),h=$('<div class="ui tab segment '+f+'" style="position:relative;" data-tab="tab_image_'+b+'"></div>'),i=$('<div id="maskCurrentSelection" style="display:none;float: left;position: absolute;left: 59px;top: 150px;width: 934px;height: 76px;background-color: rgba(110,207,245,0.3);"></div>'),j=$('<img src="'+a+e+'" id="'+c.id+'" />');j.load(function(){c.id==fileids[0]&&(o_imgAreaSelect=$("#images-compo [data-tab=tab_image_1] img").imgAreaSelect({instance:!0,handles:!0,fadeSpeed:200,parent:$("#images-compo"),onSelectEnd:preview})),$(".images-tab .item").bind("click",function(){$(".images-tab .item").removeClass("active");var a=$(this),b=a.attr("data-tab");a.tab("deactivate all").tab("activate tab",b).tab("activate navigation",b);var c=$(this).attr("data-tab");o_imgAreaSelect.cancelSelections(),o_imgAreaSelect.remove(),o_imgAreaSelect=$('#images-compo [data-tab="'+c+'"] img').imgAreaSelect({instance:!0,handles:!0,fadeSpeed:200,parent:$("#images-compo"),onSelectEnd:preview})}),$.each(fileids,function(a){fileids[a]==c.id&&(loaded[a]=1e5)}),$("progress").val(progressCompute(toload,loaded))}),h.append(i).append(j),d.find(".item").length>0?d.find(".item:last").after(g):d.append(g),d.append(h)}),$("#images-compo").append(d)}o_Currentdocument.resources.hasOwnProperty("audio")&&""!==o_Currentdocument.resources.audio&&(c++,fileids.push(o_Currentdocument.resources.audio),toload.push(1e6),loaded.push(0),wavesurfer.load(a+o_Currentdocument.resources.audio),addInfoRessource({id:o_Currentdocument.resources.audio,type:"audio"}))}0==c&&$("#loading").removeClass("active"),o_Currentdocument.hasOwnProperty("annotations")?refreshAnnotations():displayMetadata(o_Currentdocument.metadata,$("#metadata-data"),"rgba(0,0,0,0.2)","dashed")}function refreshDocLang(a){return $("#select-document tbody").empty(),$("#select-langue tbody").empty(),$("#select-ressources tbody").empty(),$("#step0Next").hide(),$("#stepDesc1").addClass("disabled"),$("#stepDesc2").addClass("disabled"),$("#stepDesc3").addClass("disabled"),$.each(documents,function(){var b=new Array;if($.each(this.metadata.subject,function(){b.push(this.codelang)}),$.inArray(a,b)!==-1){var c='<tr id="'+this.id+'">';c+='<td class="ui accordion">',c+='<div class="title">',c+='<i class="dropdown icon"></i>',c+=this.metadata.title.title,c+="</div>",c+='<div class="content ui small message info">',c+="<p>"+messages("fichier")+" : "+this.id+"</p>",$.each(this.metadata.contributors,function(){"speaker"==this.code&&(c+="<p>"+messages("locuteur")+" : "+this.contributor+"</p>")}),this.hasOwnProperty("resources")&&(this.resources.hasOwnProperty("images")&&$.each(this.resources.images,function(){c+="<p>"+messages("ressource")+' : <i class="ui icon photo"></i> '+this.id+"</p>"}),this.resources.hasOwnProperty("audio")&&(c+="<p>"+messages("ressource")+' : <i class="ui icon music"></i> '+this.resources.audio+"</p>")),c+="</div>",c+="</td>",c+="<td>",c+='<a class="ui"><i class="ui red icon trash"></i></a>',c+='<a class="ui action-select-document" idDoc="'+this.id+'"><i class="ui icon check"></i></a>',c+="</td></tr>",$("#select-document > tbody").append(c),$("#select-document tbody .ui.trash").bind("click",function(){var a=$(this).parent().parent().parent().attr("id");$(".basic.modal").find(".header").html(messages("Supprimer")),$(".basic.modal").find(".content .right").html(messages("Supprimer le document ? (les ressources associées seront également supprimées)")),$(".basic.modal").modal("setting",{closable:!1,onDeny:function(){},onApprove:function(){$.ajax({url:"deleteDocument",data:{YII_CSRF_TOKEN:token,iddoc:a,user:user},type:"POST",success:function(a){location.reload(),notifier(messages("Suppression du document réussie."),"success")},error:function(a,b,c){notifier(messages("Erreur lors de la suppression du document (delDoc).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}})}}).modal("show")}),$(".images-doc.menu .item").tab("deactivate all").tab("activate tab","third").tab("activate navigation","third")}}),$(".ui.accordion").accordion(),$(".action-select-document").bind("click",function(){alert(messages("Le document va se charger. Cela peut prendre plusieurs secondes à minutes selon le nombre et la taille des fichiers. Merci de patienter.")),$("#loading").addClass("active"),$("#metadata-data").empty(),$("#newdoc").hide();var a=$(this).attr("idDoc");$("#uploaded-document").val(a),$("#import-iddoc").val(a),$("#select-document > tbody > tr").removeClass("active"),$(this).parent().parent().addClass("active"),localStorage.setItem("document",a),currentDocument=a,$("#step0Next").show(),$("#stepDesc1").removeClass("disabled"),$("#stepDesc2").removeClass("disabled"),$("#stepDesc3").removeClass("disabled"),$.each(documents,function(){this.id==a&&($("#loading .loader").html(messages("Chargement en cours")),o_Currentdocument=this,getDocument())}),$("#selected-doc").html(o_Currentdocument.metadata.title.title+"</b>&nbsp;<div class='ui icon green button'><i class='icon download disk'></i></div>"),$("#selected-doc .button").bind("click",function(){$.ajax({url:"zipDoc",data:{YII_CSRF_TOKEN:token,iddoc:a,user:user},type:"POST",dataType:"text",success:function(b){var c=window.location.href.split("index.php")[0]+"documents/"+user+"/"+a+"/"+b,d=document.createElement("a");document.body.appendChild(d),d.href=c,d.download=$("#select-document > tbody > tr.active").attr("id")+".zip",d.click(),notifier(messages("Création de l'archive réussie."),"success")},error:function(a,b,c){notifier(messages("Erreur lors de la création de l'archive (zipDoc).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}})}),bindAutocomplete(),$("#selected-doc").show()}),$("#identifier-doc").html().length>0&&$("#metadata_"+$("#identifier-doc").html()).click(),!0}function refreshUserDoc(a){var b=!1;return $.post("getListJSON",{YII_CSRF_TOKEN:a,user:user},function(a){documents.length=0,langues_user.length=0,$("#select-document tbody").empty(),$("#select-langue").empty(),$("#select-langue").parent().find("div.text").empty(),$("#selected-doc").empty();var c=jQuery.parseJSON(a);$.each(c,function(a,b){b&&($.each(b.metadata.subject,function(a,b){langues_user.push({codelang:this.codelang,subject:this.subject})}),documents.push(b))}),langues_user=$.unique(langues_user),langues_user.sort(),$.each(langues_user,function(){var a="";this.codelang==currentLangue&&(a=" active"),$("#select-langue").append('<div class="item'+a+'" data-value="'+this.codelang+'">'+this.subject+"</div>")}),$("#select_subject").dropdown("setting","onChange",function(a){currentLangue=a,localStorage.setItem("langue",a),refreshDocLang(a)}),$("#select_subject").dropdown("set selected",currentLangue),$("#select-langue .item.active").click(),$('#select-document tr[id="'+currentDocument+'"]').click(),$("[id='"+localStorage.getItem("step")+"']").click(),$("table").tablesort(),b=!0}).promise()}function getAnnotationsFromUser(a){var b=new Object;b.id=a.attr("id-selection");var c=a.children(".recording"),d=a.children(".image"),e=a.children(".transcriptions"),f=a.children(".traductions"),g=c.find(".audio.start").val(),h=c.find(".audio.end").val();b.startPosition=g,b.endPosition=h;var i=d.find(".image > div").attr("image"),j=parseInt(d.find(".image > div").attr("x1")),k=parseInt(d.find(".image > div").attr("y1")),l=parseInt(d.find(".image > div").attr("w")),m=parseInt(d.find(".image > div").attr("h")),n=j+l,o=k+m;b.areas=new Array,b.areas.push({image:i,x1:j,y1:k,x2:n,y2:o,w:l,h:m});var p=new Array;e.find(".transcription > input").each(function(){p.push({lang:$(this).attr("lang"),transcription:$(this).val()})}),b.transcriptions=p;var q=new Array;return f.find(".traduction > input").each(function(){q.push({lang:$(this).attr("lang"),traduction:$(this).val()})}),b.traductions=q,b}function postJSON(a){$.ajax({url:"storeJSON",data:{YII_CSRF_TOKEN:token,id:a.id,jsonfile:a.jsonfile,user:a.user,content:a.content},type:"POST",success:function(a){},error:function(a,b,c){notifier(messages("Erreur lors de la sauvegarde du document (json).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}})}function postAllJSON(){var a=new Object;a.metadata=new Object,a.annotations=new Object,a.id=currentDocument.split("metadata_")[1].replace(".xml",""),a.user=user,a.annotations.sentences=new Array,$("#annotations #annotations-sentences > div > .content").each(function(){var b=getAnnotationsFromUser($(this));b.children=new Array;var c=$(this).find(".words > div > .content");c.each(function(){var a=getAnnotationsFromUser($(this));b.children.push(a)}),a.annotations.sentences.push(b)}),$.each(a.annotations.sentences,function(){postJSON({id:a.id,jsonfile:this.id,user:user,content:this})}),localStorage.setItem("annotations",JSON.stringify(a))}function getJSON(a,b){$.ajax({url:"getJSON",data:{YII_CSRF_TOKEN:token,user:b,iddoc:a,jsonfile:a},type:"POST",success:function(a){notifier(messages("Document téléchargé."),"success"),o_Currentdocument=JSON.parse(a),getDocument(),bindAutocomplete(),$("#loading").removeClass("active")},error:function(a,b,c){return notifier(messages("Erreur lors du téléchargement du document (json).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error"),!1}})}function transcrire(a,b,c){jQuery.ajax({type:"POST",url:"../fonctions/transcrire",data:{mots:a,transcription_from:b,transcription_to:c},success:function(a,b,c){return a},error:function(a,b,c){return"erreur"}})}!function(a,b,c,d){a.fn.search=function(c,e){var f,g=a(this),h=g.selector||"",i=(new Date).getTime(),j=[],k=arguments[0],l="string"==typeof k,m=[].slice.call(arguments,1);return a(this).each(function(){var n,o=a.extend(!0,{},a.fn.search.settings,e),p=o.className,q=o.selector,r=o.error,s=o.namespace,t="."+s,u=s+"-module",v=a(this),w=v.find(q.prompt),x=v.find(q.searchButton),y=v.find(q.results),z=(v.find(q.result),v.find(q.category),this),A=v.data(u);n={initialize:function(){n.verbose("Initializing module");var a=w[0],b=a.oninput!==d?"input":a.onpropertychange!==d?"propertychange":"keyup";w.on("focus"+t,n.event.focus).on("blur"+t,n.event.blur).on("keydown"+t,n.handleKeyboard),o.automatic&&w.on(b+t,n.search.throttle),x.on("click"+t,n.search.query),y.on("click"+t,q.result,n.results.select),n.instantiate()},instantiate:function(){n.verbose("Storing instance of module",n),A=n,v.data(u,n)},destroy:function(){n.verbose("Destroying instance"),v.removeData(u)},event:{focus:function(){v.addClass(p.focus),n.results.show()},blur:function(){n.search.cancel(),v.removeClass(p.focus),n.results.hide()}},handleKeyboard:function(b){var c,d=v.find(q.result),e=v.find(q.category),f=b.which,g={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},h=p.active,i=d.index(d.filter("."+h)),j=d.size();if(f==g.escape&&(n.verbose("Escape key pressed, blurring search field"),w.trigger("blur")),y.filter(":visible").size()>0)if(f==g.enter){if(n.verbose("Enter key pressed, selecting active result"),d.filter("."+h).size()>0)return a.proxy(n.results.select,d.filter("."+h))(),b.preventDefault(),!1}else f==g.upArrow?(n.verbose("Up key pressed, changing active result"),c=i-1<0?i:i-1,e.removeClass(h),d.removeClass(h).eq(c).addClass(h).closest(e).addClass(h),b.preventDefault()):f==g.downArrow&&(n.verbose("Down key pressed, changing active result"),c=i+1>=j?i:i+1,e.removeClass(h),d.removeClass(h).eq(c).addClass(h).closest(e).addClass(h),b.preventDefault());else f==g.enter&&(n.verbose("Enter key pressed, executing query"),n.search.query(),x.addClass(p.down),w.one("keyup",function(){x.removeClass(p.down)}))},search:{cancel:function(){var a=v.data("xhr")||!1;a&&"resolved"!=a.state()&&(n.debug("Cancelling last search"),a.abort())},throttle:function(){var a=w.val(),b=a.length;clearTimeout(n.timer),b>=o.minCharacters?n.timer=setTimeout(n.search.query,o.searchThrottle):n.results.hide()},query:function(){var b=w.val(),d=n.search.cache.read(b);d?(n.debug("Reading result for '"+b+"' from cache"),n.results.add(d)):(n.debug("Querying for '"+b+"'"),"object"==typeof c?n.search.local(b):n.search.remote(b),a.proxy(o.onSearchQuery,v)(b))},local:function(b){var d,e=[],f=[],g=a.isArray(o.searchFields)?o.searchFields:[o.searchFields],h=new RegExp("(?:s|^)"+b,"i"),i=new RegExp(b,"i");v.addClass(p.loading),a.each(g,function(b,d){a.each(c,function(b,c){"string"==typeof c[d]&&a.inArray(c,e)==-1&&a.inArray(c,f)==-1&&(h.test(c[d])?e.push(c):i.test(c[d])&&f.push(c))})}),d=n.results.generate({results:a.merge(e,f)}),v.removeClass(p.loading),n.search.cache.write(b,d),n.results.add(d)},remote:function(b){var d,e={stateContext:v,url:c,urlData:{query:b},success:function(a){d=n.results.generate(a),n.search.cache.write(b,d),n.results.add(d)},failure:n.error};n.search.cancel(),n.debug("Executing search"),a.extend(!0,e,o.apiSettings),a.api(e)},cache:{read:function(a){var b=v.data("cache");return!(!o.cache||"object"!=typeof b||b[a]===d)&&b[a]},write:function(a,b){var c=v.data("cache")!==d?v.data("cache"):{};c[a]=b,v.data("cache",c)}}},results:{generate:function(b){n.debug("Generating html from response",b);var c=o.templates[o.type],d="";return a.isPlainObject(b.results)&&!a.isEmptyObject(b.results)||a.isArray(b.results)&&b.results.length>0?(o.maxResults>0&&(b.results=a.makeArray(b.results).slice(0,o.maxResults)),b.results.length>0&&(a.isFunction(c)?d=c(b):n.error(r.noTemplate,!1))):d=n.message(r.noResults,"empty"),a.proxy(o.onResults,v)(b),d},add:function(b){"default"!=o.onResultsAdd&&"default"!=a.proxy(o.onResultsAdd,y)(b)||y.html(b),n.results.show()},show:function(){0===y.filter(":visible").size()&&w.filter(":focus").size()>0&&""!==y.html()&&(y.stop().fadeIn(200),a.proxy(o.onResultsOpen,y)())},hide:function(){y.filter(":visible").size()>0&&(y.stop().fadeOut(200),a.proxy(o.onResultsClose,y)())},select:function(c){n.debug("Search result selected");var d=a(this),e=d.find(".title"),f=e.html();if("default"==o.onSelect||"default"==a.proxy(o.onSelect,this)(c)){var g=d.find("a[href]").eq(0),h=g.attr("href")||!1,i=g.attr("target")||!1;n.results.hide(),w.val(f),h&&("_blank"==i||c.ctrlKey?b.open(h):b.location.href=h)}}},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,o,b);else{if(c===d)return o[b];o[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,n,b);else{if(c===d)return n[b];n[b]=c}},debug:function(){o.debug&&(o.performance?n.performance.log(arguments):(n.debug=Function.prototype.bind.call(console.info,console,o.name+":"),n.debug.apply(console,arguments)))},verbose:function(){o.verbose&&o.debug&&(o.performance?n.performance.log(arguments):(n.verbose=Function.prototype.bind.call(console.info,console,o.name+":"),n.verbose.apply(console,arguments)))},error:function(){n.error=Function.prototype.bind.call(console.error,console,o.name+":"),n.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;o.performance&&(b=(new Date).getTime(),d=i||b,c=b-d,i=b,j.push({Element:z,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(n.performance.timer),n.performance.timer=setTimeout(n.performance.display,100)},display:function(){var b=o.name+":",c=0;i=!1,clearTimeout(n.performance.timer),a.each(j,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",h&&(b+=" '"+h+"'"),g.size()>1&&(b+=" ("+g.size()+")"),(console.group!==d||console.table!==d)&&j.length>0&&(console.groupCollapsed(b),console.table?console.table(j):a.each(j,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),j=[]}},invoke:function(b,c,e){var g,h,i,j=A;return c=c||m,e=z||e,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d&&(h=j[e],!1);j=j[e]}})),a.isFunction(h)?i=h.apply(e,c):h!==d&&(i=h),a.isArray(f)?f.push(i):f!==d?f=[f,i]:i!==d&&(f=i),h}},l?(A===d&&n.initialize(),n.invoke(k)):(A!==d&&n.destroy(),n.initialize())}),f!==d?f:this},a.fn.search.settings={name:"Search Module",namespace:"search",debug:!1,verbose:!0,performance:!0,onSelect:"default",onResultsAdd:"default",onSearchQuery:function(){},onResults:function(a){},onResultsOpen:function(){},onResultsClose:function(){},automatic:"true",type:"simple",minCharacters:3,searchThrottle:300,maxResults:7,cache:!0,searchFields:["title","description"],apiSettings:{},className:{active:"active",down:"down",focus:"focus",empty:"empty",loading:"loading"},error:{noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noTemplate:"A valid template name was not specified.",serverError:"There was an issue with querying the server.",method:"The method you called is not defined."},selector:{prompt:".prompt",searchButton:".search.button",results:".results",category:".category",result:".result"},templates:{message:function(a,b){var c="";return a!==d&&b!==d&&(c+='<div class="message '+b+'">',c+="empty"==b?'<div class="header">No Results</div class="header"><div class="description">'+a+'</div class="description">':' <div class="description">'+a+"</div>",c+="</div>"),c},categories:function(b){var c="";return b.results!==d&&(a.each(b.results,function(b,e){e.results!==d&&e.results.length>0&&(c+='<div class="category"><div class="name">'+e.name+"</div>",a.each(e.results,function(a,b){c+='<div class="result">',c+='<a href="'+b.url+'"></a>',b.image!==d&&(c+='<div class="image"> <img src="'+b.image+'"></div>'),c+='<div class="info">',b.price!==d&&(c+='<div class="price">'+b.price+"</div>"),b.title!==d&&(c+='<div class="title">'+b.title+"</div>"),b.description!==d&&(c+='<div class="description">'+b.description+"</div>"),c+="</div></div>"}),c+="</div>")}),b.resultPage&&(c+='<a href="'+b.resultPage.url+'" class="all">'+b.resultPage.text+"</a>"),c)},simple:function(b){var c="";return b.results!==d&&(a.each(b.results,function(a,b){c+='<a class="result" href="'+b.url+'">',b.image!==d&&(c+='<div class="image"> <img src="'+b.image+'"></div>'),c+='<div class="info">',b.price!==d&&(c+='<div class="price">'+b.price+"</div>"),b.title!==d&&(c+='<div class="title">'+b.title+"</div>"),b.description!==d&&(c+='<div class="description">'+b.description+"</div>"),c+="</div></a>"}),b.resultPage&&(c+='<a href="'+b.resultPage.url+'" class="all">'+b.resultPage.text+"</a>"),c)}}}}(jQuery,window,document),function(a,b,c,d){a.fn.dropdown=function(b){var e,f=a(this),g=a(c),h=f.selector||"",i="ontouchstart"in c.documentElement,j=(new Date).getTime(),k=[],l=arguments[0],m="string"==typeof l,n=[].slice.call(arguments,1);return f.each(function(){var c,o=a.isPlainObject(b)?a.extend(!0,{},a.fn.dropdown.settings,b):a.extend({},a.fn.dropdown.settings),p=o.className,q=o.metadata,r=o.namespace,s=o.selector,t=o.error,u="."+r,v="module-"+r,w=a(this),x=w.find(s.item),y=w.find(s.text),z=w.find(s.input),A=w.children(s.menu),B=this,C=w.data(v);c={initialize:function(){c.debug("Initializing dropdown",o),c.save.defaults(),c.set.selected(),i&&c.bind.touchEvents(),c.bind.mouseEvents(),c.bind.keyboardEvents(),c.instantiate()},instantiate:function(){c.verbose("Storing instance of dropdown",c),C=c,w.data(v,c)},destroy:function(){c.verbose("Destroying previous dropdown for",w),x.off(u),w.off(u).removeData(v)},bind:{keyboardEvents:function(){c.debug("Binding keyboard events"),w.on("keydown"+u,c.handleKeyboard),w.on("focus"+u,c.show)},touchEvents:function(){c.debug("Touch device detected binding touch events"),w.on("touchstart"+u,c.event.test.toggle),x.on("touchstart"+u,c.event.item.mouseenter).on("touchstart"+u,c.event.item.click)},mouseEvents:function(){c.verbose("Mouse detected binding mouse events"),"click"==o.on?w.on("click"+u,c.event.test.toggle):"hover"==o.on?w.on("mouseenter"+u,c.delay.show).on("mouseleave"+u,c.delay.hide):w.on(o.on+u,c.toggle),x.on("mouseenter"+u,c.event.item.mouseenter).on("mouseleave"+u,c.event.item.mouseleave).on("click"+u,c.event.item.click)},intent:function(){c.verbose("Binding hide intent event to document"),i&&g.on("touchstart"+u,c.event.test.touch).on("touchmove"+u,c.event.test.touch),
g.on("click"+u,c.event.test.hide)}},unbind:{intent:function(){c.verbose("Removing hide intent event from document"),i&&g.off("touchstart"+u).off("touchmove"+u),g.off("click"+u)}},handleKeyboard:function(b){var d,e=x.filter("."+p.selected),f=b.which,g={enter:13,escape:27,upArrow:38,downArrow:40},h=p.selected,i=x.index(e),j=e.size()>0,k=x.size();if(f==g.escape&&(c.verbose("Escape key pressed, closing dropdown"),c.hide()),c.is.visible()){if(f==g.enter&&j)return c.verbose("Enter key pressed, choosing selected item"),a.proxy(c.event.item.click,x.filter("."+h))(b),b.preventDefault(),!1;f==g.upArrow?(c.verbose("Up key pressed, changing active item"),d=i-1<0?i:i-1,x.removeClass(h).eq(d).addClass(h),b.preventDefault()):f==g.downArrow&&(c.verbose("Down key pressed, changing active item"),d=i+1>=k?i:i+1,x.removeClass(h).eq(d).addClass(h),b.preventDefault())}else f==g.enter&&c.show()},event:{test:{toggle:function(a){c.determine.intent(a,c.toggle)&&a.preventDefault()},touch:function(a){c.determine.intent(a,function(){"touchstart"==a.type?c.timer=setTimeout(c.hide,o.delay.touch):"touchmove"==a.type&&clearTimeout(c.timer)}),a.stopPropagation()},hide:function(a){c.determine.intent(a,c.hide)}},item:{mouseenter:function(b){var d=a(this).find(s.submenu),e=a(this).siblings(s.item).children(s.menu);(d.length>0||e.length>0)&&(clearTimeout(c.itemTimer),c.itemTimer=setTimeout(function(){e.length>0&&c.animate.hide(!1,e.filter(":visible")),d.length>0&&(c.verbose("Showing sub-menu",d),c.animate.show(!1,d))},2*o.delay.show),b.preventDefault(),b.stopPropagation())},mouseleave:function(b){var d=a(this).find(s.menu);d.size()>0&&(clearTimeout(c.itemTimer),c.itemTimer=setTimeout(function(){c.verbose("Hiding sub-menu",d),c.animate.hide(!1,d)},o.delay.hide))},click:function(b){var e=a(this),f=e.data(q.text)!==d?e.data(q.text):e.text(),g=e.data(q.value)!==d?e.data(q.value):"string"==typeof f?f.toLowerCase():f,h=function(){c.determine.selectAction(f,g),a.proxy(o.onChange,B)(g,f)};0===e.find(s.menu).size()&&("touchstart"==b.type?e.one("click",h):h())}},resetStyle:function(){a(this).removeAttr("style")}},determine:{selectAction:function(b,d){c.verbose("Determining action",o.action),a.isFunction(c.action[o.action])?(c.verbose("Triggering preset action",o.action,b,d),c.action[o.action](b,d)):a.isFunction(o.action)?(c.verbose("Triggering user action",o.action,b,d),o.action(b,d)):c.error(t.action,o.action)},intent:function(b,d){return c.debug("Determining whether event occurred in dropdown",b.target),d=d||function(){},0===a(b.target).closest(A).size()?(c.verbose("Triggering event",d),d(),!0):(c.verbose("Event occurred in dropdown, canceling callback"),!1)}},action:{nothing:function(){},hide:function(){c.hide()},activate:function(a,b){b=b!==d?b:a,c.set.selected(b),c.set.value(b),c.hide()},auto:function(a,b){b=b!==d?b:a,c.set.selected(b),c.set.value(b),c.hide()},changeText:function(a,b){b=b!==d?b:a,c.set.selected(b),c.hide()},updateForm:function(a,b){b=b!==d?b:a,c.set.selected(b),c.set.value(b),c.hide()}},get:{text:function(){return y.text()},value:function(){return z.size()>0?z.val():w.data(q.value)},item:function(b,e){var f=!1;return b=b!==d?b:c.get.value()!==d?c.get.value():c.get.text(),e===d&&""===b?(c.debug("Ambiguous dropdown value using strict type check",b),e=!0):e=e||!1,b!==d?x.each(function(){var c=a(this),g=c.data(q.text)!==d?c.data(q.text):c.text(),h=c.data(q.value)!==d?c.data(q.value):"string"==typeof g?g.toLowerCase():g;e?h===b?f=a(this):f||g!==b||(f=a(this)):h==b?f=a(this):f||g!=b||(f=a(this))}):b=c.get.text(),f||!1}},restore:{defaults:function(){c.restore.defaultText(),c.restore.defaultValue()},defaultText:function(){var a=w.data(q.defaultText);c.debug("Restoring default text",a),c.set.text(a)},defaultValue:function(){var a=w.data(q.defaultValue);a!==d&&(c.debug("Restoring default value",a),c.set.selected(a),c.set.value(a))}},save:{defaults:function(){c.save.defaultText(),c.save.defaultValue()},defaultValue:function(){w.data(q.defaultValue,c.get.value())},defaultText:function(){w.data(q.defaultText,y.text())}},set:{text:function(a){c.debug("Changing text",a,y),y.removeClass(p.placeholder),y.text(a)},value:function(a){c.debug("Adding selected value to hidden input",a,z),z.size()>0?z.val(a).trigger("change"):w.data(q.value,a)},active:function(){w.addClass(p.active)},visible:function(){w.addClass(p.visible)},selected:function(a){var b,e=c.get.item(a);e&&(c.debug("Setting selected menu item to",e),b=e.data(q.text)!==d?e.data(q.text):e.text(),x.removeClass(p.active),e.addClass(p.active),c.set.text(b))}},remove:{active:function(){w.removeClass(p.active)},visible:function(){w.removeClass(p.visible)}},is:{selection:function(){return w.hasClass(p.selection)},animated:function(a){return a?a.is(":animated")||a.transition&&a.transition("is animating"):A.is(":animated")||A.transition&&A.transition("is animating")},visible:function(a){return a?a.is(":visible"):A.is(":visible")},hidden:function(a){return a?a.is(":not(:visible)"):A.is(":not(:visible)")}},can:{click:function(){return i||"click"==o.on},show:function(){return!w.hasClass(p.disabled)}},animate:{show:function(b,e){var f=e||A;b=b||function(){},c.is.hidden(f)&&(c.verbose("Doing menu show animation",f),"none"==o.transition?b():a.fn.transition!==d&&w.transition("is supported")?f.transition({animation:o.transition+" in",duration:o.duration,complete:b,queue:!1}):"slide down"==o.transition?f.hide().clearQueue().children().clearQueue().css("opacity",0).delay(50).animate({opacity:1},o.duration,"easeOutQuad",c.event.resetStyle).end().slideDown(100,"easeOutQuad",function(){a.proxy(c.event.resetStyle,this)(),b()}):"fade"==o.transition?f.hide().clearQueue().fadeIn(o.duration,function(){a.proxy(c.event.resetStyle,this)(),b()}):c.error(t.transition,o.transition))},hide:function(b,e){var f=e||A;b=b||function(){},c.is.visible(f)&&(c.verbose("Doing menu hide animation",f),a.fn.transition!==d&&w.transition("is supported")?f.transition({animation:o.transition+" out",duration:o.duration,complete:b,queue:!1}):"none"==o.transition?b():"slide down"==o.transition?f.show().clearQueue().children().clearQueue().css("opacity",1).animate({opacity:0},100,"easeOutQuad",c.event.resetStyle).end().delay(50).slideUp(100,"easeOutQuad",function(){a.proxy(c.event.resetStyle,this)(),b()}):"fade"==o.transition?f.show().clearQueue().fadeOut(150,function(){a.proxy(c.event.resetStyle,this)(),b()}):c.error(t.transition))}},show:function(){c.debug("Checking if dropdown can show"),c.is.hidden()&&(c.hideOthers(),c.set.active(),c.animate.show(function(){c.can.click()&&c.bind.intent(),c.set.visible()}),a.proxy(o.onShow,B)())},hide:function(){!c.is.animated()&&c.is.visible()&&(c.debug("Hiding dropdown"),c.can.click()&&c.unbind.intent(),c.remove.active(),c.animate.hide(c.remove.visible),a.proxy(o.onHide,B)())},delay:{show:function(){c.verbose("Delaying show event to ensure user intent"),clearTimeout(c.timer),c.timer=setTimeout(c.show,o.delay.show)},hide:function(){c.verbose("Delaying hide event to ensure user intent"),clearTimeout(c.timer),c.timer=setTimeout(c.hide,o.delay.hide)}},hideOthers:function(){c.verbose("Finding other dropdowns to hide"),f.not(w).has(s.menu+":visible").dropdown("hide")},toggle:function(){c.verbose("Toggling menu visibility"),c.is.hidden()?c.show():c.hide()},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,o,b);else{if(c===d)return o[b];o[b]=c}},internal:function(b,e){if(a.isPlainObject(b))a.extend(!0,c,b);else{if(e===d)return c[b];c[b]=e}},debug:function(){o.debug&&(o.performance?c.performance.log(arguments):(c.debug=Function.prototype.bind.call(console.info,console,o.name+":"),c.debug.apply(console,arguments)))},verbose:function(){o.verbose&&o.debug&&(o.performance?c.performance.log(arguments):(c.verbose=Function.prototype.bind.call(console.info,console,o.name+":"),c.verbose.apply(console,arguments)))},error:function(){c.error=Function.prototype.bind.call(console.error,console,o.name+":"),c.error.apply(console,arguments)},performance:{log:function(a){var b,d,e;o.performance&&(b=(new Date).getTime(),e=j||b,d=b-e,j=b,k.push({Element:B,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":d})),clearTimeout(c.performance.timer),c.performance.timer=setTimeout(c.performance.display,100)},display:function(){var b=o.name+":",e=0;j=!1,clearTimeout(c.performance.timer),a.each(k,function(a,b){e+=b["Execution Time"]}),b+=" "+e+"ms",h&&(b+=" '"+h+"'"),(console.group!==d||console.table!==d)&&k.length>0&&(console.groupCollapsed(b),console.table?console.table(k):a.each(k,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),k=[]}},invoke:function(b,f,g){var h,i,j,k=C;return f=f||n,g=B||g,"string"==typeof b&&k!==d&&(b=b.split(/[\. ]/),h=b.length-1,a.each(b,function(e,f){var g=e!=h?f+b[e+1].charAt(0).toUpperCase()+b[e+1].slice(1):b;if(a.isPlainObject(k[g])&&e!=h)k=k[g];else{if(k[g]!==d)return i=k[g],!1;if(!a.isPlainObject(k[f])||e==h)return k[f]!==d?(i=k[f],!1):(c.error(t.method,b),!1);k=k[f]}})),a.isFunction(i)?j=i.apply(g,f):i!==d&&(j=i),a.isArray(e)?e.push(j):e!==d?e=[e,j]:j!==d&&(e=j),i}},m?(C===d&&c.initialize(),c.invoke(l)):(C!==d&&c.destroy(),c.initialize())}),e!==d?e:this},a.fn.dropdown.settings={name:"Dropdown",namespace:"dropdown",debug:!1,verbose:!0,performance:!0,on:"click",action:"activate",delay:{show:200,hide:300,touch:50},transition:"slide down",duration:250,onChange:function(a,b){},onShow:function(){},onHide:function(){},error:{action:"You called a dropdown action that was not defined",method:"The method you called is not defined.",transition:"The requested transition was not found"},metadata:{defaultText:"defaultText",defaultValue:"defaultValue",text:"text",value:"value"},selector:{menu:".menu",submenu:"> .menu",item:".menu > .item",text:"> .text",input:'> input[type="hidden"]'},className:{active:"active",placeholder:"default",disabled:"disabled",visible:"visible",selected:"selected",selection:"selection"}},a.extend(a.easing,{easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c}})}(jQuery,window,document),function(a,b,c,d){a.fn.checkbox=function(b){var c,e=a(this),f=e.selector||"",g=(new Date).getTime(),h=[],i=arguments[0],j="string"==typeof i,k=[].slice.call(arguments,1);return e.each(function(){var e,l=a.extend(!0,{},a.fn.checkbox.settings,b),m=l.className,n=l.namespace,o=(l.error,"."+n),p="module-"+n,q=a(this),r=a(this).next(l.selector.label).first(),s=a(this).find(l.selector.input),t=q.selector||"",u=q.data(p),v=this;e={initialize:function(){e.verbose("Initializing checkbox",l),l.context&&""!==t?(e.verbose("Adding delegated events"),a(v,l.context).on(t,"click"+o,e.toggle).on(t+" + "+l.selector.label,"click"+o,e.toggle)):(q.on("click"+o,e.toggle).data(p,e),r.on("click"+o,e.toggle)),e.instantiate()},instantiate:function(){e.verbose("Storing instance of module",e),u=e,q.data(p,e)},destroy:function(){e.verbose("Destroying previous module"),q.off(o).removeData(p)},is:{radio:function(){return q.hasClass(m.radio)},enabled:function(){return s.prop("checked")!==d&&s.prop("checked")},disabled:function(){return!e.is.enabled()}},can:{disable:function(){return"boolean"==typeof l.required?l.required:!e.is.radio()}},enable:function(){e.debug("Enabling checkbox",s),s.prop("checked",!0).trigger("change"),a.proxy(l.onChange,s.get())(),a.proxy(l.onEnable,s.get())()},disable:function(){e.debug("Disabling checkbox"),s.prop("checked",!1).trigger("change"),a.proxy(l.onChange,s.get())(),a.proxy(l.onDisable,s.get())()},toggle:function(a){e.verbose("Determining new checkbox state"),s.prop("disabled")||(e.is.disabled()?e.enable():e.is.enabled()&&e.can.disable()&&e.disable())},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,l,b);else{if(c===d)return l[b];l[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,e,b);else{if(c===d)return e[b];e[b]=c}},debug:function(){l.debug&&(l.performance?e.performance.log(arguments):(e.debug=Function.prototype.bind.call(console.info,console,l.name+":"),e.debug.apply(console,arguments)))},verbose:function(){l.verbose&&l.debug&&(l.performance?e.performance.log(arguments):(e.verbose=Function.prototype.bind.call(console.info,console,l.name+":"),e.verbose.apply(console,arguments)))},error:function(){e.error=Function.prototype.bind.call(console.error,console,l.name+":"),e.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;l.performance&&(b=(new Date).getTime(),d=g||b,c=b-d,g=b,h.push({Element:v,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(e.performance.timer),e.performance.timer=setTimeout(e.performance.display,100)},display:function(){var b=l.name+":",c=0;g=!1,clearTimeout(e.performance.timer),a.each(h,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",f&&(b+=" '"+f+"'"),(console.group!==d||console.table!==d)&&h.length>0&&(console.groupCollapsed(b),console.table?console.table(h):a.each(h,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),h=[]}},invoke:function(b,e,f){var g,h,i,j=u;return e=e||k,f=v||f,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d&&(h=j[e],!1);j=j[e]}})),a.isFunction(h)?i=h.apply(f,e):h!==d&&(i=h),a.isArray(c)?c.push(i):c!==d?c=[c,i]:i!==d&&(c=i),h}},j?(u===d&&e.initialize(),e.invoke(i)):(u!==d&&e.destroy(),e.initialize())}),c!==d?c:this},a.fn.checkbox.settings={name:"Checkbox",namespace:"checkbox",debug:!1,verbose:!0,performance:!0,context:!1,required:"auto",onChange:function(){},onEnable:function(){},onDisable:function(){},error:{method:"The method you called is not defined."},selector:{input:"input[type=checkbox], input[type=radio]",label:"label"},className:{radio:"radio"}}}(jQuery,window,document),function(a,b,c,d){a.fn.dimmer=function(b){var e,f=a(this),g=(new Date).getTime(),h=[],i=arguments[0],j="string"==typeof i,k=[].slice.call(arguments,1);return f.each(function(){var l,m,n,o=a.isPlainObject(b)?a.extend(!0,{},a.fn.dimmer.settings,b):a.extend({},a.fn.dimmer.settings),p=o.selector,q=o.namespace,r=o.className,s=(o.error,"."+q),t="module-"+q,u=f.selector||"",v="ontouchstart"in c.documentElement?"touchstart":"click",w=a(this),x=this,y=w.data(t);n={preinitialize:function(){n.is.dimmer()?(m=w.parent(),l=w):(m=w,l=n.has.dimmer()?m.children(p.dimmer).first():n.create())},initialize:function(){n.debug("Initializing dimmer",o),"hover"==o.on?m.on("mouseenter"+s,n.show).on("mouseleave"+s,n.hide):"click"==o.on&&m.on(v+s,n.toggle),n.is.page()&&(n.debug("Setting as a page dimmer",m),n.set.pageDimmer()),o.closable&&(n.verbose("Adding dimmer close event",l),l.on(v+s,n.event.click)),n.set.dimmable(),n.instantiate()},instantiate:function(){n.verbose("Storing instance of module",n),y=n,w.data(t,y)},destroy:function(){n.verbose("Destroying previous module",l),w.removeData(t),m.off(s),l.off(s)},event:{click:function(b){n.verbose("Determining if event occured on dimmer",b),(0===l.find(b.target).size()||a(b.target).is(p.content))&&(n.hide(),b.stopImmediatePropagation())}},addContent:function(b){var c=a(b);n.debug("Add content to dimmer",c),c.parent()[0]!==l[0]&&c.detach().appendTo(l)},create:function(){return a(o.template.dimmer()).appendTo(m)},animate:{show:function(b){b=a.isFunction(b)?b:function(){},n.set.dimmed(),"hover"!=o.on&&o.useCSS&&a.fn.transition!==d&&l.transition("is supported")?l.transition({animation:o.transition+" in",queue:!0,duration:n.get.duration(),complete:function(){n.set.active(),b()}}):(n.verbose("Showing dimmer animation with javascript"),l.stop().css({opacity:0,width:"100%",height:"100%"}).fadeTo(n.get.duration(),1,function(){l.removeAttr("style"),n.set.active(),b()}))},hide:function(b){b=a.isFunction(b)?b:function(){},"hover"!=o.on&&o.useCSS&&a.fn.transition!==d&&l.transition("is supported")?(n.verbose("Hiding dimmer with css"),l.transition({animation:o.transition+" out",duration:n.get.duration(),queue:!0,complete:function(){n.remove.dimmed(),n.remove.active(),b()}})):(n.verbose("Hiding dimmer with javascript"),l.stop().fadeOut(n.get.duration(),function(){l.removeAttr("style"),n.remove.dimmed(),n.remove.active(),b()}))}},get:{dimmer:function(){return l},duration:function(){return"object"==typeof o.duration?n.is.active()?o.duration.hide:o.duration.show:o.duration}},has:{dimmer:function(){return w.children(p.dimmer).size()>0}},is:{active:function(){return l.hasClass(r.active)},animating:function(){return l.is(":animated")||l.hasClass(r.transition)},dimmer:function(){return w.is(p.dimmer)},dimmable:function(){return w.is(p.dimmable)},dimmed:function(){return m.hasClass(r.dimmed)},disabled:function(){return m.hasClass(r.disabled)},enabled:function(){return!n.is.disabled()},page:function(){return m.is("body")},pageDimmer:function(){return l.hasClass(r.pageDimmer)}},can:{show:function(){return!l.hasClass(r.disabled)}},set:{active:function(){n.set.dimmed(),l.removeClass(r.transition).addClass(r.active)},dimmable:function(){m.addClass(r.dimmable)},dimmed:function(){m.addClass(r.dimmed)},pageDimmer:function(){l.addClass(r.pageDimmer)},disabled:function(){l.addClass(r.disabled)}},remove:{active:function(){l.removeClass(r.transition).removeClass(r.active)},dimmed:function(){m.removeClass(r.dimmed)},disabled:function(){l.removeClass(r.disabled)}},show:function(b){b=a.isFunction(b)?b:function(){},n.debug("Showing dimmer",l,o),!n.is.active()&&n.is.enabled()?(n.animate.show(b),a.proxy(o.onShow,x)(),a.proxy(o.onChange,x)()):n.debug("Dimmer is already shown or disabled")},hide:function(b){b=a.isFunction(b)?b:function(){},n.is.active()||n.is.animating()?(n.debug("Hiding dimmer",l),n.animate.hide(b),a.proxy(o.onHide,x)(),a.proxy(o.onChange,x)()):n.debug("Dimmer is not visible")},toggle:function(){n.verbose("Toggling dimmer visibility",l),n.is.dimmed()?n.hide():n.show()},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,o,b);else{if(c===d)return o[b];o[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,n,b);else{if(c===d)return n[b];n[b]=c}},debug:function(){o.debug&&(o.performance?n.performance.log(arguments):(n.debug=Function.prototype.bind.call(console.info,console,o.name+":"),n.debug.apply(console,arguments)))},verbose:function(){o.verbose&&o.debug&&(o.performance?n.performance.log(arguments):(n.verbose=Function.prototype.bind.call(console.info,console,o.name+":"),n.verbose.apply(console,arguments)))},error:function(){n.error=Function.prototype.bind.call(console.error,console,o.name+":"),n.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;o.performance&&(b=(new Date).getTime(),d=g||b,c=b-d,g=b,h.push({Element:x,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(n.performance.timer),n.performance.timer=setTimeout(n.performance.display,100)},display:function(){var b=o.name+":",c=0;g=!1,clearTimeout(n.performance.timer),a.each(h,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",u&&(b+=" '"+u+"'"),f.size()>1&&(b+=" ("+f.size()+")"),(console.group!==d||console.table!==d)&&h.length>0&&(console.groupCollapsed(b),console.table?console.table(h):a.each(h,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),h=[]}},invoke:function(b,c,f){var g,h,i,j=y;return c=c||k,f=x||f,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d&&(h=j[e],!1);j=j[e]}})),a.isFunction(h)?i=h.apply(f,c):h!==d&&(i=h),a.isArray(e)?e.push(i):e!==d?e=[e,i]:i!==d&&(e=i),h}},n.preinitialize(),j?(y===d&&n.initialize(),n.invoke(i)):(y!==d&&n.destroy(),n.initialize())}),e!==d?e:this},a.fn.dimmer.settings={name:"Dimmer",namespace:"dimmer",debug:!1,verbose:!0,performance:!0,transition:"fade",useCSS:!0,on:!1,closable:!0,duration:{show:500,hide:500},onChange:function(){},onShow:function(){},onHide:function(){},error:{method:"The method you called is not defined."},selector:{dimmable:".ui.dimmable",dimmer:".ui.dimmer",content:".ui.dimmer > .content, .ui.dimmer > .content > .center"},template:{dimmer:function(){return a("<div />").attr("class","ui dimmer")}},className:{active:"active",dimmable:"ui dimmable",dimmed:"dimmed",disabled:"disabled",pageDimmer:"page",hide:"hide",show:"show",transition:"transition"}}}(jQuery,window,document),function(a,b,c,d){a.fn.modal=function(e){var f,g=a(this),h=a(b),i=a(c),j=a("body"),k=(new Date).getTime(),l=[],m=arguments[0],n="string"==typeof m,o=[].slice.call(arguments,1),p=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.msRequestAnimationFrame||function(a){setTimeout(a,0)};return g.each(function(){var q,r,s,t,u,v,w=a.isPlainObject(e)?a.extend(!0,{},a.fn.modal.settings,e):a.extend({},a.fn.modal.settings),x=w.selector,y=w.className,z=w.namespace,A=w.error,B="."+z,C="module-"+z,D=g.selector||"",E=a(this),F=a(w.context),G=E.find(x.close),H=this,I=E.data(C);v={initialize:function(){return v.verbose("Initializing dimmer",F),a.fn.dimmer===d?void v.error(A.dimmer):(t=F.dimmer({closable:!1,useCSS:!0,duration:{show:.9*w.duration,hide:1.1*w.duration}}),w.detachable&&t.dimmer("add content",E),u=t.dimmer("get dimmer"),v.refreshSelectors(),v.verbose("Attaching close events",G),G.on("click"+B,v.event.close),h.on("resize"+B,v.event.resize),void v.instantiate())},instantiate:function(){v.verbose("Storing instance of modal"),I=v,E.data(C,I)},destroy:function(){v.verbose("Destroying previous modal"),E.removeData(C).off(B),G.off(B),F.dimmer("destroy")},refresh:function(){v.remove.scrolling(),v.cacheSizes(),v.set.screenHeight(),v.set.type(),v.set.position()},refreshSelectors:function(){r=E.siblings(x.modal),q=r.add(E)},attachEvents:function(b,c){var d=a(b);c=a.isFunction(v[c])?v[c]:v.toggle,d.size()>0?(v.debug("Attaching modal events to element",b,c),d.off(B).on("click"+B,c)):v.error(A.notFound)},event:{close:function(){v.verbose("Closing element pressed"),a(this).is(x.approve)?a.proxy(w.onApprove,H)()!==!1?v.hide():v.verbose("Approve callback returned false cancelling hide"):a(this).is(x.deny)?a.proxy(w.onDeny,H)()!==!1?v.hide():v.verbose("Deny callback returned false cancelling hide"):v.hide()},click:function(b){0===a(b.target).closest(x.modal).size()&&(v.debug("Dimmer clicked, hiding all modals"),w.allowMultiple?v.hide():v.hideAll(),b.stopImmediatePropagation())},debounce:function(a,b){clearTimeout(v.timer),v.timer=setTimeout(a,b)},keyboard:function(a){var b=a.which,c=27;b==c&&(w.closable?(v.debug("Escape key pressed hiding modal"),v.hide()):v.debug("Escape key pressed, but closable is set to false"),a.preventDefault())},resize:function(){t.dimmer("is active")&&p(v.refresh)}},toggle:function(){v.is.active()?v.hide():v.show()},show:function(b){b=a.isFunction(b)?b:function(){},v.showDimmer(),v.showModal(b)},onlyVisible:function(){return v.refreshSelectors(),v.is.active()&&0===r.filter(":visible").size()},othersVisible:function(){return v.refreshSelectors(),r.filter(":visible").size()>0},showModal:function(b){if(v.is.active())return void v.debug("Modal is already visible");if(b=a.isFunction(b)?b:function(){},v.save.focus(),v.add.keyboardShortcuts(),v.cache===d&&v.cacheSizes(),v.set.position(),v.set.screenHeight(),v.set.type(),v.othersVisible()&&!w.allowMultiple)v.debug("Other modals visible, queueing show animation"),v.hideOthers(v.showModal);else{a.proxy(w.onShow,H)();var c=function(){v.set.active(),a.proxy(w.onVisible,H)(),b()};w.transition&&a.fn.transition!==d&&E.transition("is supported")?(v.debug("Showing modal with css animations"),E.transition(w.transition+" in",w.duration,c)):(v.debug("Showing modal with javascript"),E.fadeIn(w.duration,w.easing,c))}},showDimmer:function(){t.dimmer("is active")?v.debug("Dimmer is already visible"):(v.debug("Showing dimmer"),t.dimmer("show"))},hide:function(b){b=a.isFunction(b)?b:function(){},v.refreshSelectors(),v.onlyVisible()&&v.hideDimmer(),v.hideModal(b)},hideDimmer:function(){return v.is.active()?(v.debug("Hiding dimmer"),w.closable&&u.off("click"+B),void t.dimmer("hide",function(){w.transition&&a.fn.transition!==d&&E.transition("is supported")&&(E.transition("reset"),v.remove.screenHeight()),v.remove.active()})):void v.debug("Dimmer is already hidden")},hideModal:function(b){if(!v.is.active())return void v.debug("Modal is already hidden");b=a.isFunction(b)?b:function(){},v.restore.focus(),v.remove.keyboardShortcuts(),a.proxy(w.onHide,H)();var c=function(){v.remove.active(),a.proxy(w.onHidden,H)(),b()};w.transition&&a.fn.transition!==d&&E.transition("is supported")?(v.debug("Hiding modal with css animations"),E.transition(w.transition+" out",w.duration,c)):(v.debug("Hiding modal with javascript"),E.fadeOut(w.duration,w.easing,c))},hideAll:function(b){b=a.isFunction(b)?b:function(){},(E.is(":visible")||v.othersVisible())&&(v.debug("Hiding all visible modals"),v.hideDimmer(),q.filter(":visible").modal("hide modal",b))},hideOthers:function(b){b=a.isFunction(b)?b:function(){},v.othersVisible()&&(v.debug("Hiding other modals"),r.filter(":visible").modal("hide modal",b))},add:{keyboardShortcuts:function(){v.verbose("Adding keyboard shortcuts"),i.on("keyup"+B,v.event.keyboard)}},save:{focus:function(){s=a(c.activeElement).blur()}},restore:{focus:function(){s&&s.size()>0&&s.focus()}},remove:{active:function(){E.removeClass(y.active)},screenHeight:function(){v.cache.height>v.cache.pageHeight&&(v.debug("Removing page height"),j.css("height",""))},keyboardShortcuts:function(){v.verbose("Removing keyboard shortcuts"),i.off("keyup"+B)},scrolling:function(){t.removeClass(y.scrolling),E.removeClass(y.scrolling)}},cacheSizes:function(){v.cache={pageHeight:j.outerHeight(),height:E.outerHeight()+w.offset,contextHeight:"body"==w.context?a(b).height():t.height()},v.debug("Caching modal and container sizes",v.cache)},can:{fit:function(){return v.cache.height<v.cache.contextHeight}},is:{active:function(){return E.hasClass(y.active)},modernBrowser:function(){return!(b.ActiveXObject||"ActiveXObject"in b)}},set:{screenHeight:function(){v.cache.height>v.cache.pageHeight&&(v.debug("Modal is taller than page content, resizing page height"),j.css("height",v.cache.height+w.padding))},active:function(){if(E.addClass(y.active),w.closable&&u.off("click"+B).on("click"+B,v.event.click),w.autofocus){var a=E.find(":input:visible"),b=a.filter("[autofocus]"),c=b.length?b:a;c.first().focus()}},scrolling:function(){t.addClass(y.scrolling),E.addClass(y.scrolling)},type:function(){v.can.fit()?(v.verbose("Modal fits on screen"),v.remove.scrolling()):(v.verbose("Modal cannot fit on screen setting to scrolling"),v.set.scrolling())},position:function(){v.verbose("Centering modal on page",v.cache),v.can.fit()?E.css({top:"",marginTop:-(v.cache.height/2)}):E.css({marginTop:"1em",top:i.scrollTop()})}},setting:function(b,c){if(v.debug("Changing setting",b,c),a.isPlainObject(b))a.extend(!0,w,b);else{if(c===d)return w[b];w[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,v,b);else{if(c===d)return v[b];v[b]=c}},debug:function(){w.debug&&(w.performance?v.performance.log(arguments):(v.debug=Function.prototype.bind.call(console.info,console,w.name+":"),v.debug.apply(console,arguments)))},verbose:function(){w.verbose&&w.debug&&(w.performance?v.performance.log(arguments):(v.verbose=Function.prototype.bind.call(console.info,console,w.name+":"),v.verbose.apply(console,arguments)))},error:function(){v.error=Function.prototype.bind.call(console.error,console,w.name+":"),v.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;w.performance&&(b=(new Date).getTime(),d=k||b,c=b-d,k=b,l.push({Element:H,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(v.performance.timer),v.performance.timer=setTimeout(v.performance.display,100)},display:function(){var b=w.name+":",c=0;k=!1,clearTimeout(v.performance.timer),a.each(l,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",D&&(b+=" '"+D+"'"),(console.group!==d||console.table!==d)&&l.length>0&&(console.groupCollapsed(b),console.table?console.table(l):a.each(l,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),l=[]}},invoke:function(b,c,e){var g,h,i,j=I;return c=c||o,e=H||e,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d&&(h=j[e],!1);j=j[e]}})),a.isFunction(h)?i=h.apply(e,c):h!==d&&(i=h),a.isArray(f)?f.push(i):f!==d?f=[f,i]:i!==d&&(f=i),h}},n?(I===d&&v.initialize(),v.invoke(m)):(I!==d&&v.destroy(),v.initialize())}),f!==d?f:this},a.fn.modal.settings={name:"Modal",namespace:"modal",debug:!1,verbose:!0,performance:!0,allowMultiple:!0,detachable:!0,closable:!0,autofocus:!0,context:"body",duration:500,easing:"easeOutQuad",offset:0,transition:"scale",padding:30,onShow:function(){},onHide:function(){},onVisible:function(){},onHidden:function(){},onApprove:function(){return!0},onDeny:function(){return!0},selector:{close:".close, .actions .button",approve:".actions .positive, .actions .approve, .actions .ok",deny:".actions .negative, .actions .deny, .actions .cancel",modal:".ui.modal"},error:{dimmer:"UI Dimmer, a required component is not included in this page",method:"The method you called is not defined."},className:{active:"active",scrolling:"scrolling"}},a.extend(a.easing,{easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c}})}(jQuery,window,document),function(a,b,c,d){a.fn.accordion=function(b){var c,e=a(this),f=(new Date).getTime(),g=[],h=arguments[0],i="string"==typeof h,j=[].slice.call(arguments,1);return e.each(function(){var k,l=a.isPlainObject(b)?a.extend(!0,{},a.fn.accordion.settings,b):a.extend({},a.fn.accordion.settings),m=l.className,n=l.namespace,o=l.selector,p=(l.error,"."+n),q="module-"+n,r=e.selector||"",s=a(this),t=s.find(o.title),u=s.find(o.content),v=this,w=s.data(q);k={initialize:function(){k.debug("Initializing accordion with bound events",s),t.on("click"+p,k.event.click),k.instantiate()},instantiate:function(){w=k,s.data(q,k)},destroy:function(){k.debug("Destroying previous accordion for",s),s.removeData(q),t.off(p)},event:{click:function(){k.verbose("Title clicked",this);var b=a(this),c=t.index(b);k.toggle(c)},resetDisplay:function(){a(this).css("display",""),""==a(this).attr("style")&&a(this).attr("style","").removeAttr("style")},resetOpacity:function(){a(this).css("opacity",""),""==a(this).attr("style")&&a(this).attr("style","").removeAttr("style")}},toggle:function(a){k.debug("Toggling content content at index",a);var b=t.eq(a),c=b.next(u),d=c.is(":visible");d?l.collapsible?k.close(a):k.debug("Cannot close accordion content collapsing is disabled"):k.open(a)},open:function(b){var c=t.eq(b),d=c.next(u),e=k.is.menu()?c.parent().siblings(o.item).find(o.title):c.siblings(o.title),f=e.filter("."+m.active),g=f.next(t),h=f.size()>0;d.is(":animated")||(k.debug("Opening accordion content",c),l.exclusive&&h&&(f.removeClass(m.active),g.stop().children().stop().animate({opacity:0},l.duration,k.event.resetOpacity).end().slideUp(l.duration,l.easing,function(){g.removeClass(m.active).children(),a.proxy(k.event.resetDisplay,this)()})),c.addClass(m.active),d.stop().children().stop().animate({opacity:1},l.duration).end().slideDown(l.duration,l.easing,function(){d.addClass(m.active),a.proxy(k.event.resetDisplay,this)(),a.proxy(l.onOpen,d)(),a.proxy(l.onChange,d)()}))},close:function(b){var c=t.eq(b),d=c.next(u);k.debug("Closing accordion content",d),c.removeClass(m.active),d.removeClass(m.active).show().stop().children().stop().animate({opacity:0},l.duration,k.event.resetOpacity).end().slideUp(l.duration,l.easing,function(){a.proxy(k.event.resetDisplay,this)(),a.proxy(l.onClose,d)(),a.proxy(l.onChange,d)()})},is:{menu:function(){return s.hasClass(m.menu)}},setting:function(b,c){
if(a.isPlainObject(b))a.extend(!0,l,b);else{if(c===d)return l[b];l[b]=c}},internal:function(b,c){return k.debug("Changing internal",b,c),c===d?k[b]:void(a.isPlainObject(b)?a.extend(!0,k,b):k[b]=c)},debug:function(){l.debug&&(l.performance?k.performance.log(arguments):(k.debug=Function.prototype.bind.call(console.info,console,l.name+":"),k.debug.apply(console,arguments)))},verbose:function(){l.verbose&&l.debug&&(l.performance?k.performance.log(arguments):(k.verbose=Function.prototype.bind.call(console.info,console,l.name+":"),k.verbose.apply(console,arguments)))},error:function(){k.error=Function.prototype.bind.call(console.error,console,l.name+":"),k.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;l.performance&&(b=(new Date).getTime(),d=f||b,c=b-d,f=b,g.push({Element:v,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(k.performance.timer),k.performance.timer=setTimeout(k.performance.display,100)},display:function(){var b=l.name+":",c=0;f=!1,clearTimeout(k.performance.timer),a.each(g,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",r&&(b+=" '"+r+"'"),(console.group!==d||console.table!==d)&&g.length>0&&(console.groupCollapsed(b),console.table?console.table(g):a.each(g,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),g=[]}},invoke:function(b,e,f){var g,h,i,k=w;return e=e||j,f=v||f,"string"==typeof b&&k!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(k[f])&&c!=g)k=k[f];else{if(k[f]!==d)return h=k[f],!1;if(!a.isPlainObject(k[e])||c==g)return k[e]!==d&&(h=k[e],!1);k=k[e]}})),a.isFunction(h)?i=h.apply(f,e):h!==d&&(i=h),a.isArray(c)?c.push(i):c!==d?c=[c,i]:i!==d&&(c=i),h}},i?(w===d&&k.initialize(),k.invoke(h)):(w!==d&&k.destroy(),k.initialize())}),c!==d?c:this},a.fn.accordion.settings={name:"Accordion",namespace:"accordion",debug:!1,verbose:!0,performance:!0,exclusive:!0,collapsible:!0,duration:500,easing:"easeInOutQuint",onOpen:function(){},onClose:function(){},onChange:function(){},error:{method:"The method you called is not defined"},className:{active:"active",menu:"menu"},selector:{title:".title",content:".content",menu:".menu",item:".item"}},a.extend(a.easing,{easeInOutQuint:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b*b+c:d/2*((b-=2)*b*b*b*b+2)+c}})}(jQuery,window,document),function(a){a.address=function(){var b,c,d=function(b){var c=a.extend(a.Event(b),function(){for(var b={},c=a.address.parameterNames(),d=0,e=c.length;d<e;d++)b[c[d]]=a.address.parameter(c[d]);return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:c,parameters:b,queryString:a.address.queryString()}}.call(a.address));return a(a.address).trigger(c),c},e=function(a){return Array.prototype.slice.call(a)},f=function(b,c,d){return a().bind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},g=function(b,c){return a().unbind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},h=function(){return Q.pushState&&J.state!==b},i=function(){return("/"+R.pathname.replace(new RegExp(J.state),"")+R.search+(j()?"#"+j():"")).replace(U,"/")},j=function(){var a=R.href.indexOf("#");return a!=-1?R.href.substr(a+1):""},k=function(){return h()?i():j()},l=function(){try{return top.document!==b&&top.document.title!==b&&top.jQuery!==b&&top.jQuery.address!==b&&top.jQuery.address.frames()!==!1?top:window}catch(a){return window}},m=function(){return"javascript"},n=function(a){return a=a.toString(),(J.strict&&"/"!=a.substr(0,1)?"/":"")+a},o=function(a,b){return parseInt(a.css(b),10)},p=function(){if(!$){var a=k(),b=decodeURI(ca)!=decodeURI(a);b&&(N&&L<7?R.reload():(N&&!W&&J.history&&T(s,50),ca=a,q(I)))}},q=function(a){return T(r,10),d(E).isDefaultPrevented()||d(a?F:G).isDefaultPrevented()},r=function(){if("null"!==J.tracker&&J.tracker!==z){var c=a.isFunction(J.tracker)?J.tracker:O[J.tracker],d=(R.pathname+R.search+(a.address&&!h()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");a.isFunction(c)?c(d):a.isFunction(O.urchinTracker)?O.urchinTracker(d):O.pageTracker!==b&&a.isFunction(O.pageTracker._trackPageview)?O.pageTracker._trackPageview(d):O._gaq!==b&&a.isFunction(O._gaq.push)?O._gaq.push(["_trackPageview",decodeURI(d)]):a.isFunction(O.ga)&&O.ga("send","pageview",d)}},s=function(){var a=m()+":"+I+";document.open();document.writeln('<html><head><title>"+P.title.replace(/\'/g,"\\'")+"</title><script>var "+A+' = "'+encodeURIComponent(k()).replace(/\'/g,"\\'")+(P.domain!=R.hostname?'";document.domain="'+P.domain:"")+"\";</script></head></html>');document.close();";L<7?c.src=a:c.contentWindow.location.replace(a)},t=function(){if(X&&Y!=-1){var a,b,c=X.substr(Y+1).split("&");for(a=0;a<c.length;a++)b=c[a].split("="),/^(autoUpdate|history|strict|wrap)$/.test(b[0])&&(J[b[0]]=isNaN(b[1])?/^(true|yes)$/i.test(b[1]):0!==parseInt(b[1],10)),/^(state|tracker)$/.test(b[0])&&(J[b[0]]=b[1]);X=z}ca=k()},u=function(){if(!_){if(_=H,t(),a('a[rel*="address:"]').address(),J.wrap){var e=a("body");a("body > *").wrapAll('<div style="padding:'+(o(e,"marginTop")+o(e,"paddingTop"))+"px "+(o(e,"marginRight")+o(e,"paddingRight"))+"px "+(o(e,"marginBottom")+o(e,"paddingBottom"))+"px "+(o(e,"marginLeft")+o(e,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+A+'" style="height:100%;overflow:auto;position:relative;'+(M&&!window.statusbar.visible?"resize:both;":"")+'" />');a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),M&&a('<style type="text/css" />').appendTo("head").text("#"+A+"::-webkit-resizer { background-color: #fff; }")}if(N&&!W){var f=P.getElementsByTagName("frameset")[0];c=P.createElement((f?"":"i")+"frame"),c.src=m()+":"+I,f?(f.insertAdjacentElement("beforeEnd",c),f[f.cols?"cols":"rows"]+=",0",c.noResize=H,c.frameBorder=c.frameSpacing=0):(c.style.display="none",c.style.width=c.style.height=0,c.tabIndex=-1,P.body.insertAdjacentElement("afterBegin",c)),T(function(){a(c).bind("load",function(){var a=c.contentWindow;ca=a[A]!==b?a[A]:"",ca!=k()&&(q(I),R.hash=ca)}),c.contentWindow[A]===b&&s()},50)}T(function(){d("init"),q(I)},1),h()||(N&&L>7||!N&&W?O.addEventListener?O.addEventListener(C,p,I):O.attachEvent&&O.attachEvent("on"+C,p):S(p,50)),"state"in window.history&&a(window).trigger("popstate")}},v=function(){decodeURI(ca)!=decodeURI(k())&&(ca=k(),q(I))},w=function(){O.removeEventListener?O.removeEventListener(C,p,I):O.detachEvent&&O.detachEvent("on"+C,p)},x=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},y=function(){var a={},b=x(navigator.userAgent);return b.browser&&(a[b.browser]=!0,a.version=b.version),a.chrome?a.webkit=!0:a.webkit&&(a.safari=!0),a},z=null,A="jQueryAddress",B="string",C="hashchange",D="init",E="change",F="internalChange",G="externalChange",H=!0,I=!1,J={autoUpdate:H,history:H,strict:H,frames:H,wrap:I},K=y(),L=parseFloat(K.version),M=K.webkit||K.safari,N=!a.support.opacity,O=l(),P=O.document,Q=O.history,R=O.location,S=setInterval,T=setTimeout,U=/\/{2,9}/g,V=navigator.userAgent,W="on"+C in O,X=a("script:last").attr("src"),Y=X?X.indexOf("?"):-1,Z=P.title,$=I,_=I,aa=H,ba=I,ca=k();if(N){L=parseFloat(V.substr(V.indexOf("MSIE")+4)),P.documentMode&&P.documentMode!=L&&(L=8!=P.documentMode?7:8);var da=P.onpropertychange;P.onpropertychange=function(){da&&da.call(P),P.title!=Z&&P.title.indexOf("#"+k())!=-1&&(P.title=Z)}}if(Q.navigationMode&&(Q.navigationMode="compatible"),"complete"==document.readyState)var ea=setInterval(function(){a.address&&(u(),clearInterval(ea))},50);else t(),a(u);return a(window).bind("popstate",v).bind("unload",w),{bind:function(a,b,c){return f.apply(this,e(arguments))},unbind:function(a,b){return g.apply(this,e(arguments))},init:function(a,b){return f.apply(this,[D].concat(e(arguments)))},change:function(a,b){return f.apply(this,[E].concat(e(arguments)))},internalChange:function(a,b){return f.apply(this,[F].concat(e(arguments)))},externalChange:function(a,b){return f.apply(this,[G].concat(e(arguments)))},baseURL:function(){var a=R.href;return a.indexOf("#")!=-1&&(a=a.substr(0,a.indexOf("#"))),/\/$/.test(a)&&(a=a.substr(0,a.length-1)),a},autoUpdate:function(a){return a!==b?(J.autoUpdate=a,this):J.autoUpdate},history:function(a){return a!==b?(J.history=a,this):J.history},state:function(a){if(a!==b){J.state=a;var c=i();return J.state!==b&&(Q.pushState?"/#/"==c.substr(0,3)&&R.replace(J.state.replace(/^\/$/,"")+c.substr(2)):"/"!=c&&c.replace(/^\/#/,"")!=j()&&T(function(){R.replace(J.state.replace(/^\/$/,"")+"/#"+c)},1)),this}return J.state},frames:function(a){return a!==b?(J.frames=a,O=l(),this):J.frames},strict:function(a){return a!==b?(J.strict=a,this):J.strict},tracker:function(a){return a!==b?(J.tracker=a,this):J.tracker},wrap:function(a){return a!==b?(J.wrap=a,this):J.wrap},update:function(){return ba=H,this.value(ca),ba=I,this},title:function(a){return a!==b?(T(function(){Z=P.title=a,aa&&c&&c.contentWindow&&c.contentWindow.document&&(c.contentWindow.document.title=a,aa=I)},50),this):P.title},value:function(a){if(a!==b){if(a=n(a),"/"==a&&(a=""),ca==a&&!ba)return;if(ca=a,J.autoUpdate||ba){if(q(H))return this;h()?Q[J.history?"pushState":"replaceState"]({},"",J.state.replace(/\/$/,"")+(""===ca?"/":ca)):($=H,M?J.history?R.hash="#"+ca:R.replace("#"+ca):ca!=k()&&(J.history?R.hash="#"+ca:R.replace("#"+ca)),N&&!W&&J.history&&T(s,50),M?T(function(){$=I},1):$=I)}return this}return n(ca)},path:function(a){if(a!==b){var c=this.queryString(),d=this.hash();return this.value(a+(c?"?"+c:"")+(d?"#"+d:"")),this}return n(ca).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(U,"/").split("/");return"/"!=a.substr(0,1)&&0!==a.length||b.splice(0,1),"/"==a.substr(a.length-1,1)&&b.splice(b.length-1,1),b},queryString:function(a){if(a!==b){var c=this.hash();return this.value(this.path()+(a?"?"+a:"")+(c?"#"+c:"")),this}var d=ca.split("?");return d.slice(1,d.length).join("?").split("#")[0]},parameter:function(c,d,e){var f,g;if(d!==b){var h=this.parameterNames();for(g=[],d=d===b||d===z?"":d.toString(),f=0;f<h.length;f++){var i=h[f],j=this.parameter(i);typeof j==B&&(j=[j]),i==c&&(j=d===z||""===d?[]:e?j.concat([d]):[d]);for(var k=0;k<j.length;k++)g.push(i+"="+j[k])}return a.inArray(c,h)==-1&&d!==z&&""!==d&&g.push(c+"="+d),this.queryString(g.join("&")),this}if(d=this.queryString()){var l=[];for(g=d.split("&"),f=0;f<g.length;f++){var m=g[f].split("=");m[0]==c&&l.push(m.slice(1).join("="))}if(0!==l.length)return 1!=l.length?l:l[0]}},parameterNames:function(){var b=this.queryString(),c=[];if(b&&b.indexOf("=")!=-1)for(var d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("=")[0];a.inArray(f,c)==-1&&c.push(f)}return c},hash:function(a){if(a!==b)return this.value(ca.split("#")[0]+(a?"#"+a:"")),this;var c=ca.split("#");return c.slice(1,c.length).join("#")}}}(),a.fn.address=function(b){return a(this).each(function(c){a(this).data("address")||a(this).on("click",function(c){if(c.shiftKey||c.ctrlKey||c.metaKey||2==c.which)return!0;var d=c.currentTarget;if(a(d).is("a")){c.preventDefault();var e=b?b.call(d):/address:/.test(a(d).attr("rel"))?a(d).attr("rel").split("address:")[1].split(" ")[0]:void 0===a.address.state()||/^\/?$/.test(a.address.state())?a(d).attr("href").replace(/^(#\!?|\.)/,""):a(d).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),"");a.address.value(e)}}).on("submit",function(c){var d=c.currentTarget;if(a(d).is("form")){c.preventDefault();var e=a(d).attr("action"),f=b?b.call(d):(e.indexOf("?")!=-1?e.replace(/&$/,""):e+"?")+a(d).serialize();a.address.value(f)}}).data("address",!0)}),this}}(jQuery),function(a,b,c,d){a.fn.tab=function(c){var e,f,g,h,i,j=a.extend(!0,{},a.fn.tab.settings,c),k=a(this),l=a(j.context).find(j.selector.tabs),m=k.selector||"",n={},o=!0,p=0,q=this,r=(new Date).getTime(),s=[],t=j.className,u=j.metadata,v=j.error,w="."+j.namespace,x="module-"+j.namespace,y=k.data(x),z=arguments[0],A=y!==d&&"string"==typeof z,B=[].slice.call(arguments,1);return h={initialize:function(){if(h.debug("Initializing Tabs",k),j.auto&&(h.verbose("Setting up automatic tab retrieval from server"),j.apiSettings={url:j.path+"/{$tab}"}),j.history){if(h.debug("Initializing page state"),a.address===d)return h.error(v.state),!1;if("hash"==j.historyType&&h.debug("Using hash state change to manage state"),"html5"==j.historyType){if(h.debug("Using HTML5 to manage state"),j.path===!1)return h.error(v.path),!1;a.address.history(!0).state(j.path)}a.address.unbind("change").bind("change",h.event.history.change)}a.isWindow(q)||(h.debug("Attaching tab activation events to element",k),k.on("click"+w,h.event.click)),h.instantiate()},instantiate:function(){h.verbose("Storing instance of module",h),k.data(x,h)},destroy:function(){h.debug("Destroying tabs",k),k.removeData(x).off(w)},event:{click:function(b){var c=a(this).data(u.tab);c!==d?(j.history?(h.verbose("Updating page state",b),a.address.value(c)):(h.verbose("Changing tab without state management",b),h.changeTab(c)),b.preventDefault()):h.debug("No tab specified")},history:{change:function(b){var c=b.pathNames.join("/")||h.get.initialPath(),e=j.templates.determineTitle(c)||!1;h.debug("History change event",c,b),g=b,c!==d&&h.changeTab(c),e&&a.address.title(e)}}},refresh:function(){e&&(h.debug("Refreshing tab",e),h.changeTab(e))},cache:{read:function(a){return a!==d&&n[a]},add:function(a,b){a=a||e,h.debug("Adding cached content for",a),n[a]=b},remove:function(a){a=a||e,h.debug("Removing cached content for",a),delete n[a]}},set:{state:function(b){a.address.value(b)}},changeTab:function(c){var d=b.history&&b.history.pushState,i=d&&j.ignoreFirstLoad&&o,k=j.auto||a.isPlainObject(j.apiSettings),l=k&&!i?h.utilities.pathToArray(c):h.get.defaultPathArray(c);c=h.utilities.arrayToPath(l),h.deactivate.all(),a.each(l,function(b,d){var m,n,p,q=l.slice(0,b+1),r=h.utilities.arrayToPath(q),s=h.is.tab(r),t=b+1==l.length,u=h.get.tabElement(r);return h.verbose("Looking for tab",d),s?(h.verbose("Tab was found",d),e=r,f=h.utilities.filterArray(l,q),t?p=!0:(m=l.slice(0,b+2),n=h.utilities.arrayToPath(m),p=!h.is.tab(n),p&&h.verbose("Tab parameters found",m)),p&&k?(i?(h.debug("Ignoring remote content on first tab load",r),o=!1,h.cache.add(c,u.html()),h.activate.all(r),a.proxy(j.onTabInit,u)(r,f,g),a.proxy(j.onTabLoad,u)(r,f,g)):(h.activate.navigation(r),h.content.fetch(r,c)),!1):(h.debug("Opened local tab",r),h.activate.all(r),h.cache.read(r)||(h.cache.add(r,!0),h.debug("First time tab loaded calling tab init"),a.proxy(j.onTabInit,u)(r,f,g)),a.proxy(j.onTabLoad,u)(r,f,g),void 0)):(h.error(v.missingTab,d),!1)})},content:{fetch:function(b,c){var i,k,l=h.get.tabElement(b),m={dataType:"html",stateContext:l,success:function(d){h.cache.add(c,d),h.content.update(b,d),b==e?(h.debug("Content loaded",b),h.activate.tab(b)):h.debug("Content loaded in background",b),a.proxy(j.onTabInit,l)(b,f,g),a.proxy(j.onTabLoad,l)(b,f,g)},urlData:{tab:c}},n=l.data(u.promise)||!1,o=n&&"pending"===n.state();c=c||b,k=h.cache.read(c),j.cache&&k?(h.debug("Showing existing content",c),h.content.update(b,k),h.activate.tab(b),a.proxy(j.onTabLoad,l)(b,f,g)):o?(h.debug("Content is already loading",c),l.addClass(t.loading)):a.api!==d?(console.log(j.apiSettings),i=a.extend(!0,{headers:{"X-Remote":!0}},j.apiSettings,m),h.debug("Retrieving remote content",c,i),a.api(i)):h.error(v.api)},update:function(a,b){h.debug("Updating html for",a);var c=h.get.tabElement(a);c.html(b)}},activate:{all:function(a){h.activate.tab(a),h.activate.navigation(a)},tab:function(a){var b=h.get.tabElement(a);h.verbose("Showing tab content for",b),b.addClass(t.active)},navigation:function(a){var b=h.get.navElement(a);h.verbose("Activating tab navigation for",b,a),b.addClass(t.active)}},deactivate:{all:function(){h.deactivate.navigation(),h.deactivate.tabs()},navigation:function(){k.removeClass(t.active)},tabs:function(){l.removeClass(t.active+" "+t.loading)}},is:{tab:function(a){return a!==d&&h.get.tabElement(a).size()>0}},get:{initialPath:function(){return k.eq(0).data(u.tab)||l.eq(0).data(u.tab)},path:function(){return a.address.value()},defaultPathArray:function(a){return h.utilities.pathToArray(h.get.defaultPath(a))},defaultPath:function(a){var b=k.filter("[data-"+u.tab+'^="'+a+'/"]').eq(0),c=b.data(u.tab)||!1;if(c){if(h.debug("Found default tab",c),p<j.maxDepth)return p++,h.get.defaultPath(c);h.error(v.recursion)}else h.debug("No default tabs found for",a,l);return p=0,a},navElement:function(a){return a=a||e,k.filter("[data-"+u.tab+'="'+a+'"]')},tabElement:function(a){var b,c,d,f;return a=a||e,d=h.utilities.pathToArray(a),f=h.utilities.last(d),b=l.filter("[data-"+u.tab+'="'+f+'"]'),c=l.filter("[data-"+u.tab+'="'+a+'"]'),b.size()>0?b:c},tab:function(){return e}},utilities:{filterArray:function(b,c){return a.grep(b,function(b){return a.inArray(b,c)==-1})},last:function(b){return!!a.isArray(b)&&b[b.length-1]},pathToArray:function(a){return a===d&&(a=e),"string"==typeof a?a.split("/"):[a]},arrayToPath:function(b){return!!a.isArray(b)&&b.join("/")}},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,j,b);else{if(c===d)return j[b];j[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,h,b);else{if(c===d)return h[b];h[b]=c}},debug:function(){j.debug&&(j.performance?h.performance.log(arguments):(h.debug=Function.prototype.bind.call(console.info,console,j.name+":"),h.debug.apply(console,arguments)))},verbose:function(){j.verbose&&j.debug&&(j.performance?h.performance.log(arguments):(h.verbose=Function.prototype.bind.call(console.info,console,j.name+":"),h.verbose.apply(console,arguments)))},error:function(){h.error=Function.prototype.bind.call(console.error,console,j.name+":"),h.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;j.performance&&(b=(new Date).getTime(),d=r||b,c=b-d,r=b,s.push({Element:q,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(h.performance.timer),h.performance.timer=setTimeout(h.performance.display,100)},display:function(){var b=j.name+":",c=0;r=!1,clearTimeout(h.performance.timer),a.each(s,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",m&&(b+=" '"+m+"'"),(console.group!==d||console.table!==d)&&s.length>0&&(console.groupCollapsed(b),console.table?console.table(s):a.each(s,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),s=[]}},invoke:function(b,c,e){var f,g,h,j=y;return c=c||B,e=q||e,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),f=b.length-1,a.each(b,function(c,e){var h=c!=f?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[h])&&c!=f)j=j[h];else{if(j[h]!==d)return g=j[h],!1;if(!a.isPlainObject(j[e])||c==f)return j[e]!==d&&(g=j[e],!1);j=j[e]}})),a.isFunction(g)?h=g.apply(e,c):g!==d&&(h=g),a.isArray(i)?i.push(h):i!==d?i=[i,h]:h!==d&&(i=h),g}},A?(y===d&&h.initialize(),h.invoke(z)):(y!==d&&h.destroy(),h.initialize()),i!==d?i:this},a.tab=function(c){a(b).tab(c)},a.fn.tab.settings={name:"Tab",debug:!1,verbose:!0,performance:!0,namespace:"tab",onTabInit:function(a,b,c){},onTabLoad:function(a,b,c){},templates:{determineTitle:function(a){}},auto:!1,history:!0,historyType:"hash",path:!1,context:"body",maxDepth:25,ignoreFirstLoad:!1,alwaysRefresh:!1,cache:!0,apiSettings:!1,error:{api:"You attempted to load content without API module",method:"The method you called is not defined",missingTab:"Tab cannot be found",noContent:"The tab you specified is missing a content url.",path:"History enabled, but no path was specified",recursion:"Max recursive depth reached",state:"The state library has not been initialized"},metadata:{tab:"tab",loaded:"loaded",promise:"promise"},className:{loading:"loading",active:"active"},selector:{tabs:".ui.tab"}}}(jQuery,window,document),function(a,b,c,d){a.fn.sidebar=function(b){var e,f=a(this),g=a("body"),h=a("head"),i=f.selector||"",j=(new Date).getTime(),k=[],l=arguments[0],m="string"==typeof l,n=[].slice.call(arguments,1);return f.each(function(){var o,p=a.isPlainObject(b)?a.extend(!0,{},a.fn.sidebar.settings,b):a.extend({},a.fn.sidebar.settings),q=p.selector,r=p.className,s=p.namespace,t=p.error,u="."+s,v="module-"+s,w=a(this),x=a("style[title="+s+"]"),y=this,z=w.data(v);o={initialize:function(){o.debug("Initializing sidebar",w),o.instantiate()},instantiate:function(){o.verbose("Storing instance of module",o),z=o,w.data(v,o)},destroy:function(){o.verbose("Destroying previous module for",w),w.off(u).removeData(v)},refresh:function(){o.verbose("Refreshing selector cache"),x=a("style[title="+s+"]")},attachEvents:function(b,c){var d=a(b);c=a.isFunction(o[c])?o[c]:o.toggle,d.size()>0?(o.debug("Attaching sidebar events to element",b,c),d.off(u).on("click"+u,c)):o.error(t.notFound)},show:function(b){b=a.isFunction(b)?b:function(){},o.debug("Showing sidebar",b),o.is.closed()?(p.overlay||(p.exclusive&&o.hideAll(),o.pushPage()),o.set.active(),b(),a.proxy(p.onChange,y)(),a.proxy(p.onShow,y)()):o.debug("Sidebar is already visible")},hide:function(b){b=a.isFunction(b)?b:function(){},o.debug("Hiding sidebar",b),o.is.open()&&(p.overlay||(o.pullPage(),o.remove.pushed()),o.remove.active(),b(),a.proxy(p.onChange,y)(),a.proxy(p.onHide,y)())},hideAll:function(){a(q.sidebar).filter(":visible").sidebar("hide")},toggle:function(){o.is.closed()?o.show():o.hide()},pushPage:function(){var a=o.get.direction(),b=o.is.vertical()?w.outerHeight():w.outerWidth();p.useCSS?(o.debug("Using CSS to animate body"),o.add.bodyCSS(a,b),o.set.pushed()):o.animatePage(a,b,o.set.pushed)},pullPage:function(){var a=o.get.direction();p.useCSS?(o.debug("Resetting body position css"),o.remove.bodyCSS()):(o.debug("Resetting body position using javascript"),o.animatePage(a,0)),o.remove.pushed()},animatePage:function(a,b){var c={};c["padding-"+a]=b,o.debug("Using javascript to animate body",c),g.animate(c,p.duration,o.set.pushed)},add:{bodyCSS:function(a,b){var c;a!==r.bottom&&(c='<style title="'+s+'">body.pushed {  margin-'+a+": "+b+"px !important;}</style>"),h.append(c),o.debug("Adding body css to head",x)}},remove:{bodyCSS:function(){o.debug("Removing body css styles",x),o.refresh(),x.remove()},active:function(){w.removeClass(r.active)},pushed:function(){o.verbose("Removing body push state",o.get.direction()),g.removeClass(r[o.get.direction()]).removeClass(r.pushed)}},set:{active:function(){w.addClass(r.active)},pushed:function(){o.verbose("Adding body push state",o.get.direction()),g.addClass(r[o.get.direction()]).addClass(r.pushed)}},get:{direction:function(){return w.hasClass(r.top)?r.top:w.hasClass(r.right)?r.right:w.hasClass(r.bottom)?r.bottom:r.left},transitionEvent:function(){var a,b=c.createElement("element"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in e)if(b.style[a]!==d)return e[a]}},is:{open:function(){return w.is(":animated")||w.hasClass(r.active)},closed:function(){return!o.is.open()},vertical:function(){return w.hasClass(r.top)}},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,p,b);else{if(c===d)return p[b];p[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,o,b);else{if(c===d)return o[b];o[b]=c}},debug:function(){p.debug&&(p.performance?o.performance.log(arguments):(o.debug=Function.prototype.bind.call(console.info,console,p.name+":"),o.debug.apply(console,arguments)))},verbose:function(){p.verbose&&p.debug&&(p.performance?o.performance.log(arguments):(o.verbose=Function.prototype.bind.call(console.info,console,p.name+":"),o.verbose.apply(console,arguments)))},error:function(){o.error=Function.prototype.bind.call(console.error,console,p.name+":"),o.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;p.performance&&(b=(new Date).getTime(),d=j||b,c=b-d,j=b,k.push({Element:y,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(o.performance.timer),o.performance.timer=setTimeout(o.performance.display,100)},display:function(){var b=p.name+":",c=0;j=!1,clearTimeout(o.performance.timer),a.each(k,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",i&&(b+=" '"+i+"'"),f.size()>1&&(b+=" ("+f.size()+")"),(console.group!==d||console.table!==d)&&k.length>0&&(console.groupCollapsed(b),console.table?console.table(k):a.each(k,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),k=[]}},invoke:function(b,c,f){var g,h,i,j=z;return c=c||n,f=y||f,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d&&(h=j[e],!1);j=j[e]}})),a.isFunction(h)?i=h.apply(f,c):h!==d&&(i=h),a.isArray(e)?e.push(i):e!==d?e=[e,i]:i!==d&&(e=i),h}},m?(z===d&&o.initialize(),o.invoke(l)):(z!==d&&o.destroy(),o.initialize())}),e!==d?e:this},a.fn.sidebar.settings={name:"Sidebar",namespace:"sidebar",debug:!1,verbose:!0,performance:!0,useCSS:!0,exclusive:!0,overlay:!1,duration:300,onChange:function(){},onShow:function(){},onHide:function(){},className:{active:"active",pushed:"pushed",top:"top",left:"left",right:"right",bottom:"bottom"},selector:{sidebar:".ui.sidebar"},error:{method:"The method you called is not defined.",notFound:"There were no elements that matched the specified selector"}}}(jQuery,window,document),function(a,b,c,d){a.fn.popup=function(e){var f,g=a(this),h=a(c),i=g.selector||"",j=(new Date).getTime(),k=[],l=arguments[0],m="string"==typeof l,n=[].slice.call(arguments,1);return g.each(function(){var c,g=a.isPlainObject(e)?a.extend(!0,{},a.fn.popup.settings,e):a.extend({},a.fn.popup.settings),o=g.selector,p=g.className,q=g.error,r=g.metadata,s=g.namespace,t="."+g.namespace,u="module-"+s,v=a(this),w=a(g.context),x=g.target?a(g.target):v,y=a(b),z=g.inline?x.offsetParent():y,A=g.inline?x.next(g.selector.popup):y.children(g.selector.popup).last(),B=0,C=this,D=v.data(u);c={initialize:function(){c.debug("Initializing module",v),"click"==g.on?v.on("click",c.toggle):v.on(c.get.startEvent()+t,c.event.start).on(c.get.endEvent()+t,c.event.end),g.target&&c.debug("Target set to element",x),y.on("resize"+t,c.event.resize),c.instantiate()},instantiate:function(){c.verbose("Storing instance of module",c),D=c,v.data(u,D)},refresh:function(){g.inline?(A=x.next(o.popup),z=x.offsetParent()):A=y.children(o.popup).last()},destroy:function(){c.debug("Destroying previous module"),y.off(t),A.remove(),v.off(t).removeData(u)},event:{start:function(a){c.timer=setTimeout(function(){c.is.hidden()&&c.show()},g.delay)},end:function(){clearTimeout(c.timer),c.is.visible()&&c.hide()},resize:function(){c.is.visible()&&c.set.position()}},create:function(){c.debug("Creating pop-up html");var b=v.data(r.html)||g.html,d=v.data(r.variation)||g.variation,e=v.data(r.title)||g.title,f=v.data(r.content)||v.attr("title")||g.content;b||f||e?(b||(b=g.template({title:e,content:f})),A=a("<div/>").addClass(p.popup).addClass(d).html(b),g.inline?(c.verbose("Inserting popup element inline",A),A.data(u,D).insertAfter(v)):(c.verbose("Appending popup element to body",A),A.data(u,D).appendTo(w)),a.proxy(g.onCreate,A)()):c.error(q.content)},toggle:function(){c.debug("Toggling pop-up"),c.is.hidden()?(c.debug("Popup is hidden, showing pop-up"),c.unbind.close(),c.hideAll(),c.show()):(c.debug("Popup is visible, hiding pop-up"),c.hide())},show:function(a){a=a||function(){},c.debug("Showing pop-up",g.transition),g.preserve||c.refresh(),c.exists()||c.create(),c.save.conditions(),c.set.position(),c.animate.show(a)},hide:function(a){a=a||function(){},v.removeClass(p.visible),c.restore.conditions(),c.unbind.close(),c.is.visible()&&c.animate.hide(a)},hideAll:function(){a(o.popup).filter(":visible").popup("hide")},hideGracefully:function(b){b&&0===a(b.target).closest(o.popup).size()?(c.debug("Click occurred outside popup hiding popup"),c.hide()):c.debug("Click was inside popup, keeping popup open")},exists:function(){return g.inline?0!==A.size():A.parent(w).size()},remove:function(){c.debug("Removing popup"),A.remove(),a.proxy(g.onRemove,A)()},save:{conditions:function(){c.cache={title:v.attr("title")},c.cache.title&&v.removeAttr("title"),c.verbose("Saving original attributes",c.cache.title)}},restore:{conditions:function(){return c.cache&&c.cache.title&&(v.attr("title",c.cache.title),c.verbose("Restoring original attributes",c.cache.title)),!0}},animate:{show:function(b){b=b||function(){},v.addClass(p.visible),g.transition&&a.fn.transition!==d&&v.transition("is supported")?A.transition(g.transition+" in",g.duration,function(){c.bind.close(),a.proxy(b,C)()}):A.stop().fadeIn(g.duration,g.easing,function(){c.bind.close(),a.proxy(b,C)()}),a.proxy(g.onShow,C)()},hide:function(b){b=b||function(){},c.debug("Hiding pop-up"),g.transition&&a.fn.transition!==d&&v.transition("is supported")?A.transition(g.transition+" out",g.duration,function(){c.reset(),b()}):A.stop().fadeOut(g.duration,g.easing,function(){c.reset(),b()}),a.proxy(g.onHide,C)()}},get:{startEvent:function(){return"hover"==g.on?"mouseenter":"focus"==g.on?"focus":void 0},endEvent:function(){return"hover"==g.on?"mouseleave":"focus"==g.on?"blur":void 0},offstagePosition:function(){var d={top:a(b).scrollTop(),bottom:a(b).scrollTop()+a(b).height(),left:0,right:a(b).width()},e={width:A.width(),height:A.outerHeight(),position:A.offset()},f={},g=[];return e.position&&(f={top:e.position.top<d.top,bottom:e.position.top+e.height>d.bottom,right:e.position.left+e.width>d.right,left:e.position.left<d.left}),c.verbose("Checking if outside viewable area",e.position),a.each(f,function(a,b){b&&g.push(a)}),g.length>0&&g.join(" ")},nextPosition:function(a){switch(a){case"top left":a="bottom left";break;case"bottom left":a="top right";break;case"top right":a="bottom right";break;case"bottom right":a="top center";break;case"top center":a="bottom center";break;case"bottom center":a="right center";break;case"right center":a="left center";break;case"left center":a="top center"}return a}},set:{position:function(d,e){var f,h,i=(a(b).width(),a(b).height(),x.outerWidth()),j=x.outerHeight(),k=A.width(),l=A.outerHeight(),m=z.outerWidth(),n=z.outerHeight(),o=g.distanceAway,s=g.inline?x.position():x.offset();switch(d=d||v.data(r.position)||g.position,e=e||v.data(r.offset)||g.offset,g.inline&&("left center"==d||"right center"==d?(e+=parseInt(b.getComputedStyle(C).getPropertyValue("margin-top"),10),o+=-parseInt(b.getComputedStyle(C).getPropertyValue("margin-left"),10)):(e+=parseInt(b.getComputedStyle(C).getPropertyValue("margin-left"),10),o+=parseInt(b.getComputedStyle(C).getPropertyValue("margin-top"),10))),c.debug("Calculating offset for position",d),d){case"top left":f={bottom:n-s.top+o,right:m-s.left-e,top:"auto",left:"auto"};break;case"top center":f={bottom:n-s.top+o,left:s.left+i/2-k/2+e,top:"auto",right:"auto"};break;case"top right":f={top:"auto",bottom:n-s.top+o,left:s.left+i+e,right:"auto"};break;case"left center":f={top:s.top+j/2-l/2+e,right:m-s.left+o,left:"auto",bottom:"auto"};break;case"right center":f={top:s.top+j/2-l/2+e,left:s.left+i+o,bottom:"auto",right:"auto"};break;case"bottom left":f={top:s.top+j+o,right:m-s.left-e,left:"auto",bottom:"auto"};break;case"bottom center":f={top:s.top+j+o,left:s.left+i/2-k/2+e,bottom:"auto",right:"auto"};break;case"bottom right":f={top:s.top+j+o,left:s.left+i+e,bottom:"auto",right:"auto"}}return A.css(f).removeClass(p.position).addClass(d).addClass(p.loading),h=c.get.offstagePosition(),h?(c.debug("Element is outside boundaries",h),B<g.maxSearchDepth?(d=c.get.nextPosition(d),B++,c.debug("Trying new position",d),c.set.position(d)):(c.error(q.recursion),B=0,c.reset(),A.removeClass(p.loading),!1)):(c.debug("Position is on stage",d),B=0,A.removeClass(p.loading),!0)}},bind:{close:function(){"click"==g.on&&g.closable&&(c.verbose("Binding popup close event to document"),
h.on("click"+t,function(b){c.verbose("Pop-up clickaway intent detected"),a.proxy(c.hideGracefully,this)(b)}))}},unbind:{close:function(){"click"==g.on&&g.closable&&(c.verbose("Removing close event from document"),h.off("click"+t))}},is:{animating:function(){return A.is(":animated")||A.hasClass(p.animating)},visible:function(){return A.is(":visible")},hidden:function(){return!c.is.visible()}},reset:function(){A.attr("style","").removeAttr("style"),g.preserve||c.remove()},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,g,b);else{if(c===d)return g[b];g[b]=c}},internal:function(b,e){if(a.isPlainObject(b))a.extend(!0,c,b);else{if(e===d)return c[b];c[b]=e}},debug:function(){g.debug&&(g.performance?c.performance.log(arguments):(c.debug=Function.prototype.bind.call(console.info,console,g.name+":"),c.debug.apply(console,arguments)))},verbose:function(){g.verbose&&g.debug&&(g.performance?c.performance.log(arguments):(c.verbose=Function.prototype.bind.call(console.info,console,g.name+":"),c.verbose.apply(console,arguments)))},error:function(){c.error=Function.prototype.bind.call(console.error,console,g.name+":"),c.error.apply(console,arguments)},performance:{log:function(a){var b,d,e;g.performance&&(b=(new Date).getTime(),e=j||b,d=b-e,j=b,k.push({Element:C,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":d})),clearTimeout(c.performance.timer),c.performance.timer=setTimeout(c.performance.display,100)},display:function(){var b=g.name+":",e=0;j=!1,clearTimeout(c.performance.timer),a.each(k,function(a,b){e+=b["Execution Time"]}),b+=" "+e+"ms",i&&(b+=" '"+i+"'"),(console.group!==d||console.table!==d)&&k.length>0&&(console.groupCollapsed(b),console.table?console.table(k):a.each(k,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),k=[]}},invoke:function(b,c,e){var g,h,i,j=D;return c=c||n,e=C||e,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d&&(h=j[e],!1);j=j[e]}})),a.isFunction(h)?i=h.apply(e,c):h!==d&&(i=h),a.isArray(f)?f.push(i):f!==d?f=[f,i]:i!==d&&(f=i),h}},m?(D===d&&c.initialize(),c.invoke(l)):(D!==d&&c.destroy(),c.initialize())}),f!==d?f:this},a.fn.popup.settings={name:"Popup",debug:!1,verbose:!0,performance:!0,namespace:"popup",onCreate:function(){},onRemove:function(){},onShow:function(){},onHide:function(){},variation:"",content:!1,html:!1,title:!1,on:"hover",target:!1,closable:!0,context:"body",position:"top center",delay:150,inline:!1,preserve:!1,duration:250,easing:"easeOutQuad",transition:"scale",distanceAway:0,offset:0,maxSearchDepth:10,error:{content:"Your popup has no content specified",method:"The method you called is not defined.",recursion:"Popup attempted to reposition element to fit, but could not find an adequate position."},metadata:{content:"content",html:"html",offset:"offset",position:"position",title:"title",variation:"variation"},className:{animating:"animating",loading:"loading",popup:"ui popup",position:"top left center bottom right",visible:"visible"},selector:{popup:".ui.popup"},template:function(a){var b="";return typeof a!==d&&(typeof a.title!==d&&a.title&&(b+='<div class="header">'+a.title+'</div class="header">'),typeof a.content!==d&&a.content&&(b+='<div class="content">'+a.content+"</div>")),b}},a.extend(a.easing,{easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c}})}(jQuery,window,document),function(a,b,c,d){a.fn.form=function(b,e){var f,g=a(this),h=a.extend(!0,{},a.fn.form.settings,e),i=a.extend({},a.fn.form.settings.defaults,b),j=h.namespace,k=h.metadata,l=h.selector,m=h.className,n=(h.error,"."+j),o="module-"+j,p=g.selector||"",q=(new Date).getTime(),r=[],s=arguments[0],t="string"==typeof s,u=[].slice.call(arguments,1);return g.each(function(){var b,e=a(this),j=a(this).find(l.field),v=a(this).find(l.group),w=a(this).find(l.message),x=(a(this).find(l.prompt),a(this).find(l.submit)),y=[],z=this,A=e.data(o);b={initialize:function(){b.verbose("Initializing form validation",e,i,h),b.bindEvents(),b.instantiate()},instantiate:function(){b.verbose("Storing instance of module",b),A=b,e.data(o,b)},destroy:function(){b.verbose("Destroying previous module",A),b.removeEvents(),e.removeData(o)},refresh:function(){b.verbose("Refreshing selector cache"),j=e.find(l.field)},submit:function(){b.verbose("Submitting form",e),e.submit()},bindEvents:function(){h.keyboardShortcuts&&j.on("keydown"+n,b.event.field.keydown),e.on("submit"+n,b.validate.form),j.on("blur"+n,b.event.field.blur),x.on("click"+n,b.submit),j.each(function(){var c=a(this).prop("type"),d=b.get.changeEvent(c);a(this).on(d+n,b.event.field.change)})},removeEvents:function(){e.off(n),j.off(n),x.off(n),j.off(n)},event:{field:{keydown:function(c){var d=a(this),e=c.which,f={enter:13,escape:27};if(e==f.escape&&(b.verbose("Escape key pressed blurring field"),d.blur()),!c.ctrlKey&&e==f.enter&&d.is(l.input))return b.debug("Enter key pressed, submitting form"),x.addClass(m.down),d.one("keyup"+n,b.event.field.keyup),c.preventDefault(),!1},keyup:function(){b.verbose("Doing keyboard shortcut form submit"),x.removeClass(m.down),b.submit()},blur:function(){var c=a(this),d=c.closest(v);d.hasClass(m.error)?(b.debug("Revalidating field",c,b.get.validation(c)),b.validate.field(b.get.validation(c))):"blur"!=h.on&&"change"!=h.on||b.validate.field(b.get.validation(c))},change:function(){var c=a(this),d=c.closest(v);("change"==h.on||d.hasClass(m.error)&&h.revalidate)&&(clearTimeout(b.timer),b.timer=setTimeout(function(){b.debug("Revalidating field",c,b.get.validation(c)),b.validate.field(b.get.validation(c))},h.delay))}}},get:{changeEvent:function(a){return"checkbox"==a||"radio"==a||"hidden"==a?"change":c.createElement("input").oninput!==d?"input":c.createElement("input").onpropertychange!==d?"propertychange":"keyup"},field:function(c){return b.verbose("Finding field with identifier",c),j.filter("#"+c).size()>0?j.filter("#"+c):j.filter('[name="'+c+'"]').size()>0?j.filter('[name="'+c+'"]'):j.filter("[data-"+k.validate+'="'+c+'"]').size()>0?j.filter("[data-"+k.validate+'="'+c+'"]'):a("<input/>")},validation:function(c){var d;return a.each(i,function(a,e){b.get.field(e.identifier).get(0)==c.get(0)&&(d=e)}),d||!1}},has:{field:function(a){return b.verbose("Checking for existence of a field with identifier",a),j.filter("#"+a).size()>0||(j.filter('[name="'+a+'"]').size()>0||j.filter("[data-"+k.validate+'="'+a+'"]').size()>0)}},add:{prompt:function(c,f){var g=b.get.field(c),i=g.closest(v),j=i.find(l.prompt),k=0!==j.size();f="string"==typeof f?[f]:f,b.verbose("Adding field error state",c),i.addClass(m.error),h.inline&&(k||(j=h.templates.prompt(f),j.appendTo(i)),j.html(f[0]),k?b.verbose("Inline errors are disabled, no inline error added",c):h.transition&&a.fn.transition!==d&&e.transition("is supported")?(b.verbose("Displaying error with css transition",h.transition),j.transition(h.transition+" in",h.duration)):(b.verbose("Displaying error with fallback javascript animation"),j.fadeIn(h.duration)))},errors:function(a){b.debug("Adding form error messages",a),w.html(h.templates.error(a))}},remove:{prompt:function(c){var f=b.get.field(c.identifier),g=f.closest(v),i=g.find(l.prompt);g.removeClass(m.error),h.inline&&i.is(":visible")&&(b.verbose("Removing prompt for field",c),h.transition&&a.fn.transition!==d&&e.transition("is supported")?i.transition(h.transition+" out",h.duration,function(){i.remove()}):i.fadeOut(h.duration,function(){i.remove()}))}},validate:{form:function(c){var d=!0;return y=[],a.each(i,function(a,c){b.validate.field(c)||(d=!1)}),d?(b.debug("Form has no validation errors, submitting"),e.removeClass(m.error).addClass(m.success),a.proxy(h.onSuccess,this)(c)):(b.debug("Form has errors"),e.addClass(m.error),h.inline||b.add.errors(y),a.proxy(h.onFailure,this)(y))},field:function(c){var e=b.get.field(c.identifier),f=!0,g=[];return c.rules!==d&&a.each(c.rules,function(a,d){b.has.field(c.identifier)&&!b.validate.rule(c,d)&&(b.debug("Field is invalid",c.identifier,d.type),g.push(d.prompt),f=!1)}),f?(b.remove.prompt(c,g),a.proxy(h.onValid,e)(),!0):(y=y.concat(g),b.add.prompt(c.identifier,g),a.proxy(h.onInvalid,e)(g),!1)},rule:function(c,f){var g,i,j=b.get.field(c.identifier),k=f.type,l=a.trim(j.val()+""),m=/\[(.*)\]/i,n=m.exec(k),o=!0;return n!==d&&null!==n?(g=""+n[1],i=k.replace(n[0],""),o=a.proxy(h.rules[i],e)(l,g)):o=a.proxy(h.rules[k],j)(l),o}},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,h,b);else{if(c===d)return h[b];h[b]=c}},internal:function(c,e){if(a.isPlainObject(c))a.extend(!0,b,c);else{if(e===d)return b[c];b[c]=e}},debug:function(){h.debug&&(h.performance?b.performance.log(arguments):(b.debug=Function.prototype.bind.call(console.info,console,h.name+":"),b.debug.apply(console,arguments)))},verbose:function(){h.verbose&&h.debug&&(h.performance?b.performance.log(arguments):(b.verbose=Function.prototype.bind.call(console.info,console,h.name+":"),b.verbose.apply(console,arguments)))},error:function(){b.error=Function.prototype.bind.call(console.error,console,h.name+":"),b.error.apply(console,arguments)},performance:{log:function(a){var c,d,e;h.performance&&(c=(new Date).getTime(),e=q||c,d=c-e,q=c,r.push({Element:z,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":d})),clearTimeout(b.performance.timer),b.performance.timer=setTimeout(b.performance.display,100)},display:function(){var c=h.name+":",e=0;q=!1,clearTimeout(b.performance.timer),a.each(r,function(a,b){e+=b["Execution Time"]}),c+=" "+e+"ms",p&&(c+=" '"+p+"'"),g.size()>1&&(c+=" ("+g.size()+")"),(console.group!==d||console.table!==d)&&r.length>0&&(console.groupCollapsed(c),console.table?console.table(r):a.each(r,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),r=[]}},invoke:function(b,c,e){var g,h,i,j=A;return c=c||u,e=z||e,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d&&(h=j[e],!1);j=j[e]}})),a.isFunction(h)?i=h.apply(e,c):h!==d&&(i=h),a.isArray(f)?f.push(i):f!==d?f=[f,i]:i!==d&&(f=i),h}},t?(A===d&&b.initialize(),b.invoke(s)):(A!==d&&b.destroy(),b.initialize())}),f!==d?f:this},a.fn.form.settings={name:"Form",namespace:"form",debug:!0,verbose:!0,performance:!0,keyboardShortcuts:!0,on:"submit",inline:!1,delay:200,revalidate:!0,transition:"scale",duration:150,onValid:function(){},onInvalid:function(){},onSuccess:function(){return!0},onFailure:function(){return!1},metadata:{validate:"validate"},selector:{message:".error.message",field:"input, textarea, select",group:".field",input:"input",prompt:".prompt",submit:'.submit:not([type="submit"])'},className:{error:"error",success:"success",down:"down",label:"ui label prompt"},error:{method:"The method you called is not defined."},templates:{error:function(b){var c='<ul class="list">';return a.each(b,function(a,b){c+="<li>"+b+"</li>"}),c+="</ul>",a(c)},prompt:function(b){return a("<div/>").addClass("ui red pointing prompt label").html(b[0])}},rules:{checked:function(){return a(this).filter(":checked").size()>0},empty:function(a){return!(a===d||""===a)},email:function(a){var b=new RegExp("[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?","i");return b.test(a)},length:function(a,b){return a!==d&&a.length>=b},not:function(a,b){return a!=b},contains:function(a,b){return b=b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),a.search(b)!==-1},is:function(a,b){return a==b},maxLength:function(a,b){return a!==d&&a.length<=b},match:function(b,c){var e,f=a(this);return f.find("#"+c).size()>0?e=f.find("#"+c).val():f.find("[name="+c+"]").size()>0?e=f.find("[name="+c+"]").val():f.find('[data-validate="'+c+'"]').size()>0&&(e=f.find('[data-validate="'+c+'"]').val()),e!==d&&b.toString()==e.toString()},url:function(a){var b=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return b.test(a)}}}}(jQuery,window,document),function(a){a.fn.formToWizard=function(b){function c(b){a("#steps div").removeClass("active"),a("#stepDesc"+b).addClass("active")}function d(b){for(var d=0;d<g;d++)a("#step"+d).hide();a("#step"+b).show(),c(b)}b=a.extend({submitButton:"",prevLbl:"Précédent",nextLbl:"Suivant"},b);var e=this,f=a(e).find("fieldset"),g=f.size(),h="#"+b.submitButton;a(h).hide(),a(e).before("<div class='ui steps' id='steps'></div>"),f.each(function(b){0==b?disabled="":disabled="disabled",a(this).wrap("<div id='step"+b+"'></div>"),a(this).append("<div id='step"+b+"commands' class='ui'></div>");var e=a(this).find("legend").html();a(this).find("legend").hide(),a("#steps").append("<div class='ui step "+disabled+"' id='stepDesc"+b+"'>"+(b+1)+". <span>"+e+"</span></div>"),a("#stepDesc"+b).bind("click",function(){a(this).hasClass("disabled")||d(b)}),0==b?c(b):b==g-1?a("#step"+b).hide():a("#step"+b).hide()})}}(jQuery),function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,!(!b.href||!f||"map"!==e.nodeName.toLowerCase())&&(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g))):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,f=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c){var d,e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(d=0;d<e.length;d++)a.options[e[d][0]]&&e[d][1].apply(a.element,c)}},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0||(b[d]=1,e=b[d]>0,b[d]=0,e)}})}(jQuery),function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(a){}e(b)},a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g)},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;h<i;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(a.isPlainObject(f)?c[e]=a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):c[e]=f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,h?this.each(function(){var d,e=a.data(this,f);return e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}):this.each(function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;g<e.length-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),1===arguments.length)return f[c]===b?null:f[c];f[c]=d}else{if(1===arguments.length)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){if(b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled"))return("string"==typeof g?f[g]:g).apply(f,arguments)}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(jQuery),function(a,b){var c=!1;a(document).mouseup(function(){c=!1}),a.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(!c){this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=1===b.which,f=!("string"!=typeof this.options.cancel||!b.target.nodeName)&&a(b.target).closest(this.options.cancel).length;return!(e&&!f&&this._mouseCapture(b))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(b)!==!1,!this._mouseStarted)?(b.preventDefault(),!0):(!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0,!0))}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a,b){function c(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function d(b,c){return parseInt(a.css(b,c),10)||0}function e(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(f!==b)return f;var c,d,e=a("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),g=e.children()[0];return a("body").append(e),c=g.offsetWidth,e.css("overflow","scroll"),d=g.offsetWidth,c===d&&(d=e[0].clientWidth),e.remove(),f=c-d},getScrollInfo:function(b){var c=b.isWindow||b.isDocument?"":b.element.css("overflow-x"),d=b.isWindow||b.isDocument?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]),e=!!c[0]&&9===c[0].nodeType;return{element:c,isWindow:d,isDocument:e,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d?c.width():c.outerWidth(),height:d?c.height():c.outerHeight()}}},a.fn.position=function(b){if(!b||!b.of)return o.apply(this,arguments);b=a.extend({},b);var f,n,p,q,r,s,t=a(b.of),u=a.position.getWithinInfo(b.within),v=a.position.getScrollInfo(u),w=(b.collision||"flip").split(" "),x={};return s=e(t),t[0].preventDefault&&(b.at="left top"),n=s.width,p=s.height,q=s.offset,r=a.extend({},q),a.each(["my","at"],function(){var a,c,d=(b[this]||"").split(" ");1===d.length&&(d=j.test(d[0])?d.concat(["center"]):k.test(d[0])?["center"].concat(d):["center","center"]),d[0]=j.test(d[0])?d[0]:"center",d[1]=k.test(d[1])?d[1]:"center",a=l.exec(d[0]),c=l.exec(d[1]),x[this]=[a?a[0]:0,c?c[0]:0],b[this]=[m.exec(d[0])[0],m.exec(d[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===b.at[0]?r.left+=n:"center"===b.at[0]&&(r.left+=n/2),"bottom"===b.at[1]?r.top+=p:"center"===b.at[1]&&(r.top+=p/2),f=c(x.at,n,p),r.left+=f[0],r.top+=f[1],this.each(function(){var e,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=d(this,"marginLeft"),s=d(this,"marginTop"),y=l+o+d(this,"marginRight")+v.width,z=m+s+d(this,"marginBottom")+v.height,A=a.extend({},r),B=c(x.my,k.outerWidth(),k.outerHeight());"right"===b.my[0]?A.left-=l:"center"===b.my[0]&&(A.left-=l/2),"bottom"===b.my[1]?A.top-=m:"center"===b.my[1]&&(A.top-=m/2),A.left+=B[0],A.top+=B[1],a.support.offsetFractions||(A.left=i(A.left),A.top=i(A.top)),e={marginLeft:o,marginTop:s},a.each(["left","top"],function(c,d){a.ui.position[w[c]]&&a.ui.position[w[c]][d](A,{targetWidth:n,targetHeight:p,elemWidth:l,elemHeight:m,collisionPosition:e,collisionWidth:y,collisionHeight:z,offset:[f[0]+B[0],f[1]+B[1]],my:b.my,at:b.at,within:u,elem:k})}),b.using&&(j=function(a){var c=q.left-A.left,d=c+n-l,e=q.top-A.top,f=e+p-m,i={target:{element:t,left:q.left,top:q.top,width:n,height:p},element:{element:k,left:A.left,top:A.top,width:l,height:m},horizontal:d<0?"left":c>0?"right":"center",vertical:f<0?"top":e>0?"bottom":"middle"};n<l&&h(c+d)<n&&(i.horizontal="center"),p<m&&h(e+f)<p&&(i.vertical="middle"),g(h(c),h(d))>g(h(e),h(f))?i.important="horizontal":i.important="vertical",b.using.call(this,a,i)}),k.offset(a.extend(A,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&j<=0?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):j>0&&i<=0?a.left=e:i>j?a.left=e+f-b.collisionWidth:a.left=e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&j<=0?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):j>0&&i<=0?a.top=e:i>j?a.top=e+f-b.collisionHeight:a.top=e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];k<0?(c=a.left+m+n+o+b.collisionWidth-g-f,(c<0||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];k<0?(d=a.top+n+o+p+b.collisionHeight-g-f,a.top+n+o+p>k&&(d<0||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,a.top+n+o+p>l&&(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){
a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,f,g=document.getElementsByTagName("body")[0],h=document.createElement("div");b=document.createElement(g?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},g&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(f in d)b.style[f]=d[f];b.appendChild(h),c=g||document.documentElement,c.insertBefore(b,c.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",e=a(h).offset().left,a.support.offsetFractions=e>10&&e<11,b.innerHTML="",c.removeChild(b)}()}(jQuery),function(a,b){a.widget("ui.draggable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(b){var c=this.options;return!(this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(b),!!this.handle&&(a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0))},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),!("original"===this.options.helper&&!a.contains(this.element[0].ownerDocument,this.element[0]))&&("invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1)},_mouseUp:function(b){return a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return!this.options.handle||!!a(b.target).closest(this.element.find(this.options.handle)).length},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d[0]===this.element[0]||/(fixed|absolute)/.test(d.css("position"))||d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;return e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(document).width()-this.helperProportions.width-this.margins.left,(a(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],void(d&&(b="hidden"!==c.css("overflow"),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c))):void(this.containment=null)},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:e.scrollTop(),left:e.scrollLeft()}),{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*d}},_generatePosition:function(b){var c,d,e,f,g=this.options,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=b.pageX,j=b.pageY;return this.offset.scroll||(this.offset.scroll={top:h.scrollTop(),left:h.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(d=this.relative_container.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,b.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),b.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),b.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),b.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),"drag"===b&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("ui-draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"ui-sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("ui-draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,"original"===d.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("ui-draggable"),e=this;a.each(d.sortables,function(){var f=!1,g=this;this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(f=!0,a.each(d.sortables,function(){return this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this!==g&&this.instance._intersectsWith(this.instance.containerCache)&&a.contains(g.instance.element[0],this.instance.element[0])&&(f=!1),f})),f?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(){var b=a("body"),c=a(this).data("ui-draggable").options;b.css("cursor")&&(c._cursor=b.css("cursor")),b.css("cursor",c.cursor)},stop:function(){var b=a(this).data("ui-draggable").options;b._cursor&&a("body").css("cursor",b._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("ui-draggable");b.scrollParent[0]!==document&&"HTML"!==b.scrollParent[0].tagName&&(b.overflowOffset=b.scrollParent.offset())},drag:function(b){var c=a(this).data("ui-draggable"),d=c.options,e=!1;c.scrollParent[0]!==document&&"HTML"!==c.scrollParent[0].tagName?(d.axis&&"x"===d.axis||(c.overflowOffset.top+c.scrollParent[0].offsetHeight-b.pageY<d.scrollSensitivity?c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop+d.scrollSpeed:b.pageY-c.overflowOffset.top<d.scrollSensitivity&&(c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop-d.scrollSpeed)),d.axis&&"y"===d.axis||(c.overflowOffset.left+c.scrollParent[0].offsetWidth-b.pageX<d.scrollSensitivity?c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft+d.scrollSpeed:b.pageX-c.overflowOffset.left<d.scrollSensitivity&&(c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft-d.scrollSpeed))):(d.axis&&"x"===d.axis||(b.pageY-a(document).scrollTop()<d.scrollSensitivity?e=a(document).scrollTop(a(document).scrollTop()-d.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<d.scrollSensitivity&&(e=a(document).scrollTop(a(document).scrollTop()+d.scrollSpeed))),d.axis&&"y"===d.axis||(b.pageX-a(document).scrollLeft()<d.scrollSensitivity?e=a(document).scrollLeft(a(document).scrollLeft()-d.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<d.scrollSensitivity&&(e=a(document).scrollLeft(a(document).scrollLeft()+d.scrollSpeed)))),e!==!1&&a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,b)}}),a.ui.plugin.add("draggable","snap",{start:function(){var b=a(this).data("ui-draggable"),c=b.options;b.snapElements=[],a(c.snap.constructor!==String?c.snap.items||":data(ui-draggable)":c.snap).each(function(){var c=a(this),d=c.offset();this!==b.element[0]&&b.snapElements.push({item:this,width:c.outerWidth(),height:c.outerHeight(),top:d.top,left:d.left})})},drag:function(b,c){var d,e,f,g,h,i,j,k,l,m,n=a(this).data("ui-draggable"),o=n.options,p=o.snapTolerance,q=c.offset.left,r=q+n.helperProportions.width,s=c.offset.top,t=s+n.helperProportions.height;for(l=n.snapElements.length-1;l>=0;l--)h=n.snapElements[l].left,i=h+n.snapElements[l].width,j=n.snapElements[l].top,k=j+n.snapElements[l].height,r<h-p||q>i+p||t<j-p||s>k+p||!a.contains(n.snapElements[l].item.ownerDocument,n.snapElements[l].item)?(n.snapElements[l].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=!1):("inner"!==o.snapMode&&(d=Math.abs(j-t)<=p,e=Math.abs(k-s)<=p,f=Math.abs(h-r)<=p,g=Math.abs(i-q)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j-n.helperProportions.height,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i}).left-n.margins.left)),m=d||e||f||g,"outer"!==o.snapMode&&(d=Math.abs(j-s)<=p,e=Math.abs(k-t)<=p,f=Math.abs(h-q)<=p,g=Math.abs(i-r)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k-n.helperProportions.height,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i-n.helperProportions.width}).left-n.margins.left)),!n.snapElements[l].snapping&&(d||e||f||g||m)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=d||e||f||g||m)}}),a.ui.plugin.add("draggable","stack",{start:function(){var b,c=this.data("ui-draggable").options,d=a.makeArray(a(c.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});d.length&&(b=parseInt(a(d[0]).css("zIndex"),10)||0,a(d).each(function(c){a(this).css("zIndex",b+c)}),this.css("zIndex",b+d.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})}(jQuery),function(a,b){function c(a,b,c){return a>b&&a<b+c}a.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var b,c=this.options,d=c.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(d)?d:function(a){return a.is(d)},this.proportions=function(){return arguments.length?void(b=arguments[0]):b?b:b={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},a.ui.ddmanager.droppables[c.scope]=a.ui.ddmanager.droppables[c.scope]||[],a.ui.ddmanager.droppables[c.scope].push(this),c.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var b=0,c=a.ui.ddmanager.droppables[this.options.scope];b<c.length;b++)c[b]===this&&c.splice(b,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(b,c){"accept"===b&&(this.accept=a.isFunction(c)?c:function(a){return a.is(c)}),a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current,e=!1;return!(!d||(d.currentItem||d.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var b=a.data(this,"ui-droppable");if(b.options.greedy&&!b.options.disabled&&b.options.scope===d.options.scope&&b.accept.call(b.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(b,{offset:b.element.offset()}),b.options.tolerance))return e=!0,!1}),!e&&(!!this.accept.call(this.element[0],d.currentItem||d.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element)))},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.ui.intersect=function(a,b,d){if(!b.offset)return!1;var e,f,g=(a.positionAbs||a.position.absolute).left,h=(a.positionAbs||a.position.absolute).top,i=g+a.helperProportions.width,j=h+a.helperProportions.height,k=b.offset.left,l=b.offset.top,m=k+b.proportions().width,n=l+b.proportions().height;switch(d){case"fit":return k<=g&&i<=m&&l<=h&&j<=n;case"intersect":return k<g+a.helperProportions.width/2&&i-a.helperProportions.width/2<m&&l<h+a.helperProportions.height/2&&j-a.helperProportions.height/2<n;case"pointer":return e=(a.positionAbs||a.position.absolute).left+(a.clickOffset||a.offset.click).left,f=(a.positionAbs||a.position.absolute).top+(a.clickOffset||a.offset.click).top,c(f,l,b.proportions().height)&&c(e,k,b.proportions().width);case"touch":return(h>=l&&h<=n||j>=l&&j<=n||h<l&&j>n)&&(g>=k&&g<=m||i>=k&&i<=m||g<k&&i>m);default:return!1}},a.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(b,c){var d,e,f=a.ui.ddmanager.droppables[b.options.scope]||[],g=c?c.type:null,h=(b.currentItem||b.element).find(":data(ui-droppable)").addBack();a:for(d=0;d<f.length;d++)if(!(f[d].options.disabled||b&&!f[d].accept.call(f[d].element[0],b.currentItem||b.element))){for(e=0;e<h.length;e++)if(h[e]===f[d].element[0]){f[d].proportions().height=0;continue a}f[d].visible="none"!==f[d].element.css("display"),f[d].visible&&("mousedown"===g&&f[d]._activate.call(f[d],c),f[d].offset=f[d].element.offset(),f[d].proportions({width:f[d].element[0].offsetWidth,height:f[d].element[0].offsetHeight}))}},drop:function(b,c){var d=!1;return a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,c)))}),d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var d,e,f,g=a.ui.intersect(b,this,this.options.tolerance),h=!g&&this.isover?"isout":g&&!this.isover?"isover":null;h&&(this.options.greedy&&(e=this.options.scope,f=this.element.parents(":data(ui-droppable)").filter(function(){return a.data(this,"ui-droppable").options.scope===e}),f.length&&(d=a.data(f[0],"ui-droppable"),d.greedyChild="isover"===h)),d&&"isover"===h&&(d.isover=!1,d.isout=!0,d._out.call(d,c)),this[h]=!0,this["isout"===h?"isover":"isout"]=!1,this["isover"===h?"_over":"_out"].call(this,c),d&&"isout"===h&&(d.isout=!1,d.isover=!0,d._over.call(d,c)))}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}}}(jQuery),function(a,b){function c(a){return parseInt(a,10)||0}function d(a){return!isNaN(parseInt(a,10))}a.widget("ui.resizable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var b,c,d,e,f,g=this,h=this.options;if(this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(a("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=h.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),b=this.handles.split(","),this.handles={},c=0;c<b.length;c++)d=a.trim(b[c]),f="ui-resizable-"+d,e=a("<div class='ui-resizable-handle "+f+"'></div>"),e.css({zIndex:h.zIndex}),"se"===d&&e.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[d]=".ui-resizable-"+d,this.element.append(e);this._renderAxis=function(b){var c,d,e,f;b=b||this.element;for(c in this.handles)this.handles[c].constructor===String&&(this.handles[c]=a(this.handles[c],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(d=a(this.handles[c],this.element),f=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),e=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),b.css(e,f),this._proportionallyResize()),a(this.handles[c]).length},this._renderAxis(this.element),this._handles=a(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){g.resizing||(this.className&&(e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),g.axis=e&&e[1]?e[1]:"se")}),h.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").mouseenter(function(){h.disabled||(a(this).removeClass("ui-resizable-autohide"),g._handles.show())}).mouseleave(function(){h.disabled||g.resizing||(a(this).addClass("ui-resizable-autohide"),g._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var b,c=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(c(this.element),b=this.element,this.originalElement.css({position:b.css("position"),width:b.outerWidth(),height:b.outerHeight(),top:b.css("top"),left:b.css("left")}).insertAfter(b),b.remove()),this.originalElement.css("resize",this.originalResizeStyle),c(this.originalElement),this},_mouseCapture:function(b){var c,d,e=!1;for(c in this.handles)d=a(this.handles[c])[0],(d===b.target||a.contains(d,b.target))&&(e=!0);return!this.options.disabled&&e},_mouseStart:function(b){var d,e,f,g=this.options,h=this.element.position(),i=this.element;return this.resizing=!0,/absolute/.test(i.css("position"))?i.css({position:"absolute",top:i.css("top"),left:i.css("left")}):i.is(".ui-draggable")&&i.css({position:"absolute",top:h.top,left:h.left}),this._renderProxy(),d=c(this.helper.css("left")),e=c(this.helper.css("top")),g.containment&&(d+=a(g.containment).scrollLeft()||0,e+=a(g.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:d,top:e},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:i.width(),height:i.height()},this.originalSize=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()},this.originalPosition={left:d,top:e},this.sizeDiff={width:i.outerWidth()-i.width(),height:i.outerHeight()-i.height()},this.originalMousePosition={left:b.pageX,top:b.pageY},this.aspectRatio="number"==typeof g.aspectRatio?g.aspectRatio:this.originalSize.width/this.originalSize.height||1,f=a(".ui-resizable-"+this.axis).css("cursor"),a("body").css("cursor","auto"===f?this.axis+"-resize":f),i.addClass("ui-resizable-resizing"),this._propagate("start",b),!0},_mouseDrag:function(b){var c,d=this.helper,e={},f=this.originalMousePosition,g=this.axis,h=this.position.top,i=this.position.left,j=this.size.width,k=this.size.height,l=b.pageX-f.left||0,m=b.pageY-f.top||0,n=this._change[g];return!!n&&(c=n.apply(this,[b,l,m]),this._updateVirtualBoundaries(b.shiftKey),(this._aspectRatio||b.shiftKey)&&(c=this._updateRatio(c,b)),c=this._respectSize(c,b),this._updateCache(c),this._propagate("resize",b),this.position.top!==h&&(e.top=this.position.top+"px"),this.position.left!==i&&(e.left=this.position.left+"px"),this.size.width!==j&&(e.width=this.size.width+"px"),this.size.height!==k&&(e.height=this.size.height+"px"),d.css(e),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),a.isEmptyObject(e)||this._trigger("resize",b,this.ui()),!1)},_mouseStop:function(b){this.resizing=!1;var c,d,e,f,g,h,i,j=this.options,k=this;return this._helper&&(c=this._proportionallyResizeElements,d=c.length&&/textarea/i.test(c[0].nodeName),e=d&&a.ui.hasScroll(c[0],"left")?0:k.sizeDiff.height,f=d?0:k.sizeDiff.width,g={width:k.helper.width()-f,height:k.helper.height()-e},h=parseInt(k.element.css("left"),10)+(k.position.left-k.originalPosition.left)||null,i=parseInt(k.element.css("top"),10)+(k.position.top-k.originalPosition.top)||null,j.animate||this.element.css(a.extend(g,{top:i,left:h})),k.helper.height(k.size.height),k.helper.width(k.size.width),this._helper&&!j.animate&&this._proportionallyResize()),a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(a){
var b,c,e,f,g,h=this.options;g={minWidth:d(h.minWidth)?h.minWidth:0,maxWidth:d(h.maxWidth)?h.maxWidth:1/0,minHeight:d(h.minHeight)?h.minHeight:0,maxHeight:d(h.maxHeight)?h.maxHeight:1/0},(this._aspectRatio||a)&&(b=g.minHeight*this.aspectRatio,e=g.minWidth/this.aspectRatio,c=g.maxHeight*this.aspectRatio,f=g.maxWidth/this.aspectRatio,b>g.minWidth&&(g.minWidth=b),e>g.minHeight&&(g.minHeight=e),c<g.maxWidth&&(g.maxWidth=c),f<g.maxHeight&&(g.maxHeight=f)),this._vBoundaries=g},_updateCache:function(a){this.offset=this.helper.offset(),d(a.left)&&(this.position.left=a.left),d(a.top)&&(this.position.top=a.top),d(a.height)&&(this.size.height=a.height),d(a.width)&&(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,c=this.size,e=this.axis;return d(a.height)?a.width=a.height*this.aspectRatio:d(a.width)&&(a.height=a.width/this.aspectRatio),"sw"===e&&(a.left=b.left+(c.width-a.width),a.top=null),"nw"===e&&(a.top=b.top+(c.height-a.height),a.left=b.left+(c.width-a.width)),a},_respectSize:function(a){var b=this._vBoundaries,c=this.axis,e=d(a.width)&&b.maxWidth&&b.maxWidth<a.width,f=d(a.height)&&b.maxHeight&&b.maxHeight<a.height,g=d(a.width)&&b.minWidth&&b.minWidth>a.width,h=d(a.height)&&b.minHeight&&b.minHeight>a.height,i=this.originalPosition.left+this.originalSize.width,j=this.position.top+this.size.height,k=/sw|nw|w/.test(c),l=/nw|ne|n/.test(c);return g&&(a.width=b.minWidth),h&&(a.height=b.minHeight),e&&(a.width=b.maxWidth),f&&(a.height=b.maxHeight),g&&k&&(a.left=i-b.minWidth),e&&k&&(a.left=i-b.maxWidth),h&&l&&(a.top=j-b.minHeight),f&&l&&(a.top=j-b.maxHeight),a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null,a},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var a,b,c,d,e,f=this.helper||this.element;for(a=0;a<this._proportionallyResizeElements.length;a++){if(e=this._proportionallyResizeElements[a],!this.borderDif)for(this.borderDif=[],c=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],d=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")],b=0;b<c.length;b++)this.borderDif[b]=(parseInt(c[b],10)||0)+(parseInt(d[b],10)||0);e.css({height:f.height()-this.borderDif[0]-this.borderDif[2]||0,width:f.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset(),this._helper?(this.helper=this.helper||a("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){var c=this.originalSize,d=this.originalPosition;return{left:d.left+b,width:c.width-b}},n:function(a,b,c){var d=this.originalSize,e=this.originalPosition;return{top:e.top+c,height:d.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),"resize"!==b&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.ui.plugin.add("resizable","animate",{stop:function(b){var c=a(this).data("ui-resizable"),d=c.options,e=c._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&a.ui.hasScroll(e[0],"left")?0:c.sizeDiff.height,h=f?0:c.sizeDiff.width,i={width:c.size.width-h,height:c.size.height-g},j=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,k=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;c.element.animate(a.extend(i,k&&j?{top:k,left:j}:{}),{duration:d.animateDuration,easing:d.animateEasing,step:function(){var d={width:parseInt(c.element.css("width"),10),height:parseInt(c.element.css("height"),10),top:parseInt(c.element.css("top"),10),left:parseInt(c.element.css("left"),10)};e&&e.length&&a(e[0]).css({width:d.width,height:d.height}),c._updateCache(d),c._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(){var b,d,e,f,g,h,i,j=a(this).data("ui-resizable"),k=j.options,l=j.element,m=k.containment,n=m instanceof a?m.get(0):/parent/.test(m)?l.parent().get(0):m;n&&(j.containerElement=a(n),/document/.test(m)||m===document?(j.containerOffset={left:0,top:0},j.containerPosition={left:0,top:0},j.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}):(b=a(n),d=[],a(["Top","Right","Left","Bottom"]).each(function(a,e){d[a]=c(b.css("padding"+e))}),j.containerOffset=b.offset(),j.containerPosition=b.position(),j.containerSize={height:b.innerHeight()-d[3],width:b.innerWidth()-d[1]},e=j.containerOffset,f=j.containerSize.height,g=j.containerSize.width,h=a.ui.hasScroll(n,"left")?n.scrollWidth:g,i=a.ui.hasScroll(n)?n.scrollHeight:f,j.parentData={element:n,left:e.left,top:e.top,width:h,height:i}))},resize:function(b){var c,d,e,f,g=a(this).data("ui-resizable"),h=g.options,i=g.containerOffset,j=g.position,k=g._aspectRatio||b.shiftKey,l={top:0,left:0},m=g.containerElement;m[0]!==document&&/static/.test(m.css("position"))&&(l=i),j.left<(g._helper?i.left:0)&&(g.size.width=g.size.width+(g._helper?g.position.left-i.left:g.position.left-l.left),k&&(g.size.height=g.size.width/g.aspectRatio),g.position.left=h.helper?i.left:0),j.top<(g._helper?i.top:0)&&(g.size.height=g.size.height+(g._helper?g.position.top-i.top:g.position.top),k&&(g.size.width=g.size.height*g.aspectRatio),g.position.top=g._helper?i.top:0),g.offset.left=g.parentData.left+g.position.left,g.offset.top=g.parentData.top+g.position.top,c=Math.abs((g._helper?g.offset.left-l.left:g.offset.left-l.left)+g.sizeDiff.width),d=Math.abs((g._helper?g.offset.top-l.top:g.offset.top-i.top)+g.sizeDiff.height),e=g.containerElement.get(0)===g.element.parent().get(0),f=/relative|absolute/.test(g.containerElement.css("position")),e&&f&&(c-=Math.abs(g.parentData.left)),c+g.size.width>=g.parentData.width&&(g.size.width=g.parentData.width-c,k&&(g.size.height=g.size.width/g.aspectRatio)),d+g.size.height>=g.parentData.height&&(g.size.height=g.parentData.height-d,k&&(g.size.width=g.size.height*g.aspectRatio))},stop:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.containerOffset,e=b.containerPosition,f=b.containerElement,g=a(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width,j=g.outerHeight()-b.sizeDiff.height;b._helper&&!c.animate&&/relative/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j}),b._helper&&!c.animate&&/static/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j})}}),a.ui.plugin.add("resizable","alsoResize",{start:function(){var b=a(this).data("ui-resizable"),c=b.options,d=function(b){a(b).each(function(){var b=a(this);b.data("ui-resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10)})})};"object"!=typeof c.alsoResize||c.alsoResize.parentNode?d(c.alsoResize):c.alsoResize.length?(c.alsoResize=c.alsoResize[0],d(c.alsoResize)):a.each(c.alsoResize,function(a){d(a)})},resize:function(b,c){var d=a(this).data("ui-resizable"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0},i=function(b,d){a(b).each(function(){var b=a(this),e=a(this).data("ui-resizable-alsoresize"),f={},g=d&&d.length?d:b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(g,function(a,b){var c=(e[b]||0)+(h[b]||0);c&&c>=0&&(f[b]=c||null)}),b.css(f)})};"object"!=typeof e.alsoResize||e.alsoResize.nodeType?i(e.alsoResize):a.each(e.alsoResize,function(a,b){i(a,b)})},stop:function(){a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","ghost",{start:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.size;b.ghost=b.originalElement.clone(),b.ghost.css({opacity:.25,display:"block",position:"relative",height:d.height,width:d.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof c.ghost?c.ghost:""),b.ghost.appendTo(b.helper)},resize:function(){var b=a(this).data("ui-resizable");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=a(this).data("ui-resizable");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.size,e=b.originalSize,f=b.originalPosition,g=b.axis,h="number"==typeof c.grid?[c.grid,c.grid]:c.grid,i=h[0]||1,j=h[1]||1,k=Math.round((d.width-e.width)/i)*i,l=Math.round((d.height-e.height)/j)*j,m=e.width+k,n=e.height+l,o=c.maxWidth&&c.maxWidth<m,p=c.maxHeight&&c.maxHeight<n,q=c.minWidth&&c.minWidth>m,r=c.minHeight&&c.minHeight>n;c.grid=h,q&&(m+=i),r&&(n+=j),o&&(m-=i),p&&(n-=j),/^(se|s|e)$/.test(g)?(b.size.width=m,b.size.height=n):/^(ne)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.top=f.top-l):/^(sw)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.left=f.left-k):(n-j>0?(b.size.height=n,b.position.top=f.top-l):(b.size.height=j,b.position.top=f.top+e.height-j),m-i>0?(b.size.width=m,b.position.left=f.left-k):(b.size.width=i,b.position.left=f.left+e.width-i))}})}(jQuery),function(a,b){a.widget("ui.selectable",a.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var b,c=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){b=a(c.options.filter,c.element[0]),b.addClass("ui-selectee"),b.each(function(){var b=a(this),c=b.offset();a.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=b.addClass("ui-selectee"),this._mouseInit(),this.helper=a("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(b){var c=this,d=this.options;this.opos=[b.pageX,b.pageY],this.options.disabled||(this.selectees=a(d.filter,this.element[0]),this._trigger("start",b),a(d.appendTo).append(this.helper),this.helper.css({left:b.pageX,top:b.pageY,width:0,height:0}),d.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var d=a.data(this,"selectable-item");d.startselected=!0,b.metaKey||b.ctrlKey||(d.$element.removeClass("ui-selected"),d.selected=!1,d.$element.addClass("ui-unselecting"),d.unselecting=!0,c._trigger("unselecting",b,{unselecting:d.element}))}),a(b.target).parents().addBack().each(function(){var d,e=a.data(this,"selectable-item");if(e)return d=!b.metaKey&&!b.ctrlKey||!e.$element.hasClass("ui-selected"),e.$element.removeClass(d?"ui-unselecting":"ui-selected").addClass(d?"ui-selecting":"ui-unselecting"),e.unselecting=!d,e.selecting=d,e.selected=d,d?c._trigger("selecting",b,{selecting:e.element}):c._trigger("unselecting",b,{unselecting:e.element}),!1}))},_mouseDrag:function(b){if(this.dragged=!0,!this.options.disabled){var c,d=this,e=this.options,f=this.opos[0],g=this.opos[1],h=b.pageX,i=b.pageY;return f>h&&(c=h,h=f,f=c),g>i&&(c=i,i=g,g=c),this.helper.css({left:f,top:g,width:h-f,height:i-g}),this.selectees.each(function(){var c=a.data(this,"selectable-item"),j=!1;c&&c.element!==d.element[0]&&("touch"===e.tolerance?j=!(c.left>h||c.right<f||c.top>i||c.bottom<g):"fit"===e.tolerance&&(j=c.left>f&&c.right<h&&c.top>g&&c.bottom<i),j?(c.selected&&(c.$element.removeClass("ui-selected"),c.selected=!1),c.unselecting&&(c.$element.removeClass("ui-unselecting"),c.unselecting=!1),c.selecting||(c.$element.addClass("ui-selecting"),c.selecting=!0,d._trigger("selecting",b,{selecting:c.element}))):(c.selecting&&((b.metaKey||b.ctrlKey)&&c.startselected?(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.$element.addClass("ui-selected"),c.selected=!0):(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.startselected&&(c.$element.addClass("ui-unselecting"),c.unselecting=!0),d._trigger("unselecting",b,{unselecting:c.element}))),c.selected&&(b.metaKey||b.ctrlKey||c.startselected||(c.$element.removeClass("ui-selected"),c.selected=!1,c.$element.addClass("ui-unselecting"),c.unselecting=!0,d._trigger("unselecting",b,{unselecting:c.element})))))}),!1}},_mouseStop:function(b){var c=this;return this.dragged=!1,a(".ui-unselecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-unselecting"),d.unselecting=!1,d.startselected=!1,c._trigger("unselected",b,{unselected:d.element})}),a(".ui-selecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected"),d.selecting=!1,d.selected=!0,d.startselected=!0,c._trigger("selected",b,{selected:d.element})}),this._trigger("stop",b),this.helper.remove(),!1}})}(jQuery),function(a,b){function c(a,b,c){return a>b&&a<b+c}function d(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}a.widget("ui.sortable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===a.axis||d(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){"disabled"===b?(this.options[b]=c,this.widget().toggleClass("ui-sortable-disabled",!!c)):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=null,e=!1,f=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(b),a(b.target).parents().each(function(){if(a.data(this,f.widgetName+"-item")===f)return d=a(this),!1}),a.data(b.target,f.widgetName+"-item")===f&&(d=a(b.target)),!!d&&(!(this.options.handle&&!c&&(a(this.options.handle,d).find("*").addBack().each(function(){this===b.target&&(e=!0)}),!e))&&(this.currentItem=d,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(b,c,d){var e,f,g=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),g.containment&&this._setContainment(),g.cursor&&"auto"!==g.cursor&&(f=this.document.find("body"),this.storedCursor=f.css("cursor"),f.css("cursor",g.cursor),this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(f)),g.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",g.opacity)),g.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",g.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var c,d,e,f,g=this.options,h=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+g.scrollSpeed:b.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-g.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+g.scrollSpeed:b.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-g.scrollSpeed)):(b.pageY-a(document).scrollTop()<g.scrollSensitivity?h=a(document).scrollTop(a(document).scrollTop()-g.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<g.scrollSensitivity&&(h=a(document).scrollTop(a(document).scrollTop()+g.scrollSpeed)),b.pageX-a(document).scrollLeft()<g.scrollSensitivity?h=a(document).scrollLeft(a(document).scrollLeft()-g.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<g.scrollSensitivity&&(h=a(document).scrollLeft(a(document).scrollLeft()+g.scrollSpeed))),h!==!1&&a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=d.item[0],f=this._intersectsWithPointer(d),f&&d.instance===this.currentContainer&&!(e===this.currentItem[0]||this.placeholder[1===f?"next":"prev"]()[0]===e||a.contains(this.placeholder[0],e)||"semi-dynamic"===this.options.type&&a.contains(this.element[0],e))){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d))break;this._rearrange(b,d),this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset(),f=this.options.axis,g={};f&&"x"!==f||(g.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),f&&"y"!==f||(g.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l="x"===this.options.axis||d+j>h&&d+j<i,m="y"===this.options.axis||b+k>f&&b+k<g,n=l&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?n:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(a){var b="x"===this.options.axis||c(this.positionAbs.top+this.offset.click.top,a.top,a.height),d="y"===this.options.axis||c(this.positionAbs.left+this.offset.click.left,a.left,a.width),e=b&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return!!e&&(this.floating?g&&"right"===g||"down"===f?2:1:f&&("down"===f?2:1))},_intersectsWithSides:function(a){var b=c(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),d=c(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?"right"===f&&d||"left"===f&&!d:e&&("down"===e&&b||"up"===e&&!b)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){function c(){h.push(this)}var d,e,f,g,h=[],i=[],j=this._connectWith();if(j&&b)for(d=j.length-1;d>=0;d--)for(f=a(j[d]),e=f.length-1;e>=0;e--)g=a.data(f[e],this.widgetFullName),g&&g!==this&&!g.options.disabled&&i.push([a.isFunction(g.options.items)?g.options.items.call(g.element):a(g.options.items,g.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),g]);for(i.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),d=i.length-1;d>=0;d--)i[d][0].each(c);return a(h)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c,d,e,f,g,h,i,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(c=m.length-1;c>=0;c--)for(e=a(m[c]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&(l.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],b,{item:this.currentItem}):a(f.options.items,f.element),f]),this.containers.push(f));for(c=l.length-1;c>=0;c--)for(g=l[c][1],h=l[c][0],d=0,j=h.length;d<j;d++)i=a(h[d]),i.data(this.widgetName+"-item",g),k.push({item:i,instance:g,width:0,height:0,left:0,top:0})},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var c,d,e,f;for(c=this.items.length-1;c>=0;c--)d=this.items[c],d.instance!==this.currentContainer&&this.currentContainer&&d.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item,b||(d.width=e.outerWidth(),d.height=e.outerHeight()),f=e.offset(),d.left=f.left,d.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){b=b||this;var c,d=b.options;d.placeholder&&d.placeholder.constructor!==String||(c=d.placeholder,d.placeholder={element:function(){var d=b.currentItem[0].nodeName.toLowerCase(),e=a("<"+d+">",b.document[0]).addClass(c||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===d?b.currentItem.children().each(function(){a("<td>&#160;</td>",b.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(e)}):"img"===d&&e.attr("src",b.currentItem.attr("src")),c||e.css("visibility","hidden"),e},update:function(a,e){c&&!d.forcePlaceholderSize||(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}),b.placeholder=a(d.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),d.placeholder.update(b,b.placeholder)},_contactContainers:function(b){var e,f,g,h,i,j,k,l,m,n,o=null,p=null;for(e=this.containers.length-1;e>=0;e--)if(!a.contains(this.currentItem[0],this.containers[e].element[0]))if(this._intersectsWith(this.containers[e].containerCache)){if(o&&a.contains(this.containers[e].element[0],o.element[0]))continue;o=this.containers[e],p=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",b,this._uiHash(this)),this.containers[e].containerCache.over=0);if(o)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",b,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(g=1e4,h=null,n=o.floating||d(this.currentItem),i=n?"left":"top",j=n?"width":"height",k=this.positionAbs[i]+this.offset.click[i],f=this.items.length-1;f>=0;f--)a.contains(this.containers[p].element[0],this.items[f].item[0])&&this.items[f].item[0]!==this.currentItem[0]&&(n&&!c(this.positionAbs.top+this.offset.click.top,this.items[f].top,this.items[f].height)||(l=this.items[f].item.offset()[i],m=!1,Math.abs(l-k)>Math.abs(l+this.items[f][j]-k)&&(m=!0,l+=this.items[f][j]),Math.abs(l-k)<g&&(g=Math.abs(l-k),h=this.items[f],this.direction=m?"up":"down")));if(!h&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return;h?this._rearrange(b,h,null,!0):this._rearrange(b,null,this.containers[p].element,!0),this._trigger("change",b,this._uiHash()),this.containers[p]._trigger("change",b,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",b,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"===c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!==c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),d[0].style.width&&!c.forceHelperSize||d.width(this.currentItem.width()),d[0].style.height&&!c.forceHelperSize||d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),"document"!==e.containment&&"window"!==e.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"===e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),
/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e=this.options,f=b.pageX,g=b.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),e.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-e.grid[1]:c+e.grid[1]:c,d=this.originalPageX+Math.round((f-this.originalPageX)/e.grid[0])*e.grid[0],f=this.containment?d-this.offset.click.left>=this.containment[0]&&d-this.offset.click.left<=this.containment[2]?d:d-this.offset.click.left>=this.containment[0]?d-e.grid[0]:d+e.grid[0]:d)),{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){function c(a,b,c){return function(d){c._trigger(a,d,b._uiHash(b))}}this.reverting=!1;var d,e=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(d in this._storedCSS)"auto"!==this._storedCSS[d]&&"static"!==this._storedCSS[d]||(this._storedCSS[d]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!b&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||b||e.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(b||(e.push(function(a){this._trigger("remove",a,this._uiHash())}),e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)))),d=this.containers.length-1;d>=0;d--)b||e.push(c("deactivate",this,this.containers[d])),this.containers[d].containerCache.over&&(e.push(c("out",this,this.containers[d])),this.containers[d].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!b){for(this._trigger("beforeStop",a,this._uiHash()),d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!1}if(b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!b){for(d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}(jQuery),function(a,b){var c="ui-effects-";a.effects={effect:{}},function(a,b){function c(a,b,c){var d=l[b.type]||{};return null==a?c||!b.def?null:b.def:(a=d.floor?~~a:parseFloat(a),isNaN(a)?b.def:d.mod?(a+d.mod)%d.mod:0>a?0:d.max<a?d.max:a)}function d(b){var c=j(),d=c._rgba=[];return b=b.toLowerCase(),o(i,function(a,e){var f,g=e.re.exec(b),h=g&&e.parse(g),i=e.space||"rgba";if(h)return f=c[i](h),c[k[i].cache]=f[k[i].cache],d=c._rgba=f._rgba,!1}),d.length?("0,0,0,0"===d.join()&&a.extend(d,f.transparent),c):f[b]}function e(a,b,c){return c=(c+1)%1,6*c<1?a+(b-a)*c*6:2*c<1?b:3*c<2?a+(b-a)*(2/3-c)*6:a}var f,g="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",h=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],j=a.Color=function(b,c,d,e){return new a.Color.fn.parse(b,c,d,e)},k={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},l={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},m=j.support={},n=a("<p>")[0],o=a.each;n.style.cssText="background-color:rgba(1,1,1,.5)",m.rgba=n.style.backgroundColor.indexOf("rgba")>-1,o(k,function(a,b){b.cache="_"+a,b.props.alpha={idx:3,type:"percent",def:1}}),j.fn=a.extend(j.prototype,{parse:function(e,g,h,i){if(e===b)return this._rgba=[null,null,null,null],this;(e.jquery||e.nodeType)&&(e=a(e).css(g),g=b);var l=this,m=a.type(e),n=this._rgba=[];return g!==b&&(e=[e,g,h,i],m="array"),"string"===m?this.parse(d(e)||f._default):"array"===m?(o(k.rgba.props,function(a,b){n[b.idx]=c(e[b.idx],b)}),this):"object"===m?(e instanceof j?o(k,function(a,b){e[b.cache]&&(l[b.cache]=e[b.cache].slice())}):o(k,function(b,d){var f=d.cache;o(d.props,function(a,b){if(!l[f]&&d.to){if("alpha"===a||null==e[a])return;l[f]=d.to(l._rgba)}l[f][b.idx]=c(e[a],b,!0)}),l[f]&&a.inArray(null,l[f].slice(0,3))<0&&(l[f][3]=1,d.from&&(l._rgba=d.from(l[f])))}),this):void 0},is:function(a){var b=j(a),c=!0,d=this;return o(k,function(a,e){var f,g=b[e.cache];return g&&(f=d[e.cache]||e.to&&e.to(d._rgba)||[],o(e.props,function(a,b){if(null!=g[b.idx])return c=g[b.idx]===f[b.idx]})),c}),c},_space:function(){var a=[],b=this;return o(k,function(c,d){b[d.cache]&&a.push(c)}),a.pop()},transition:function(a,b){var d=j(a),e=d._space(),f=k[e],g=0===this.alpha()?j("transparent"):this,h=g[f.cache]||f.to(g._rgba),i=h.slice();return d=d[f.cache],o(f.props,function(a,e){var f=e.idx,g=h[f],j=d[f],k=l[e.type]||{};null!==j&&(null===g?i[f]=j:(k.mod&&(j-g>k.mod/2?g+=k.mod:g-j>k.mod/2&&(g-=k.mod)),i[f]=c((j-g)*b+g,e)))}),this[e](i)},blend:function(b){if(1===this._rgba[3])return this;var c=this._rgba.slice(),d=c.pop(),e=j(b)._rgba;return j(a.map(c,function(a,b){return(1-d)*e[b]+d*a}))},toRgbaString:function(){var b="rgba(",c=a.map(this._rgba,function(a,b){return null==a?b>2?1:0:a});return 1===c[3]&&(c.pop(),b="rgb("),b+c.join()+")"},toHslaString:function(){var b="hsla(",c=a.map(this.hsla(),function(a,b){return null==a&&(a=b>2?1:0),b&&b<3&&(a=Math.round(100*a)+"%"),a});return 1===c[3]&&(c.pop(),b="hsl("),b+c.join()+")"},toHexString:function(b){var c=this._rgba.slice(),d=c.pop();return b&&c.push(~~(255*d)),"#"+a.map(c,function(a){return a=(a||0).toString(16),1===a.length?"0"+a:a}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),j.fn.parse.prototype=j.fn,k.hsla.to=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b,c,d=a[0]/255,e=a[1]/255,f=a[2]/255,g=a[3],h=Math.max(d,e,f),i=Math.min(d,e,f),j=h-i,k=h+i,l=.5*k;return b=i===h?0:d===h?60*(e-f)/j+360:e===h?60*(f-d)/j+120:60*(d-e)/j+240,c=0===j?0:l<=.5?j/k:j/(2-k),[Math.round(b)%360,c,l,null==g?1:g]},k.hsla.from=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b=a[0]/360,c=a[1],d=a[2],f=a[3],g=d<=.5?d*(1+c):d+c-d*c,h=2*d-g;return[Math.round(255*e(h,g,b+1/3)),Math.round(255*e(h,g,b)),Math.round(255*e(h,g,b-1/3)),f]},o(k,function(d,e){var f=e.props,g=e.cache,i=e.to,k=e.from;j.fn[d]=function(d){if(i&&!this[g]&&(this[g]=i(this._rgba)),d===b)return this[g].slice();var e,h=a.type(d),l="array"===h||"object"===h?d:arguments,m=this[g].slice();return o(f,function(a,b){var d=l["object"===h?a:b.idx];null==d&&(d=m[b.idx]),m[b.idx]=c(d,b)}),k?(e=j(k(m)),e[g]=m,e):j(m)},o(f,function(b,c){j.fn[b]||(j.fn[b]=function(e){var f,g=a.type(e),i="alpha"===b?this._hsla?"hsla":"rgba":d,j=this[i](),k=j[c.idx];return"undefined"===g?k:("function"===g&&(e=e.call(this,k),g=a.type(e)),null==e&&c.empty?this:("string"===g&&(f=h.exec(e),f&&(e=k+parseFloat(f[2])*("+"===f[1]?1:-1))),j[c.idx]=e,this[i](j)))})})}),j.hook=function(b){var c=b.split(" ");o(c,function(b,c){a.cssHooks[c]={set:function(b,e){var f,g,h="";if("transparent"!==e&&("string"!==a.type(e)||(f=d(e)))){if(e=j(f||e),!m.rgba&&1!==e._rgba[3]){for(g="backgroundColor"===c?b.parentNode:b;(""===h||"transparent"===h)&&g&&g.style;)try{h=a.css(g,"backgroundColor"),g=g.parentNode}catch(a){}e=e.blend(h&&"transparent"!==h?h:"_default")}e=e.toRgbaString()}try{b.style[c]=e}catch(a){}}},a.fx.step[c]=function(b){b.colorInit||(b.start=j(b.elem,c),b.end=j(b.end),b.colorInit=!0),a.cssHooks[c].set(b.elem,b.start.transition(b.end,b.pos))}})},j.hook(g),a.cssHooks.borderColor={expand:function(a){var b={};return o(["Top","Right","Bottom","Left"],function(c,d){b["border"+d+"Color"]=a}),b}},f=a.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function c(b){var c,d,e=b.ownerDocument.defaultView?b.ownerDocument.defaultView.getComputedStyle(b,null):b.currentStyle,f={};if(e&&e.length&&e[0]&&e[e[0]])for(d=e.length;d--;)c=e[d],"string"==typeof e[c]&&(f[a.camelCase(c)]=e[c]);else for(c in e)"string"==typeof e[c]&&(f[c]=e[c]);return f}function d(b,c){var d,e,g={};for(d in c)e=c[d],b[d]!==e&&(f[d]||!a.fx.step[d]&&isNaN(parseFloat(e))||(g[d]=e));return g}var e=["add","remove","toggle"],f={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(b,c){a.fx.step[c]=function(a){("none"!==a.end&&!a.setAttr||1===a.pos&&!a.setAttr)&&(jQuery.style(a.elem,c,a.end),a.setAttr=!0)}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a.effects.animateClass=function(b,f,g,h){var i=a.speed(f,g,h);return this.queue(function(){var f,g=a(this),h=g.attr("class")||"",j=i.children?g.find("*").addBack():g;j=j.map(function(){var b=a(this);return{el:b,start:c(this)}}),f=function(){a.each(e,function(a,c){b[c]&&g[c+"Class"](b[c])})},f(),j=j.map(function(){return this.end=c(this.el[0]),this.diff=d(this.start,this.end),this}),g.attr("class",h),j=j.map(function(){var b=this,c=a.Deferred(),d=a.extend({},i,{queue:!1,complete:function(){c.resolve(b)}});return this.el.animate(this.diff,d),c.promise()}),a.when.apply(a,j.get()).done(function(){f(),a.each(arguments,function(){var b=this.el;a.each(this.diff,function(a){b.css(a,"")})}),i.complete.call(g[0])})})},a.fn.extend({addClass:function(b){return function(c,d,e,f){return d?a.effects.animateClass.call(this,{add:c},d,e,f):b.apply(this,arguments)}}(a.fn.addClass),removeClass:function(b){return function(c,d,e,f){return arguments.length>1?a.effects.animateClass.call(this,{remove:c},d,e,f):b.apply(this,arguments)}}(a.fn.removeClass),toggleClass:function(c){return function(d,e,f,g,h){return"boolean"==typeof e||e===b?f?a.effects.animateClass.call(this,e?{add:d}:{remove:d},f,g,h):c.apply(this,arguments):a.effects.animateClass.call(this,{toggle:d},e,f,g)}}(a.fn.toggleClass),switchClass:function(b,c,d,e,f){return a.effects.animateClass.call(this,{add:c,remove:b},d,e,f)}})}(),function(){function d(b,c,d,e){return a.isPlainObject(b)&&(c=b,b=b.effect),b={effect:b},null==c&&(c={}),a.isFunction(c)&&(e=c,d=null,c={}),("number"==typeof c||a.fx.speeds[c])&&(e=d,d=c,c={}),a.isFunction(d)&&(e=d,d=null),c&&a.extend(b,c),d=d||c.duration,b.duration=a.fx.off?0:"number"==typeof d?d:d in a.fx.speeds?a.fx.speeds[d]:a.fx.speeds._default,b.complete=e||c.complete,b}function e(b){return!(b&&"number"!=typeof b&&!a.fx.speeds[b])||("string"==typeof b&&!a.effects.effect[b]||(!!a.isFunction(b)||"object"==typeof b&&!b.effect))}a.extend(a.effects,{version:"1.10.4",save:function(a,b){for(var d=0;d<b.length;d++)null!==b[d]&&a.data(c+b[d],a[0].style[b[d]])},restore:function(a,d){var e,f;for(f=0;f<d.length;f++)null!==d[f]&&(e=a.data(c+d[f]),e===b&&(e=""),a.css(d[f],e))},setMode:function(a,b){return"toggle"===b&&(b=a.is(":hidden")?"show":"hide"),b},getBaseline:function(a,b){var c,d;switch(a[0]){case"top":c=0;break;case"middle":c=.5;break;case"bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case"left":d=0;break;case"center":d=.5;break;case"right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var c={width:b.outerWidth(!0),height:b.outerHeight(!0),float:b.css("float")},d=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),e={width:b.width(),height:b.height()},f=document.activeElement;try{f.id}catch(a){f=document.body}return b.wrap(d),(b[0]===f||a.contains(b[0],f))&&a(f).focus(),d=b.parent(),"static"===b.css("position")?(d.css({position:"relative"}),b.css({position:"relative"})):(a.extend(c,{position:b.css("position"),zIndex:b.css("z-index")}),a.each(["top","left","bottom","right"],function(a,d){c[d]=b.css(d),isNaN(parseInt(c[d],10))&&(c[d]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),b.css(e),d.css(c).show()},removeWrapper:function(b){var c=document.activeElement;return b.parent().is(".ui-effects-wrapper")&&(b.parent().replaceWith(b),(b[0]===c||a.contains(b[0],c))&&a(c).focus()),b},setTransition:function(b,c,d,e){return e=e||{},a.each(c,function(a,c){var f=b.cssUnit(c);f[0]>0&&(e[c]=f[0]*d+f[1])}),e}}),a.fn.extend({effect:function(){function b(b){function d(){a.isFunction(f)&&f.call(e[0]),a.isFunction(b)&&b()}var e=a(this),f=c.complete,h=c.mode;(e.is(":hidden")?"hide"===h:"show"===h)?(e[h](),d()):g.call(e[0],c,d)}var c=d.apply(this,arguments),e=c.mode,f=c.queue,g=a.effects.effect[c.effect];return a.fx.off||!g?e?this[e](c.duration,c.complete):this.each(function(){c.complete&&c.complete.call(this)}):f===!1?this.each(b):this.queue(f||"fx",b)},show:function(a){return function(b){if(e(b))return a.apply(this,arguments);var c=d.apply(this,arguments);return c.mode="show",this.effect.call(this,c)}}(a.fn.show),hide:function(a){return function(b){if(e(b))return a.apply(this,arguments);var c=d.apply(this,arguments);return c.mode="hide",this.effect.call(this,c)}}(a.fn.hide),toggle:function(a){return function(b){if(e(b)||"boolean"==typeof b)return a.apply(this,arguments);var c=d.apply(this,arguments);return c.mode="toggle",this.effect.call(this,c)}}(a.fn.toggle),cssUnit:function(b){var c=this.css(b),d=[];return a.each(["em","px","%","pt"],function(a,b){c.indexOf(b)>0&&(d=[parseFloat(c),b])}),d}})}(),function(){var b={};a.each(["Quad","Cubic","Quart","Quint","Expo"],function(a,c){b[c]=function(b){return Math.pow(b,a+2)}}),a.extend(b,{Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Circ:function(a){return 1-Math.sqrt(1-a*a)},Elastic:function(a){return 0===a||1===a?a:-Math.pow(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*Math.PI/15)},Back:function(a){return a*a*(3*a-2)},Bounce:function(a){for(var b,c=4;a<((b=Math.pow(2,--c))-1)/11;);return 1/Math.pow(4,3-c)-7.5625*Math.pow((3*b-2)/22-a,2)}}),a.each(b,function(b,c){a.easing["easeIn"+b]=c,a.easing["easeOut"+b]=function(a){return 1-c(1-a)},a.easing["easeInOut"+b]=function(a){return a<.5?c(2*a)/2:1-c(a*-2+2)/2}})}()}(jQuery),function(a,b){var c=/up|down|vertical/,d=/up|left|vertical|horizontal/;a.effects.effect.blind=function(b,e){var f,g,h,i=a(this),j=["position","top","bottom","left","right","height","width"],k=a.effects.setMode(i,b.mode||"hide"),l=b.direction||"up",m=c.test(l),n=m?"height":"width",o=m?"top":"left",p=d.test(l),q={},r="show"===k;i.parent().is(".ui-effects-wrapper")?a.effects.save(i.parent(),j):a.effects.save(i,j),i.show(),f=a.effects.createWrapper(i).css({overflow:"hidden"}),g=f[n](),h=parseFloat(f.css(o))||0,q[n]=r?g:0,p||(i.css(m?"bottom":"right",0).css(m?"top":"left","auto").css({position:"absolute"}),q[o]=r?h:g+h),r&&(f.css(n,0),p||f.css(o,h+g)),f.animate(q,{duration:b.duration,easing:b.easing,queue:!1,complete:function(){"hide"===k&&i.hide(),a.effects.restore(i,j),a.effects.removeWrapper(i),e()}})}}(jQuery),function(a,b){a.effects.effect.bounce=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","height","width"],i=a.effects.setMode(g,b.mode||"effect"),j="hide"===i,k="show"===i,l=b.direction||"up",m=b.distance,n=b.times||5,o=2*n+(k||j?1:0),p=b.duration/o,q=b.easing,r="up"===l||"down"===l?"top":"left",s="up"===l||"left"===l,t=g.queue(),u=t.length;for((k||j)&&h.push("opacity"),a.effects.save(g,h),g.show(),a.effects.createWrapper(g),m||(m=g["top"===r?"outerHeight":"outerWidth"]()/3),k&&(f={opacity:1},f[r]=0,g.css("opacity",0).css(r,s?2*-m:2*m).animate(f,p,q)),j&&(m/=Math.pow(2,n-1)),f={},f[r]=0,d=0;d<n;d++)e={},e[r]=(s?"-=":"+=")+m,g.animate(e,p,q).animate(f,p,q),m=j?2*m:m/2;j&&(e={opacity:0},e[r]=(s?"-=":"+=")+m,g.animate(e,p,q)),g.queue(function(){j&&g.hide(),a.effects.restore(g,h),a.effects.removeWrapper(g),c()}),u>1&&t.splice.apply(t,[1,0].concat(t.splice(u,o+1))),g.dequeue()}}(jQuery),function(a,b){a.effects.effect.clip=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","height","width"],i=a.effects.setMode(g,b.mode||"hide"),j="show"===i,k=b.direction||"vertical",l="vertical"===k,m=l?"height":"width",n=l?"top":"left",o={};a.effects.save(g,h),g.show(),d=a.effects.createWrapper(g).css({overflow:"hidden"}),e="IMG"===g[0].tagName?d:g,f=e[m](),j&&(e.css(m,0),e.css(n,f/2)),o[m]=j?f:0,o[n]=j?0:f/2,e.animate(o,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){j||g.hide(),a.effects.restore(g,h),a.effects.removeWrapper(g),c()}})}}(jQuery),function(a,b){a.effects.effect.drop=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","opacity","height","width"],g=a.effects.setMode(e,b.mode||"hide"),h="show"===g,i=b.direction||"left",j="up"===i||"down"===i?"top":"left",k="up"===i||"left"===i?"pos":"neg",l={opacity:h?1:0};a.effects.save(e,f),e.show(),a.effects.createWrapper(e),d=b.distance||e["top"===j?"outerHeight":"outerWidth"](!0)/2,h&&e.css("opacity",0).css(j,"pos"===k?-d:d),l[j]=(h?"pos"===k?"+=":"-=":"pos"===k?"-=":"+=")+d,e.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}})}}(jQuery),function(a,b){a.effects.effect.explode=function(b,c){function d(){t.push(this),t.length===l*m&&e()}function e(){n.css({visibility:"visible"}),a(t).remove(),p||n.hide(),c()}var f,g,h,i,j,k,l=b.pieces?Math.round(Math.sqrt(b.pieces)):3,m=l,n=a(this),o=a.effects.setMode(n,b.mode||"hide"),p="show"===o,q=n.show().css("visibility","hidden").offset(),r=Math.ceil(n.outerWidth()/m),s=Math.ceil(n.outerHeight()/l),t=[];for(f=0;f<l;f++)for(i=q.top+f*s,k=f-(l-1)/2,g=0;g<m;g++)h=q.left+g*r,j=g-(m-1)/2,n.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-g*r,top:-f*s}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:r,height:s,left:h+(p?j*r:0),top:i+(p?k*s:0),opacity:p?0:1}).animate({left:h+(p?0:j*r),top:i+(p?0:k*s),opacity:p?1:0},b.duration||500,b.easing,d)}}(jQuery),function(a,b){a.effects.effect.fade=function(b,c){var d=a(this),e=a.effects.setMode(d,b.mode||"toggle");d.animate({opacity:e},{queue:!1,duration:b.duration,easing:b.easing,complete:c})}}(jQuery),function(a,b){a.effects.effect.fold=function(b,c){var d,e,f=a(this),g=["position","top","bottom","left","right","height","width"],h=a.effects.setMode(f,b.mode||"hide"),i="show"===h,j="hide"===h,k=b.size||15,l=/([0-9]+)%/.exec(k),m=!!b.horizFirst,n=i!==m,o=n?["width","height"]:["height","width"],p=b.duration/2,q={},r={};a.effects.save(f,g),f.show(),d=a.effects.createWrapper(f).css({overflow:"hidden"}),e=n?[d.width(),d.height()]:[d.height(),d.width()],l&&(k=parseInt(l[1],10)/100*e[j?0:1]),i&&d.css(m?{height:0,width:k}:{height:k,width:0}),q[o[0]]=i?e[0]:k,r[o[1]]=i?e[1]:0,d.animate(q,p,b.easing).animate(r,p,b.easing,function(){j&&f.hide(),a.effects.restore(f,g),a.effects.removeWrapper(f),c()})}}(jQuery),function(a,b){a.effects.effect.highlight=function(b,c){var d=a(this),e=["backgroundImage","backgroundColor","opacity"],f=a.effects.setMode(d,b.mode||"show"),g={backgroundColor:d.css("backgroundColor")};"hide"===f&&(g.opacity=0),a.effects.save(d,e),d.show().css({backgroundImage:"none",backgroundColor:b.color||"#ffff99"}).animate(g,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===f&&d.hide(),a.effects.restore(d,e),c()}})}}(jQuery),function(a,b){a.effects.effect.pulsate=function(b,c){var d,e=a(this),f=a.effects.setMode(e,b.mode||"show"),g="show"===f,h="hide"===f,i=g||"hide"===f,j=2*(b.times||5)+(i?1:0),k=b.duration/j,l=0,m=e.queue(),n=m.length;for(!g&&e.is(":visible")||(e.css("opacity",0).show(),l=1),d=1;d<j;d++)e.animate({opacity:l},k,b.easing),l=1-l;e.animate({opacity:l},k,b.easing),e.queue(function(){h&&e.hide(),c()}),n>1&&m.splice.apply(m,[1,0].concat(m.splice(n,j+1))),e.dequeue()}}(jQuery),function(a,b){a.effects.effect.puff=function(b,c){var d=a(this),e=a.effects.setMode(d,b.mode||"hide"),f="hide"===e,g=parseInt(b.percent,10)||150,h=g/100,i={height:d.height(),width:d.width(),outerHeight:d.outerHeight(),outerWidth:d.outerWidth()};a.extend(b,{effect:"scale",queue:!1,fade:!0,mode:e,complete:c,percent:f?g:100,from:f?i:{height:i.height*h,width:i.width*h,outerHeight:i.outerHeight*h,outerWidth:i.outerWidth*h}}),d.effect(b)},a.effects.effect.scale=function(b,c){var d=a(this),e=a.extend(!0,{},b),f=a.effects.setMode(d,b.mode||"effect"),g=parseInt(b.percent,10)||(0===parseInt(b.percent,10)?0:"hide"===f?0:100),h=b.direction||"both",i=b.origin,j={height:d.height(),width:d.width(),outerHeight:d.outerHeight(),outerWidth:d.outerWidth()},k={y:"horizontal"!==h?g/100:1,x:"vertical"!==h?g/100:1};e.effect="size",e.queue=!1,e.complete=c,"effect"!==f&&(e.origin=i||["middle","center"],e.restore=!0),e.from=b.from||("show"===f?{height:0,width:0,outerHeight:0,outerWidth:0}:j),e.to={height:j.height*k.y,width:j.width*k.x,outerHeight:j.outerHeight*k.y,outerWidth:j.outerWidth*k.x},e.fade&&("show"===f&&(e.from.opacity=0,e.to.opacity=1),"hide"===f&&(e.from.opacity=1,e.to.opacity=0)),d.effect(e)},a.effects.effect.size=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","width","height","overflow","opacity"],i=["position","top","bottom","left","right","overflow","opacity"],j=["width","height","overflow"],k=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],m=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],n=a.effects.setMode(g,b.mode||"effect"),o=b.restore||"effect"!==n,p=b.scale||"both",q=b.origin||["middle","center"],r=g.css("position"),s=o?h:i,t={height:0,width:0,outerHeight:0,outerWidth:0};"show"===n&&g.show(),d={height:g.height(),width:g.width(),outerHeight:g.outerHeight(),outerWidth:g.outerWidth()},"toggle"===b.mode&&"show"===n?(g.from=b.to||t,g.to=b.from||d):(g.from=b.from||("show"===n?t:d),g.to=b.to||("hide"===n?t:d)),f={from:{y:g.from.height/d.height,x:g.from.width/d.width},to:{y:g.to.height/d.height,x:g.to.width/d.width}},"box"!==p&&"both"!==p||(f.from.y!==f.to.y&&(s=s.concat(l),g.from=a.effects.setTransition(g,l,f.from.y,g.from),g.to=a.effects.setTransition(g,l,f.to.y,g.to)),f.from.x!==f.to.x&&(s=s.concat(m),g.from=a.effects.setTransition(g,m,f.from.x,g.from),g.to=a.effects.setTransition(g,m,f.to.x,g.to))),"content"!==p&&"both"!==p||f.from.y!==f.to.y&&(s=s.concat(k).concat(j),g.from=a.effects.setTransition(g,k,f.from.y,g.from),g.to=a.effects.setTransition(g,k,f.to.y,g.to)),a.effects.save(g,s),g.show(),a.effects.createWrapper(g),g.css("overflow","hidden").css(g.from),q&&(e=a.effects.getBaseline(q,d),g.from.top=(d.outerHeight-g.outerHeight())*e.y,g.from.left=(d.outerWidth-g.outerWidth())*e.x,g.to.top=(d.outerHeight-g.to.outerHeight)*e.y,g.to.left=(d.outerWidth-g.to.outerWidth)*e.x),g.css(g.from),"content"!==p&&"both"!==p||(l=l.concat(["marginTop","marginBottom"]).concat(k),m=m.concat(["marginLeft","marginRight"]),j=h.concat(l).concat(m),g.find("*[width]").each(function(){var c=a(this),d={height:c.height(),width:c.width(),outerHeight:c.outerHeight(),outerWidth:c.outerWidth()};o&&a.effects.save(c,j),c.from={height:d.height*f.from.y,width:d.width*f.from.x,outerHeight:d.outerHeight*f.from.y,outerWidth:d.outerWidth*f.from.x},c.to={height:d.height*f.to.y,width:d.width*f.to.x,outerHeight:d.height*f.to.y,outerWidth:d.width*f.to.x},f.from.y!==f.to.y&&(c.from=a.effects.setTransition(c,l,f.from.y,c.from),c.to=a.effects.setTransition(c,l,f.to.y,c.to)),f.from.x!==f.to.x&&(c.from=a.effects.setTransition(c,m,f.from.x,c.from),c.to=a.effects.setTransition(c,m,f.to.x,c.to)),c.css(c.from),c.animate(c.to,b.duration,b.easing,function(){o&&a.effects.restore(c,j)})})),g.animate(g.to,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){0===g.to.opacity&&g.css("opacity",g.from.opacity),"hide"===n&&g.hide(),a.effects.restore(g,s),o||("static"===r?g.css({position:"relative",top:g.to.top,left:g.to.left}):a.each(["top","left"],function(a,b){g.css(b,function(b,c){var d=parseInt(c,10),e=a?g.to.left:g.to.top;return"auto"===c?e+"px":d+e+"px"})})),a.effects.removeWrapper(g),c()}})}}(jQuery),function(a,b){a.effects.effect.shake=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","height","width"],g=a.effects.setMode(e,b.mode||"effect"),h=b.direction||"left",i=b.distance||20,j=b.times||3,k=2*j+1,l=Math.round(b.duration/k),m="up"===h||"down"===h?"top":"left",n="up"===h||"left"===h,o={},p={},q={},r=e.queue(),s=r.length;for(a.effects.save(e,f),e.show(),a.effects.createWrapper(e),o[m]=(n?"-=":"+=")+i,p[m]=(n?"+=":"-=")+2*i,q[m]=(n?"-=":"+=")+2*i,e.animate(o,l,b.easing),d=1;d<j;d++)e.animate(p,l,b.easing).animate(q,l,b.easing);e.animate(p,l,b.easing).animate(o,l/2,b.easing).queue(function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}),s>1&&r.splice.apply(r,[1,0].concat(r.splice(s,k+1))),e.dequeue()}}(jQuery),function(a,b){a.effects.effect.slide=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","width","height"],g=a.effects.setMode(e,b.mode||"show"),h="show"===g,i=b.direction||"left",j="up"===i||"down"===i?"top":"left",k="up"===i||"left"===i,l={};a.effects.save(e,f),e.show(),d=b.distance||e["top"===j?"outerHeight":"outerWidth"](!0),a.effects.createWrapper(e).css({overflow:"hidden"}),h&&e.css(j,k?isNaN(d)?"-"+d:-d:d),l[j]=(h?k?"+=":"-=":k?"-=":"+=")+d,e.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}})}}(jQuery),function(a,b){a.effects.effect.transfer=function(b,c){var d=a(this),e=a(b.to),f="fixed"===e.css("position"),g=a("body"),h=f?g.scrollTop():0,i=f?g.scrollLeft():0,j=e.offset(),k={top:j.top-h,left:j.left-i,height:e.innerHeight(),width:e.innerWidth()},l=d.offset(),m=a("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(b.className).css({top:l.top-h,left:l.left-i,height:d.innerHeight(),width:d.innerWidth(),position:f?"fixed":"absolute"}).animate(k,b.duration,b.easing,function(){m.remove(),c()})}}(jQuery),function(a){function b(b){var c=a("<div/>");return c.addClass("imgareaselect"),b&&c.addClass(b),c}var c=Math.abs,e=Math.max,f=Math.min,g=Math.round;a.imgAreaSelect=function(h,j){function k(c,d,e,f,g){if(this.$box=b("imgareaselect-box"),this.$area=b("imgareaselect-area"),this.$border=b("imgareaselect-border-1").add(b("imgareaselect-border-2")).add(b("imgareaselect-border-3")).add(b("imgareaselect-border-4")),this.$closeBtn=b("imgareaselect-closebtn"),this.$closeBtn.html("<div class='closeBtnInner'>×</div>"),this.$closeBtn.on("click.imgareaselect-closebtn",_.bind(this.cancelSelection,this)),this.$handles=a([]),null!=j.handles){for(this.$handles.remove(),this.$handles=a([]),this.i=j.handles?"corners"==j.handles?4:8:0;this.i--;)this.$handles=this.$handles.add(b());this.$handles.addClass(j.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:V+1||1}),!parseInt(this.$handles.css("width"))>=0&&this.$handles.width(5).height(5),(this.o=j.borderWidth)&&this.$handles.css({borderWidth:o,borderStyle:"solid"}),y(this.$handles,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}this.$areaOpera,this.position="absolute",this.startX,this.startY,this.resize,this.aspectRatio,this.shown,this.x1,this.y1,this.x2,this.y2,this.$p,this.d,this.i,this.o,this.w,this.h,this.adjusted,j.disable||j.enable===!1?this.$box.unbind("mousemove.imgareaselect").unbind("mousedown.imgareaselect",areaMouseDown):(j.resizable||j.movable)&&this.$box.on("mousemove.imgareaselect",_.bind(this.areaMouseMove,this)).on("mousedown.imgareaselect",_.bind(this.areaMouseDown,this)),
this.selection={x1:0,y1:0,x2:0,y2:0,width:0,height:0},c&&d&&e&&f&&(this.setSelection(c,d,e,f,g),this.shown=!0,this.doUpdate()),U.append(this.$box),this.$box.css({position:this.position,overflow:"hidden",zIndex:V||"0"}),this.$box.css({zIndex:V+2||2}),this.$closeBtn.css({zIndex:V+3||3}),this.$area.add(this.$border).css({position:"absolute",fontSize:0}),U.append(this.$closeBtn),this.$box.append(this.$area.add(this.$border).add(this.$areaOpera)).append(this.$handles)}function l(){a(document).unbind("mousemove",l).unbind("mouseup.nozerosize"),s=new k,Q.push(s),M=s,n(),s.startX=K,s.startY=L,s.x1=K,s.y1=L,s.x2=s.x1,s.y2=s.y1,s.doResize(),s.resize="",s.shown=!0,a(document).on("mousemove.imgareaselect",_.bind(s.selectingMouseMove,s)).one("mouseup",m),s.$box.unbind("mousemove.imgareaselect"),j.onSelectStart(h,s.getSelection())}function m(b){a("body").css("cursor",""),a(".imgareaselect-closebtn").css("cursor","pointer"),j.autoHide&&hide(M.$box,function(){a(M).hide()}),a(document).unbind("mousemove.imgareaselect"),M.$box.on("mousemove.imgareaselect",_.bind(M.areaMouseMove,M)),j.onSelectEnd(h,M.getSelection())}function n(){N&&O.width()&&(S={left:g(O.offset().left),top:g(O.offset().top)},G=O.innerWidth(),H=O.innerHeight(),S.top+=O.outerHeight()-H>>1,S.left+=O.outerWidth()-G>>1,A=g(j.minWidth/I)||0,B=g(j.minHeight/J)||0,C=g(f(j.maxWidth/I||1<<24,G)),D=g(f(j.maxHeight/J||1<<24,H)),"1.3.2"!=a().jquery||"fixed"!=position||R.getBoundingClientRect||(S.top+=e(document.body.scrollTop,R.scrollTop),S.left+=e(document.body.scrollLeft,R.scrollLeft)),T=/absolute|relative/.test(U.css("position"))?{left:g(U.offset().left)-U.scrollLeft(),top:g(U.offset().top)-U.scrollTop()}:"fixed"==this.position?{left:a(document).scrollLeft(),top:a(document).scrollTop()}:{left:0,top:0},E=p(0),F=q(0),_(Q).each(function(a){a&&(a.selection.x2>G||a.selection.y2>H)&&a.doResize()}))}function p(a){return a+S.left-T.left}function q(a){return a+S.top-T.top}function r(a){return a-S.left+T.left}function t(a){return a-S.top+T.top}function u(a){return a.pageX-T.left}function v(a){return a.pageY-T.top}function w(b){return 1==b.which&&(n(),K=u(b),L=v(b),a(document).on("mousemove.imgareaselect",l).on("mouseup.nozerosize.imgareaselect",function(){a(document).unbind("mousemove.imgareaselect")}),!1)}function x(){N=!0,z(j=a.extend({classPrefix:"imgareaselect",movable:!0,parent:a("body"),resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){},onSelectCancel:function(){}},j)),_(Q).each(function(a){a&&(a.$box.css({visibility:""}),j.show&&(shown=!0,a.adjust(),a.update(),a.$box.hide().fadeIn(j.fadeSpeed||0)))}),setTimeout(function(){j.onInit(h,_(Q).map(function(a){return a.getSelection()}))},0)}function y(a,b){for(var c in b)void 0!==j[c]&&a.css(b[c],j[c])}function z(c){c.parent&&_(_(Q).filter(function(a){return a})).each(function(b){(U=a(c.parent)).append(b.$box)}),a.extend(j,c),n(),null!=c.handles&&_(_(Q).filter(function(a){return a})).each(function(d){for(d.$handles.remove(),d.$handles=a([]),i=c.handles?"corners"==c.handles?4:8:0;i--;)d.$handles=d.$handles.add(b());d.$handles.addClass(j.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:V+1||1}),!parseInt(d.$handles.css("width"))>=0&&d.$handles.width(5).height(5),(o=j.borderWidth)&&d.$handles.css({borderWidth:o,borderStyle:"solid"}),y(d.$handles,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}),I=j.imageWidth/G||1,J=j.imageHeight/H||1,null!=c.x1&&(setSelection(c.x1,c.y1,c.x2,c.y2),c.show=!c.hide),c.keys&&(j.keys=a.extend({shift:1,ctrl:"resize"},c.keys)),_(_(Q).filter(function(a){return a})).each(function(b){for(b.$area.addClass(j.classPrefix+"-selection"),i=0;i++<4;)a(b.$border[i-1]).addClass(j.classPrefix+"-border"+i);y(b.$area,{selectionColor:"background-color",selectionOpacity:"opacity"}),y(b.$border,{borderOpacity:"opacity",borderWidth:"border-width"}),(o=j.borderColor1)&&a(b.$border[0]).css({borderStyle:"solid",borderColor:o}),(o=j.borderColor2)&&a(b.$border[1]).css({borderStyle:"dashed",borderColor:o}),b.$box.append(b.$area.add(b.$border).add(b.$areaOpera)).append(b.$handles),c.hide?hide(b.$box):c.show&&N&&(b.shown=!0,b.$box.fadeIn(j.fadeSpeed||0),b.doUpdate()),O.unbind("mousedown",w),j.disable||j.enable===!1?b.$box.unbind("mousemove.imgareaselect").unbind("mousedown.imgareaselect",b.areaMouseDown):(j.enable||j.disable===!1)&&(j.resizable||j.movable)&&b.$box.mousemove(_.bind(b.areaMouseMove,b)).on("mousedown.imgareaselect",_.bind(b.areaMouseDown,b))}),aspectRatio=(d=(j.aspectRatio||"").split(/:/))[0]/d[1],O.unbind("mousedown",w),j.disable||j.enable===!1?a(window).unbind("resize",this.windowResize):((j.enable||j.disable===!1)&&a(window).resize(this.windowResize),j.persistent||O.mousedown(w)),j.enable=j.disable=void 0}var A,B,C,D,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=a(h),P=navigator.userAgent,Q=[],R=document.documentElement,P=navigator.userAgent,S={left:0,top:0},T={left:0,top:0},U=a("body"),V=0;k.prototype.setSelection=function(a,b,c,d,e){var f=e||I||1,h=e||J||1;this.selection={x1:g(a/f||0),y1:g(b/h||0),x2:g(c/f||0),y2:g(d/h||0)},this.selection.width=this.selection.x2-this.selection.x1,this.selection.height=this.selection.y2-this.selection.y1},k.prototype.update=function(b){if(this.shown){switch(this.$box.css({left:p(this.selection.x1),top:q(this.selection.y1)}).add(this.$area).width(this.w=this.selection.width).height(this.h=this.selection.height),this.$area.add(this.$border).add(this.$handles).css({left:0,top:0}),this.$closeBtn.css({left:E+this.selection.x2+4,top:F+this.selection.y1-20}),this.$border.width(e(this.w-this.$border.outerWidth()+this.$border.innerWidth(),0)).height(e(this.h-this.$border.outerHeight()+this.$border.innerHeight(),0)),this.w-=this.$handles.outerWidth(),this.h-=this.$handles.outerHeight(),this.$handles.length){case 8:a(this.$handles[4]).css({left:this.w>>1}),a(this.$handles[5]).css({left:this.w,top:this.h>>1}),a(this.$handles[6]).css({left:this.w>>1,top:this.h}),a(this.$handles[7]).css({top:this.h>>1});case 4:this.$handles.slice(1,3).css({left:this.w}),this.$handles.slice(2,4).css({top:this.h})}b!==!1&&(a.imgAreaSelect.onKeyPress!=W&&a(document).unbind(a.imgAreaSelect.keyPress,a.imgAreaSelect.onKeyPress),j.keys&&a(document)[a.imgAreaSelect.keyPress](a.imgAreaSelect.onKeyPress=W)),a.browser.msie&&this.$border.outerWidth()-this.$border.innerWidth()==2&&(this.$border.css("margin",0),setTimeout(function(){this.$border.css("margin","auto")},0))}},k.prototype.doUpdate=function(a){n(),this.update(a),this.x1=p(this.selection.x1),this.y1=q(this.selection.y1),this.x2=p(this.selection.x2),this.y2=q(this.selection.y2)},k.prototype.hide=function(a,b){j.fadeSpeed?a.fadeOut(j.fadeSpeed,b):a.hide()},k.prototype.areaMouseMove=function(a){var b=r(u(a))-this.selection.x1,c=t(v(a))-this.selection.y1;this.adjusted||(n(),this.adjusted=!0,this.$box.one("mouseout",function(){this.adjusted=!1})),this.resize="",j.resizable&&(c<=j.resizeMargin?this.resize="n":c>=this.selection.height-j.resizeMargin&&(this.resize="s"),b<=j.resizeMargin?this.resize+="w":b>=this.selection.width-j.resizeMargin&&(this.resize+="e")),this.$box.css("cursor",this.resize?this.resize+"-resize":j.movable?"move":""),this.$areaOpera&&this.$areaOpera.toggle()},k.prototype.areaMouseDown=function(b){return 1==b.which&&(n(),M=this,this.resize?(a("body").css("cursor",this.resize+"-resize"),this.x1=p(this.selection[/w/.test(this.resize)?"x2":"x1"]),this.y1=q(this.selection[/n/.test(this.resize)?"y2":"y1"]),a(document).on("mousemove.imgareaselect",_.bind(this.selectingMouseMove,this)).one("mouseup",m),this.$box.unbind("mousemove.imgareaselect")):j.movable?(this.startX=E+this.selection.x1-u(b),this.startY=F+this.selection.y1-v(b),this.$box.unbind("mousemove.imgareaselect"),a(document).on("mousemove.imgareaselect",_.bind(this.movingMouseMove,this)).one("mouseup",_.bind(function(){j.onSelectEnd(h,this.getSelection()),a(document).unbind("mousemove.imgareaselect"),this.$box.on("mousemove.imgareaselect",_.bind(this.areaMouseMove,this))},this))):O.mousedown(b),!1)},k.prototype.getSelection=function(a){var b=a||I,c=a||J;return{x1:g(this.selection.x1*b),y1:g(this.selection.y1*c),x2:g(this.selection.x2*b),y2:g(this.selection.y2*c),width:g(this.selection.x2*b)-g(this.selection.x1*b),height:g(this.selection.y2*c)-g(this.selection.y1*c),id:Q.indexOf(this)}},k.prototype.fixAspectRatio=function(a){this.aspectRatio&&(a?(this.x2=e(E,f(E+G,this.x1+c(this.y2-this.y1)*this.aspectRatio*(this.x2>this.x1||-1))),this.y2=g(e(this.top,f(F+H,y1+c(this.x2-this.x1)/this.aspectRatio*(this.y2>this.y1||-1)))),this.x2=g(this.x2)):(this.y2=e(F,f(F+H,y1+c(this.x2-this.x1)/this.aspectRatio*(this.y2>this.y1||-1))),this.x2=g(e(E,f(E+G,x1+c(this.y2-this.y1)*this.aspectRatio*(this.x2>this.x1||-1)))),this.y2=g(this.y2)))},k.prototype.overlapsOrAbuts=function(a){var b=0,c=0,d=0,e=0;return this.x2>a.x1&&this.x1<a.x2&&(this.y1>=a.y1&&this.y1<=a.y2||this.y2>=a.y1&&this.y2<=a.y2||this.y1<=a.y1&&this.y2>=a.y2)&&(b=this.x2-a.x1),this.x1<a.x2&&this.x2>a.x1&&(this.y1>=a.y1&&this.y1<=a.y2||this.y2>=a.y1&&this.y2<=a.y2||this.y1<=a.y1&&this.y2>=a.y2)&&(c=a.x2-this.x1),this.y2>a.y1&&this.y1<a.y2&&(this.x1>=a.x1&&this.x1<=a.x2||this.x2>=a.x1&&this.x2<=a.x2||this.x1<=a.x1&&this.x2>=a.x2)&&(d=this.y2-a.y1),this.y1<a.y2&&this.y2>a.y1&&(this.x1>=a.x1&&this.x1<=a.x2||this.x2>=a.x1&&this.x2<=a.x2||this.x1<=a.x1&&this.x2>=a.x2)&&(e=a.y2-this.y1),0!=d||0!=e||0!=b||0!=c},k.prototype.doesOverlap=function(a){var b=0,c=0,d=0,e=0;return this.x2>a.x1&&this.x1<a.x2&&(this.y1>a.y1&&this.y1<a.y2||this.y2>a.y1&&this.y2<a.y2||this.y1<a.y1&&this.y2>a.y2)&&(b=this.x2-a.x1),this.x1<a.x2&&this.x2>a.x1&&(this.y1>a.y1&&this.y1<a.y2||this.y2>a.y1&&this.y2<a.y2||this.y1<a.y1&&this.y2>a.y2)&&(c=a.x2-this.x1),this.y2>a.y1&&this.y1<a.y2&&(this.x1>a.x1&&this.x1<a.x2||this.x2>a.x1&&this.x2<a.x2||this.x1<a.x1&&this.x2>a.x2)&&(d=this.y2-a.y1),this.y1<a.y2&&this.y2>a.y1&&(this.x1>a.x1&&this.x1<a.x2||this.x2>a.x1&&this.x2<a.x2||this.x1<a.x1&&this.x2>a.x2)&&(e=a.y2-this.y1),(0!=d||0!=e||0!=b||0!=c)&&{top:d,bottom:e,left:b,right:c,otherSelection:a}},k.prototype.fixMoveOverlaps=function(a){var b=a.otherSelection;if(a)if(f(a.left,a.right)<f(a.top,a.bottom)){if((a.left<a.right||this.selection.width>G-b.selection.x2)&&this.selection.width<=b.selection.x1)var d=this.x1-a.left,g=this.x2-a.left;else var d=this.x1+a.right,g=this.x2+a.right;d==e(E,f(d,E+G))&&g==e(E,f(g,E+G))?(this.x1=d,this.x2=g):(this.x1=e(d,g)<E+G?b.x1:b.x2,this.x2=c(g-d)-(e(d,g)<E+G&&g<E+G)?b.x1:b.x2)}else{var h=this.y1+(a.top<a.bottom?-1*a.top:a.bottom),i=this.y2+(a.top<a.bottom?-1*a.top:a.bottom);h<F+H&&h>F&&i<F+H&&i>F?(this.y1=h,this.y2=i):(this.y1=e(h,i)<F+H?b.y2:b.y1,this.y2=c(i-h)+(e(h,i)<F+H)?b.y2:b.y1)}},k.prototype.fixResizeOverlaps=function(a){this==a||(this.resize&&2!=this.resize.length?this.resize&&1==this.resize.length&&this.fixOneAxisResizeOverlaps(this.doesOverlap(a)):this.fixTwoAxisResizeOverlaps(a),this.selection={x1:r(f(this.x1,this.x2)),x2:r(e(this.x1,this.x2)),y1:t(f(this.y1,this.y2)),y2:t(e(this.y1,this.y2)),width:c(this.x2-this.x1),height:c(this.y2-this.y1)})},k.prototype.fixOneAxisResizeOverlaps=function(a){var b=a.otherSelection;a&&("n"==this.resize?this.y1=b.y2:"s"==this.resize?this.y2=b.y1:"w"==this.resize?this.x1=b.x2:"e"==this.resize&&(this.x2=b.x1))},k.prototype.fixTwoAxisResizeOverlaps=function(a){var b=this.x2>this.x1,c=this.y2>this.y1;if((b?this.x1:this.x2)>=a.x1&&(b?this.x1:this.x2)<a.x2)(c?this.y2>a.y1&&this.y1<a.y2:this.y2<a.y2&&this.y1>a.y1)&&(this.y2=c?a.y1:a.y2);else if((c?this.y1:this.y2)>a.y1&&(c?this.y1:this.y2)<a.y2)(b?this.x2>=a.x1&&this.x1<=a.x1:this.x2<a.x2&&this.x1>a.x2)&&(this.x2=b?a.x1:a.x2);else if((c?this.y2>=a.y1&&this.y1<a.y2:this.y2<a.y2&&this.y1>=a.y1)&&(b?this.x2>=a.x1&&this.x1<=a.x1:this.x2<a.x2&&this.x1>a.x2)||(b?this.x1:this.x2)<=a.x1&&(c?this.y1:this.y2)<=a.y1&&(b?this.x2:this.x1)>a.x2&&(c?this.y2:this.y1)>a.y2){var d=b?this.x2-a.x1:a.x2-this.x2,e=c?this.y2-a.y1:a.y2-this.y2;d>e?this.y2=c?a.y1:a.y2:this.x2=b?a.x1:a.x2}},k.prototype.doResize=function(){if(this.x1=f(this.x1,E+G),this.y1=f(this.y1,F+H),c(this.x2-this.x1)<A&&(x2=x1-A*(x2<x1||-1),this.x2<E?this.x1=E+A:this.x2>E+G&&(this.x1=E+G-A)),c(this.y2-this.y1)<B&&(this.y2=this.y1-B*(this.y2<this.y1||-1),this.y2<F?this.y1=F+B:this.y2>F+H&&(this.y1=F+H-B)),this.x2=e(E,f(this.x2,E+G)),this.y2=e(F,f(this.y2,F+H)),this.fixAspectRatio(c(this.x2-this.x1)<c(this.y2-this.y1)*this.aspectRatio),c(this.x2-this.x1)>C&&(this.x2=this.x1-C*(this.x2<this.x1||-1),this.fixAspectRatio()),c(this.y2-this.y1)>D&&(this.y2=this.y1-D*(this.y2<this.y1||-1),this.fixAspectRatio(!0)),j.allowOverlaps)this.selection={x1:r(f(this.x1,this.x2)),x2:r(e(this.x1,this.x2)),y1:t(f(this.y1,this.y2)),y2:t(e(this.y1,this.y2))},this.selection.width=c(this.selection.x2-this.selection.x1),this.selection.height=c(this.selection.y2-this.selection.y1);else{_(_(Q).filter(_.bind(function(a){return a&&this!=a},this))).each(_.bind(function(a){this.fixResizeOverlaps(a)},this));var a=_(_(Q).filter(_.bind(function(a){return a&&this!=a},this))).map(_.bind(function(a){return this.doesOverlap(a)||this==a},this)),b=_(a).map(function(a){return!a}).indexOf(!1)==-1&&this.x1>0&&this.x2<E+G&&this.y1>0&&this.y2<H+F;b?(this.selection={x1:r(f(this.x1,this.x2)),x2:r(e(this.x1,this.x2)),y1:t(f(this.y1,this.y2)),y2:t(e(this.y1,this.y2))},this.selection.width=c(this.selection.x2-this.selection.x1),this.selection.height=c(this.selection.y2-this.selection.y1)):(this.x2=this.oldX2,this.y2=this.oldY2,this.selection={x1:r(f(this.x1,this.x2)),x2:r(e(this.x1,this.x2)),y1:t(f(this.y1,this.y2)),y2:t(e(this.y1,this.y2))},this.selection.width=c(this.selection.x2-this.selection.x1),this.selection.height=c(this.selection.y2-this.selection.y1))}this.update(),j.onSelectChange(h,this.getSelection())},k.prototype.selectingMouseMove=function(b){return this.oldX2=this.x2,this.oldY2=this.y2,a(".imgareaselect-closebtn").css("cursor","default"),this.x2=/w|e|^$/.test(this.resize)||this.aspectRatio?u(b):p(this.selection.x2),this.y2=/n|s|^$/.test(this.resize)||this.aspectRatio?v(b):q(this.selection.y2),this.doResize(),!1},k.prototype.doMove=function(b,c){if(oldX1=this.selection.x1,oldY1=this.selection.y1,oldX2=this.selection.x2,oldY2=this.selection.y2,this.x2=(this.x1=b)+this.selection.width,this.y2=(this.y1=c)+this.selection.height,j.allowOverlaps)a.extend(this.selection,{x1:r(this.x1),y1:t(this.y1),x2:r(this.x2),y2:t(this.y2)});else{_(_(Q).filter(function(a){return a})).each(_.bind(function(a){this.fixMoveOverlaps(this.doesOverlap(a))},this));var d=_(_(Q).filter(function(a){return a&&this!=a})).map(_.bind(function(a){return this.doesOverlap(a)},this)),g=_(d).map(function(a){return!a}).indexOf(!1)==-1&&f(this.x1,this.x2)>E&&e(this.x1+this.selection.width,this.x2)<E+G&&f(this.y1,this.y2)>F&&e(this.y1+this.selection.height,this.y2)<F+H;g?a.extend(this.selection,{x1:r(this.x1),y1:t(this.y1),x2:r(this.x2),y2:t(this.y2)}):(this.x1=oldX1,this.y1=oldY1,this.x2=oldX2,this.y2=oldY2,a.extend(this.selection,{x1:oldX1,y1:oldY1,x2:oldX2,y2:oldY2}))}this.update(),j.onSelectChange(h,this.getSelection())},k.prototype.movingMouseMove=function(a){return this.x1=e(E,f(this.startX+u(a),E+G-this.selection.width)),this.y1=e(F,f(this.startY+v(a),F+H-this.selection.height)),this.doMove(this.x1,this.y1),a.preventDefault(),!1},k.prototype.cancelSelection=function(b){a(document).unbind("mousemove.imgareaselect").unbind("mouseup",this.cancelSelection),this.hide(this.$box),this.hide(this.$closeBtn),this.shown=!1;var c=Q.indexOf(this);c>=0&&Q.splice(c,1,null),b||this instanceof a.imgAreaSelect||(j.onSelectChange(h,this.getSelection()),j.onSelectEnd(h,this.getSelection())),j.onSelectCancel(h,this.getSelection(),c),this.$box.remove(),this.$closeBtn.remove()};var W=function(a){var b,c,d=j.keys,g=a.keyCode;if(b=isNaN(d.alt)||!a.altKey&&!a.originalEvent.altKey?!isNaN(d.ctrl)&&a.ctrlKey?d.ctrl:!isNaN(d.shift)&&a.shiftKey?d.shift:isNaN(d.arrows)?10:d.arrows:d.alt,"resize"==d.arrows||"resize"==d.shift&&a.shiftKey||"resize"==d.ctrl&&a.ctrlKey||"resize"==d.alt&&(a.altKey||a.originalEvent.altKey)){switch(g){case 37:b=-b;case 39:c=e(x1,x2),x1=f(x1,x2),x2=e(c+b,x1),fixAspectRatio();break;case 38:b=-b;case 40:c=e(y1,y2),y1=f(y1,y2),y2=e(c+b,y1),fixAspectRatio(!0);break;default:return}doResize()}else switch(x1=f(x1,x2),y1=f(y1,y2),g){case 37:doMove(e(x1-b,E),y1);break;case 38:doMove(x1,e(y1-b,F));break;case 39:doMove(x1+f(b,G-r(x2)),y1);break;case 40:doMove(x1,y1+f(b,H-t(y2)));break;default:return}return!1};this.remove=function(){this.setOptions({disable:!0}),_(Q).each(function(a){a&&(a.$box.remove(),a.$closeBtn.remove())})},this.getImg=function(){return O},this.getDebugPositioning=function(){return{left:E,top:F,imgWidth:G,imgHeight:H}},this.getOptions=function(){return j},this.setOptions=z,this.getSelections=function(a){return _(_(Q).filter(function(a){return!!a})).map(function(b){return b.getSelection(a)})},this.createNewSelection=function(a,b,c,d){if(j.multipleSelections){var g=new k(a,b,c,d);if(!j.allowOverlaps)var h=_(_(Q).filter(function(a){return a})).map(function(a){return g.overlapsOrAbuts(a)}),i=_(h).map(function(a){return!a}).indexOf(!1)==-1;if(j.allowOverlaps||i)return Q.push(g),g.getSelection();if(_(h).reject(function(a){return a}).length<=1){var l=_(h).map(function(a){return a}).indexOf(!0),m=Q[l];return m.setSelection(f(m.selection.x1,a,m.selection.x2,c),f(m.selection.y1,b,m.selection.y2,d),e(m.selection.x1,a,m.selection.x2,c),e(m.selection.y1,b,m.selection.y2,d)),m.update(),g.cancelSelection(!0),!1}return g.cancelSelection(!0),!1}Q[0].setSelection(a,b,c,d,noScale)},this.setSelection=function(a,b,c,d,e){return Q[0].setSelection(a,b,c,d,e),!0},this.update=function(){_(_(Q).filter(function(a){return a})).each(function(a){a.doUpdate()})},this.windowResize=function(){this.update()},this.cancelSelections=function(){for(var a=Q.length;a>=1;)Q[a-1]&&Q[a-1].cancelSelection(!0),a--;Q=_(Q).reject(function(a){return _(a).isNull()})},this.cancelSelection=function(){return!j.multipleSelections&&void Q[0].cancelSelection(!0)};var X=(/msie ([\w.]+)/i.exec(P)||[])[1],Y=/opera/i.test(P),Z=/webkit/i.test(P)&&!/chrome/i.test(P);for($p=O;$p.length;)V=e(V,isNaN($p.css("z-index"))?V:$p.css("z-index")),"fixed"==$p.css("position")&&(position="fixed"),$p=$p.parent(":not(body)");V=j.zIndex||V,X&&O.attr("unselectable","on"),a.imgAreaSelect.keyPress=X||Z?"keydown":"keypress",Y&&($areaOpera=b().css({width:"100%",height:"100%",position:"absolute",zIndex:V+2||2})),h.complete||"complete"==h.readyState||!O.is("img")?x():O.one("load",x),!N&&X&&X>=7&&(h.src=h.src)},a.fn.imgAreaSelect=function(b){return b=b||{},this.each(function(){a(this).data("imgAreaSelect")?b.remove?(a(this).data("imgAreaSelect").remove(),a(this).removeData("imgAreaSelect")):a(this).data("imgAreaSelect").setOptions(b):b.remove||(void 0===b.enable&&void 0===b.disable&&(b.enable=!0),a(this).data("imgAreaSelect",new a.imgAreaSelect(this,b)))}),b.instance?a(this).data("imgAreaSelect"):this}}(jQuery),!function(a,b){"function"==typeof define&&define.amd?define("wavesurfer",[],function(){return a.WaveSurfer=b()}):"object"==typeof exports?module.exports=b():a.WaveSurfer=b()}(this,function(){"use strict";var a={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,skipLength:2,minPxPerSec:20,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,fillParent:!0,scrollParent:!1,hideScrollbar:!1,normalize:!1,audioContext:null,container:null,dragSelection:!0,loopSelection:!0,audioRate:1,interact:!0,splitChannels:!1,mediaContainer:null,mediaControls:!1,renderer:"Canvas",backend:"WebAudio",mediaType:"audio",autoCenter:!0},init:function(b){if(this.params=a.util.extend({},this.defaultParams,b),this.container="string"==typeof b.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(null==this.params.mediaContainer?this.mediaContainer=this.container:"string"==typeof this.params.mediaContainer?this.mediaContainer=document.querySelector(this.params.mediaContainer):this.mediaContainer=this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");this.savedVolume=0,this.isMuted=!1,this.tmpEvents=[],this.currentAjax=null,this.createDrawer(),this.createBackend(),this.isDestroyed=!1},createDrawer:function(){var b=this;this.drawer=Object.create(a.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){b.drawBuffer(),b.drawer.progress(b.backend.getPlayedPercents())}),this.drawer.on("click",function(a,c){setTimeout(function(){b.seekTo(c)},0)}),this.drawer.on("scroll",function(a){b.fireEvent("scroll",a)})},createBackend:function(){var b=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||a.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement"),this.backend=Object.create(a[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){b.fireEvent("finish")}),this.backend.on("play",function(){b.fireEvent("play")}),this.backend.on("pause",function(){b.fireEvent("pause")}),this.backend.on("audioprocess",function(a){b.drawer.progress(b.backend.getPlayedPercents()),b.fireEvent("audioprocess",a)})},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(a,b){this.fireEvent("interaction",this.play.bind(this,a,b)),this.backend.play(a,b)},pause:function(){this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},isPlaying:function(){return!this.backend.isPaused()},skipBackward:function(a){this.skip(-a||-this.params.skipLength)},skipForward:function(a){this.skip(a||this.params.skipLength)},skip:function(a){var b=this.getCurrentTime()||0,c=this.getDuration()||1;b=Math.max(0,Math.min(c,b+(a||0))),this.seekAndCenter(b/c)},seekAndCenter:function(a){this.seekTo(a),this.drawer.recenter(a)},seekTo:function(a){this.fireEvent("interaction",this.seekTo.bind(this,a));var b=this.backend.isPaused(),c=this.params.scrollParent;b&&(this.params.scrollParent=!1),this.backend.seekTo(a*this.getDuration()),this.drawer.progress(this.backend.getPlayedPercents()),b||(this.backend.pause(),this.backend.play()),this.params.scrollParent=c,this.fireEvent("seek",a)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(a){this.backend.setVolume(a)},setPlaybackRate:function(a){this.backend.setPlaybackRate(a)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var a=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),b=this.drawer.getWidth(),c=a;this.params.fillParent&&(!this.params.scrollParent||a<b)&&(c=b);var d=this.backend.getPeaks(c);this.drawer.drawPeaks(d,c),this.fireEvent("redraw",d,c)},zoom:function(a){this.params.minPxPerSec=a,this.params.scrollParent=!0,this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",a)},loadArrayBuffer:function(a){this.decodeArrayBuffer(a,function(a){this.isDestroyed||this.loadDecodedBuffer(a)}.bind(this))},loadDecodedBuffer:function(a){this.backend.load(a),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(a){var b=this,c=new FileReader;c.addEventListener("progress",function(a){b.onProgress(a)}),c.addEventListener("load",function(a){b.loadArrayBuffer(a.target.result)}),c.addEventListener("error",function(){b.fireEvent("error","Error reading file")}),c.readAsArrayBuffer(a),this.empty()},load:function(a,b){switch(this.empty(),this.params.backend){case"WebAudio":return this.loadBuffer(a,b);case"MediaElement":return this.loadMediaElement(a,b)}},loadBuffer:function(a,b){var c=function(b){return b&&this.tmpEvents.push(this.once("ready",b)),this.getArrayBuffer(a,this.loadArrayBuffer.bind(this))}.bind(this);return b?(this.backend.setPeaks(b),this.drawBuffer(),void this.tmpEvents.push(this.once("interaction",c))):c()},loadMediaElement:function(a,b){var c=a;if("string"==typeof a)this.backend.load(c,this.mediaContainer,b);else{var d=a;this.backend.loadElt(d,b),c=d.src}this.tmpEvents.push(this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(a){this.fireEvent("error",a)}.bind(this))),b?this.backend.setPeaks(b):this.backend.supportsWebAudio()&&this.getArrayBuffer(c,function(a){this.decodeArrayBuffer(a,function(a){this.backend.buffer=a,this.drawBuffer()}.bind(this))}.bind(this))},decodeArrayBuffer:function(a,b){this.arraybuffer=a,this.backend.decodeArrayBuffer(a,function(c){this.isDestroyed||this.arraybuffer!=a||(b(c),this.arraybuffer=null)}.bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(b,c){var d=this,e=a.util.ajax({url:b,responseType:"arraybuffer"});return this.currentAjax=e,this.tmpEvents.push(e.on("progress",function(a){d.onProgress(a)}),e.on("success",function(a,b){c(a),d.currentAjax=null}),e.on("error",function(a){d.fireEvent("error","XHR error: "+a.target.statusText),d.currentAjax=null})),e},onProgress:function(a){if(a.lengthComputable)var b=a.loaded/a.total;else b=a.loaded/(a.loaded+1e6);this.fireEvent("loading",Math.round(100*b),a.target)},exportPCM:function(a,b,c){a=a||1024,b=b||1e4,c=c||!1;var d=this.backend.getPeaks(a,b),e=[].map.call(d,function(a){return Math.round(a*b)/b}),f=JSON.stringify(e);return c||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(f)),f},exportImage:function(a,b){return a||(a="image/png"),b||(b=1),this.drawer.getImage(a,b)},cancelAjax:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)},clearTmpEvents:function(){this.tmpEvents.forEach(function(a){a.un()})},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),this.backend.destroy(),this.drawer.destroy(),this.isDestroyed=!0}};return a.create=function(b){var c=Object.create(a);return c.init(b),c},a.util={extend:function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){Object.keys(b).forEach(function(c){a[c]=b[c]})}),a},min:function(a){var b=+(1/0);for(var c in a)a[c]<b&&(b=a[c]);return b},max:function(a){var b=-(1/0);for(var c in a)a[c]>b&&(b=a[c]);return b},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(b){var c=Object.create(a.Observer),d=new XMLHttpRequest,e=!1;return d.open(b.method||"GET",b.url,!0),d.responseType=b.responseType||"json",d.addEventListener("progress",function(a){c.fireEvent("progress",a),a.lengthComputable&&a.loaded==a.total&&(e=!0)}),d.addEventListener("load",function(a){e||c.fireEvent("progress",a),c.fireEvent("load",a),200==d.status||206==d.status?c.fireEvent("success",d.response,a):c.fireEvent("error",a)}),d.addEventListener("error",function(a){c.fireEvent("error",a)}),d.send(),c.xhr=d,c}},a.Observer={on:function(a,b){this.handlers||(this.handlers={});var c=this.handlers[a];return c||(c=this.handlers[a]=[]),c.push(b),{name:a,callback:b,un:this.un.bind(this,a,b)}},un:function(a,b){if(this.handlers){var c=this.handlers[a];if(c)if(b)for(var d=c.length-1;d>=0;d--)c[d]==b&&c.splice(d,1);else c.length=0}},unAll:function(){this.handlers=null},once:function(a,b){var c=this,d=function(){b.apply(this,arguments),setTimeout(function(){c.un(a,d)},0)};return this.on(a,d)},fireEvent:function(a){if(this.handlers){var b=this.handlers[a],c=Array.prototype.slice.call(arguments,1);b&&b.forEach(function(a){a.apply(null,c)})}}},a.util.extend(a,a.Observer),a.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},getAudioContext:function(){return a.WebAudio.audioContext||(a.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),a.WebAudio.audioContext},getOfflineAudioContext:function(b){return a.WebAudio.offlineAudioContext||(a.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,b)),a.WebAudio.offlineAudioContext},init:function(b){this.params=b,this.ac=b.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.scheduledPause=null,this.states=[Object.create(a.WebAudio.state.playing),Object.create(a.WebAudio.state.paused),Object.create(a.WebAudio.state.finished)],this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(this.PAUSED_STATE),this.setPlaybackRate(this.params.audioRate)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(a){a&&a.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(a){this.state!==this.states[a]&&(this.state=this.states[a],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(a){this.disconnectFilters(),a&&a.length&&(this.filters=a,this.analyser.disconnect(),a.reduce(function(a,b){return a.connect(b),b},this.analyser).connect(this.gainNode))},createScriptNode:function(){this.ac.createScriptProcessor?this.scriptNode=this.ac.createScriptProcessor(this.scriptBufferSize):this.scriptNode=this.ac.createJavaScriptNode(this.scriptBufferSize),this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var a=this;this.scriptNode.onaudioprocess=function(){var b=a.getCurrentTime();b>=a.getDuration()?(a.setState(a.FINISHED_STATE),a.fireEvent("pause")):b>=a.scheduledPause?a.pause():a.state===a.states[a.PLAYING_STATE]&&a.fireEvent("audioprocess",b)}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(a){this.gainNode.gain.value=a},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(a,b,c){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(a,function(a){b(a)}.bind(this),c)},setPeaks:function(a){this.peaks=a},getPeaks:function(a){if(this.peaks)return this.peaks;for(var b=this.buffer.length/a,c=~~(b/10)||1,d=this.buffer.numberOfChannels,e=[],f=[],g=0;g<d;g++)for(var h=e[g]=[],i=this.buffer.getChannelData(g),j=0;j<a;j++){for(var k=~~(j*b),l=~~(k+b),m=0,n=0,o=k;o<l;o+=c){var p=i[o];p>n&&(n=p),p<m&&(m=p)}h[2*j]=n,h[2*j+1]=m,(0==g||n>f[2*j])&&(f[2*j]=n),(0==g||m<f[2*j+1])&&(f[2*j+1]=m)}return this.params.splitChannels?e:f},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect()},load:function(a){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=a,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,
this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(a,b){if(this.buffer)return this.scheduledPause=null,null==a&&(a=this.getCurrentTime(),a>=this.getDuration()&&(a=0)),null==b&&(b=this.getDuration()),this.startPosition=a,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:a,end:b}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(a,b){if(this.buffer){this.createSource();var c=this.seekTo(a,b);a=c.start,b=c.end,this.scheduledPause=b,this.source.start(0,a,b-a),this.setState(this.PLAYING_STATE),this.fireEvent("play")}},pause:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE),this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},setPlaybackRate:function(a){a=a||1,this.isPaused()?this.playbackRate=a:(this.pause(),this.playbackRate=a,this.play())}},a.WebAudio.state={},a.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},a.WebAudio.state.paused={init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition}},a.WebAudio.state.finished={init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},a.util.extend(a.WebAudio,a.Observer),a.MediaElement=Object.create(a.WebAudio),a.util.extend(a.MediaElement,{init:function(a){this.params=a,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=a.mediaType.toLowerCase(),this.elementPosition=a.elementPosition,this.setPlaybackRate(this.params.audioRate),this.createTimer()},createTimer:function(){var a=this,b=function(){if(!a.isPaused()){a.fireEvent("audioprocess",a.getCurrentTime());var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame;c(b)}};this.on("play",b)},load:function(a,b,c){var d=document.createElement(this.mediaType);d.controls=this.params.mediaControls,d.autoplay=this.params.autoplay||!1,d.preload="auto",d.src=a,d.style.width="100%";var e=b.querySelector(this.mediaType);e&&b.removeChild(e),b.appendChild(d),this._load(d,c)},loadElt:function(a,b){var c=a;c.controls=this.params.mediaControls,c.autoplay=this.params.autoplay||!1,this._load(c,b)},_load:function(a,b){var c=this;a.load(),a.addEventListener("error",function(){c.fireEvent("error","Error loading media element")}),a.addEventListener("canplay",function(){c.fireEvent("canplay")}),a.addEventListener("ended",function(){c.fireEvent("finish")}),this.media=a,this.peaks=b,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return!this.media||this.media.paused},getDuration:function(){var a=this.media.duration;return a>=1/0&&(a=this.media.seekable.end(0)),a},getCurrentTime:function(){return this.media&&this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},setPlaybackRate:function(a){this.playbackRate=a||1,this.media.playbackRate=this.playbackRate},seekTo:function(a){null!=a&&(this.media.currentTime=a),this.clearPlayEnd()},play:function(a,b){this.seekTo(a),this.media.play(),b&&this.setPlayEnd(b),this.fireEvent("play")},pause:function(){this.media&&this.media.pause(),this.clearPlayEnd(),this.fireEvent("pause")},setPlayEnd:function(a){var b=this;this.onPlayEnd=function(c){c>=a&&(b.pause(),b.seekTo(a))},this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(b){return this.buffer?a.WebAudio.getPeaks.call(this,b):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(a){this.media.volume=a},destroy:function(){this.pause(),this.unAll(),this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),a.AudioElement=a.MediaElement,a.Drawer={init:function(a,b){this.container=a,this.params=b,this.width=0,this.height=b.height*this.params.pixelRatio,this.lastPos=0,this.initDrawer(b),this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(a,b){!b&&a.preventDefault();var c,d=a.targetTouches?a.targetTouches[0].clientX:a.clientX,e=this.wrapper.getBoundingClientRect(),f=this.width,g=this.getWidth();return!this.params.fillParent&&f<g?(c=(d-e.left)*this.params.pixelRatio/f||0,c>1&&(c=1)):c=(d-e.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,c},setupWrapperEvents:function(){var a=this;this.wrapper.addEventListener("click",function(b){var c=a.wrapper.offsetHeight-a.wrapper.clientHeight;if(0!=c){var d=a.wrapper.getBoundingClientRect();if(b.clientY>=d.bottom-c)return}a.params.interact&&a.fireEvent("click",b,a.handleEvent(b))}),this.wrapper.addEventListener("scroll",function(b){a.fireEvent("scroll",b)})},drawPeaks:function(a,b){this.resetScroll(),this.setWidth(b),this.params.barWidth?this.drawBars(a):this.drawWave(a)},style:function(a,b){return Object.keys(b).forEach(function(c){a.style[c]!==b[c]&&(a.style[c]=b[c])}),a},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(a){var b=this.wrapper.scrollWidth*a;this.recenterOnPosition(b,!0)},recenterOnPosition:function(a,b){var c=this.wrapper.scrollLeft,d=~~(this.wrapper.clientWidth/2),e=a-d,f=e-c,g=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=g){if(!b&&-d<=f&&f<d){var h=5;f=Math.max(-h,Math.min(h,f)),e=c+f}e=Math.max(0,Math.min(g,e)),e!=c&&(this.wrapper.scrollLeft=e)}},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(a){this.width=a,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize()},setHeight:function(a){a!=this.height&&(this.height=a,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize())},progress:function(a){var b=1/this.params.pixelRatio,c=Math.round(a*this.width)*b;if(c<this.lastPos||c-this.lastPos>=b){if(this.lastPos=c,this.params.scrollParent&&this.params.autoCenter){var d=~~(this.wrapper.scrollWidth*a);this.recenterOnPosition(d)}this.updateProgress(a)}},destroy:function(){this.unAll(),this.wrapper&&(this.container.removeChild(this.wrapper),this.wrapper=null)},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(a,b){},clearWave:function(){},updateProgress:function(a){}},a.util.extend(a.Drawer,a.Observer),a.Drawer.Canvas=Object.create(a.Drawer),a.util.extend(a.Drawer.Canvas,{createElements:function(){var a=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:0,top:0,bottom:0}));if(this.waveCc=a.getContext("2d"),this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.params.waveColor!=this.params.progressColor){var b=this.progressWave.appendChild(document.createElement("canvas"));this.progressCc=b.getContext("2d")}},updateSize:function(){var a=Math.round(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width,this.waveCc.canvas.height=this.height,this.style(this.waveCc.canvas,{width:a+"px"}),this.style(this.progressWave,{display:"block"}),this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:a+"px"})),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawBars:function(b,c){if(b[0]instanceof Array){var d=b;if(this.params.splitChannels)return this.setHeight(d.length*this.params.height*this.params.pixelRatio),void d.forEach(this.drawBars,this);b=d[0]}var e=[].some.call(b,function(a){return a<0});e&&(b=[].filter.call(b,function(a,b){return b%2==0}));var f=.5/this.params.pixelRatio,g=this.width,h=this.params.height*this.params.pixelRatio,i=h*c||0,j=h/2,k=b.length,l=this.params.barWidth*this.params.pixelRatio,m=Math.max(this.params.pixelRatio,~~(l/2)),n=l+m,o=1;this.params.normalize&&(o=a.util.max(b));var p=k/g;this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(a){if(a)for(var c=0;c<g;c+=n){var d=Math.round(b[Math.floor(c*p)]/o*j);a.fillRect(c+f,j-d+i,l+f,2*d)}},this)},drawWave:function(b,c){if(b[0]instanceof Array){var d=b;if(this.params.splitChannels)return this.setHeight(d.length*this.params.height*this.params.pixelRatio),void d.forEach(this.drawWave,this);b=d[0]}var e=[].some.call(b,function(a){return a<0});if(!e){for(var f=[],g=0,h=b.length;g<h;g++)f[2*g]=b[g],f[2*g+1]=-b[g];b=f}var i=.5/this.params.pixelRatio,j=this.params.height*this.params.pixelRatio,k=j*c||0,l=j/2,m=~~(b.length/2),n=1;this.params.fillParent&&this.width!=m&&(n=this.width/m);var o=1;if(this.params.normalize){var p=a.util.max(b),q=a.util.min(b);o=-q>p?-q:p}this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(a){if(a){a.beginPath(),a.moveTo(i,l+k);for(var c=0;c<m;c++){var d=Math.round(b[2*c]/o*l);a.lineTo(c*n+i,l-d+k)}for(var c=m-1;c>=0;c--){var d=Math.round(b[2*c+1]/o*l);a.lineTo(c*n+i,l-d+k)}a.closePath(),a.fill(),a.fillRect(0,l+k-i,this.width,i)}},this)},updateProgress:function(a){var b=Math.round(this.width*a)/this.params.pixelRatio;this.style(this.progressWave,{width:b+"px"})},getImage:function(a,b){return this.waveCc.canvas.toDataURL(a,b)}}),a.Drawer.MultiCanvas=Object.create(a.Drawer),a.util.extend(a.Drawer.MultiCanvas,{initDrawer:function(a){if(this.maxCanvasWidth=null!=a.maxCanvasWidth?a.maxCanvasWidth:4e3,this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio),this.maxCanvasWidth<=1)throw"maxCanvasWidth must be greater than 1.";if(this.maxCanvasWidth%2==1)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor,this.halfPixel=.5/this.params.pixelRatio,this.canvases=[]},createElements:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.addCanvas()},updateSize:function(){for(var a=Math.round(this.width/this.params.pixelRatio),b=Math.ceil(a/this.maxCanvasElementWidth);this.canvases.length<b;)this.addCanvas();for(;this.canvases.length>b;)this.removeCanvas();for(var c in this.canvases){var d=this.maxCanvasWidth+2*Math.ceil(this.params.pixelRatio/2);c==this.canvases.length-1&&(d=this.width-this.maxCanvasWidth*(this.canvases.length-1)),this.updateDimensions(this.canvases[c],d,this.height),this.clearWaveForEntry(this.canvases[c])}},addCanvas:function(){var a={},b=this.maxCanvasElementWidth*this.canvases.length;a.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:b+"px",top:0,bottom:0})),a.waveCtx=a.wave.getContext("2d"),this.hasProgressCanvas&&(a.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:b+"px",top:0,bottom:0})),a.progressCtx=a.progress.getContext("2d")),this.canvases.push(a)},removeCanvas:function(){var a=this.canvases.pop();a.wave.parentElement.removeChild(a.wave),this.hasProgressCanvas&&a.progress.parentElement.removeChild(a.progress)},updateDimensions:function(a,b,c){var d=Math.round(b/this.params.pixelRatio),e=Math.round(this.width/this.params.pixelRatio);a.start=a.waveCtx.canvas.offsetLeft/e||0,a.end=a.start+d/e,a.waveCtx.canvas.width=b,a.waveCtx.canvas.height=c,this.style(a.waveCtx.canvas,{width:d+"px"}),this.style(this.progressWave,{display:"block"}),this.hasProgressCanvas&&(a.progressCtx.canvas.width=b,a.progressCtx.canvas.height=c,this.style(a.progressCtx.canvas,{width:d+"px"}))},clearWave:function(){for(var a in this.canvases)this.clearWaveForEntry(this.canvases[a])},clearWaveForEntry:function(a){a.waveCtx.clearRect(0,0,a.waveCtx.canvas.width,a.waveCtx.canvas.height),this.hasProgressCanvas&&a.progressCtx.clearRect(0,0,a.progressCtx.canvas.width,a.progressCtx.canvas.height)},drawBars:function(b,c){if(b[0]instanceof Array){var d=b;if(this.params.splitChannels)return this.setHeight(d.length*this.params.height*this.params.pixelRatio),void d.forEach(this.drawBars,this);b=d[0]}var e=[].some.call(b,function(a){return a<0});e&&(b=[].filter.call(b,function(a,b){return b%2==0}));var f=this.width,g=this.params.height*this.params.pixelRatio,h=g*c||0,i=g/2,j=b.length,k=this.params.barWidth*this.params.pixelRatio,l=Math.max(this.params.pixelRatio,~~(k/2)),m=k+l,n=1;this.params.normalize&&(n=a.util.max(b));for(var o=j/f,p=0;p<f;p+=m){var q=Math.round(b[Math.floor(p*o)]/n*i);this.fillRect(p+this.halfPixel,i-q+h,k+this.halfPixel,2*q)}},drawWave:function(b,c){if(b[0]instanceof Array){var d=b;if(this.params.splitChannels)return this.setHeight(d.length*this.params.height*this.params.pixelRatio),void d.forEach(this.drawWave,this);b=d[0]}var e=[].some.call(b,function(a){return a<0});if(!e){for(var f=[],g=0,h=b.length;g<h;g++)f[2*g]=b[g],f[2*g+1]=-b[g];b=f}var i=this.params.height*this.params.pixelRatio,j=i*c||0,k=i/2,l=1;if(this.params.normalize){var m=a.util.max(b),n=a.util.min(b);l=-n>m?-n:m}this.drawLine(b,l,k,j),this.fillRect(0,k+j-this.halfPixel,this.width,this.halfPixel)},drawLine:function(a,b,c,d){for(var e in this.canvases){var f=this.canvases[e];this.setFillStyles(f),this.drawLineToContext(f,f.waveCtx,a,b,c,d),this.drawLineToContext(f,f.progressCtx,a,b,c,d)}},drawLineToContext:function(a,b,c,d,e,f){if(b){var g=c.length/2,h=1;this.params.fillParent&&this.width!=g&&(h=this.width/g);var i=Math.round(g*a.start),j=Math.round(g*a.end);b.beginPath(),b.moveTo(this.halfPixel,e+f);for(var k=i;k<j;k++){var l=Math.round(c[2*k]/d*e);b.lineTo((k-i)*h+this.halfPixel,e-l+f)}for(var k=j-1;k>=i;k--){var l=Math.round(c[2*k+1]/d*e);b.lineTo((k-i)*h+this.halfPixel,e-l+f)}b.closePath(),b.fill()}},fillRect:function(a,b,c,d){for(var e in this.canvases){var f=this.canvases[e],g=e*this.maxCanvasWidth,h={x1:Math.max(a,e*this.maxCanvasWidth),y1:b,x2:Math.min(a+c,e*this.maxCanvasWidth+f.waveCtx.canvas.width),y2:b+d};h.x1<h.x2&&(this.setFillStyles(f),this.fillRectToContext(f.waveCtx,h.x1-g,h.y1,h.x2-h.x1,h.y2-h.y1),this.fillRectToContext(f.progressCtx,h.x1-g,h.y1,h.x2-h.x1,h.y2-h.y1))}},fillRectToContext:function(a,b,c,d,e){a&&a.fillRect(b,c,d,e)},setFillStyles:function(a){a.waveCtx.fillStyle=this.params.waveColor,this.hasProgressCanvas&&(a.progressCtx.fillStyle=this.params.progressColor)},updateProgress:function(a){var b=Math.round(this.width*a)/this.params.pixelRatio;this.style(this.progressWave,{width:b+"px"})}}),function(){var b=function(){var b=document.querySelectorAll("wavesurfer");Array.prototype.forEach.call(b,function(b){var c=a.util.extend({container:b,backend:"MediaElement",mediaControls:!0},b.dataset);b.style.display="block";var d=a.create(c);if(b.dataset.peaks)var e=JSON.parse(b.dataset.peaks);d.load(b.dataset.url,e)})};"complete"===document.readyState?b():window.addEventListener("load",b)}(),a}),!function(a,b){"function"==typeof define&&define.amd?define(["wavesurfer"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("wavesurfer.js")):b(WaveSurfer)}(this,function(a){"use strict";a.Regions={init:function(a){this.wavesurfer=a,this.wrapper=this.wavesurfer.drawer.wrapper,this.list={}},add:function(b){var c=Object.create(a.Region);return c.init(b,this.wavesurfer),this.list[c.id]=c,c.on("remove",function(){delete this.list[c.id]}.bind(this)),c},clear:function(){Object.keys(this.list).forEach(function(a){this.list[a].remove()},this)},enableDragSelection:function(a){var b,c,d,e,f=this,g=a.slop||2,h=0,i=function(a){a.touches&&a.touches.length>1||(e=a.targetTouches?a.targetTouches[0].identifier:null,b=!0,c=f.wavesurfer.drawer.handleEvent(a,!0),d=null)};this.wrapper.addEventListener("mousedown",i),this.wrapper.addEventListener("touchstart",i),this.on("disable-drag-selection",function(){f.wrapper.removeEventListener("touchstart",i),f.wrapper.removeEventListener("mousedown",i)});var j=function(a){a.touches&&a.touches.length>1||(b=!1,h=0,d&&(d.fireEvent("update-end",a),f.wavesurfer.fireEvent("region-update-end",d,a)),d=null)};this.wrapper.addEventListener("mouseup",j),this.wrapper.addEventListener("touchend",j),this.on("disable-drag-selection",function(){f.wrapper.removeEventListener("touchend",j),f.wrapper.removeEventListener("mouseup",j)});var k=function(i){if(b&&!(++h<=g||i.touches&&i.touches.length>1||i.targetTouches&&i.targetTouches[0].identifier!=e)){d||(d=f.add(a||{}));var j=f.wavesurfer.getDuration(),k=f.wavesurfer.drawer.handleEvent(i);d.update({start:Math.min(k*j,c*j),end:Math.max(k*j,c*j)})}};this.wrapper.addEventListener("mousemove",k),this.wrapper.addEventListener("touchmove",k),this.on("disable-drag-selection",function(){f.wrapper.removeEventListener("touchmove",k),f.wrapper.removeEventListener("mousemove",k)})},disableDragSelection:function(){this.fireEvent("disable-drag-selection")}},a.util.extend(a.Regions,a.Observer),a.Region={style:a.Drawer.style,init:function(b,c){this.wavesurfer=c,this.wrapper=c.drawer.wrapper,this.id=null==b.id?a.util.getId():b.id,this.start=Number(b.start)||0,this.end=null==b.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(b.end),this.resize=void 0===b.resize||Boolean(b.resize),this.drag=void 0===b.drag||Boolean(b.drag),this.loop=Boolean(b.loop),this.color=b.color||"rgba(0, 0, 0, 0.1)",this.data=b.data||{},this.attributes=b.attributes||{},this.maxLength=b.maxLength,this.minLength=b.minLength,this.bindInOut(),this.render(),this.wavesurfer.on("zoom",this.updateRender.bind(this)),this.wavesurfer.fireEvent("region-created",this)},update:function(a){null!=a.start&&(this.start=Number(a.start)),null!=a.end&&(this.end=Number(a.end)),null!=a.loop&&(this.loop=Boolean(a.loop)),null!=a.color&&(this.color=a.color),null!=a.data&&(this.data=a.data),null!=a.resize&&(this.resize=Boolean(a.resize)),null!=a.drag&&(this.drag=Boolean(a.drag)),null!=a.maxLength&&(this.maxLength=Number(a.maxLength)),null!=a.minLength&&(this.minLength=Number(a.minLength)),null!=a.attributes&&(this.attributes=a.attributes),this.updateRender(),this.fireEvent("update"),this.wavesurfer.fireEvent("region-updated",this)},remove:function(){this.element&&(this.wrapper.removeChild(this.element),this.element=null,this.fireEvent("remove"),this.wavesurfer.un("zoom",this.updateRender.bind(this)),this.wavesurfer.fireEvent("region-removed",this))},play:function(){this.wavesurfer.play(this.start,this.end),this.fireEvent("play"),this.wavesurfer.fireEvent("region-play",this)},playLoop:function(){this.play(),this.once("out",this.playLoop.bind(this))},render:function(){var a=document.createElement("region");a.className="wavesurfer-region",a.title=this.formatTime(this.start,this.end),a.setAttribute("data-id",this.id);for(var b in this.attributes)a.setAttribute("data-region-"+b,this.attributes[b]);if(this.wrapper.scrollWidth,this.style(a,{position:"absolute",zIndex:2,height:"100%",top:"0px"}),this.resize){var c=a.appendChild(document.createElement("handle")),d=a.appendChild(document.createElement("handle"));c.className="wavesurfer-handle wavesurfer-handle-start",d.className="wavesurfer-handle wavesurfer-handle-end";var e={cursor:"col-resize",position:"absolute",left:"0px",top:"0px",width:"1%",maxWidth:"4px",height:"100%"};this.style(c,e),this.style(d,e),this.style(d,{left:"100%"})}this.element=this.wrapper.appendChild(a),this.updateRender(),this.bindEvents(a)},formatTime:function(a,b){return(a==b?[a]:[a,b]).map(function(a){return[Math.floor(a%3600/60),("00"+Math.floor(a%60)).slice(-2)].join(":")}).join("-")},updateRender:function(a){var b,c=this.wavesurfer.getDuration();if(b=a?Math.round(this.wavesurfer.getDuration()*a):this.wrapper.scrollWidth,this.start<0&&(this.start=0,this.end=this.end-this.start),this.end>c&&(this.end=c,this.start=c-(this.end-this.start)),null!=this.minLength&&(this.end=Math.max(this.start+this.minLength,this.end)),null!=this.maxLength&&(this.end=Math.min(this.start+this.maxLength,this.end)),null!=this.element){var d=Math.round(this.start/c*b),e=Math.round(this.end/c*b)-d;this.style(this.element,{left:d+"px",width:e+"px",backgroundColor:this.color,cursor:this.drag?"move":"default"});for(var f in this.attributes)this.element.setAttribute("data-region-"+f,this.attributes[f]);this.element.title=this.formatTime(this.start,this.end)}},bindInOut:function(){var a=this;a.firedIn=!1,a.firedOut=!1;var b=function(b){!a.firedOut&&a.firedIn&&(a.start>=Math.round(100*b)/100||a.end<=Math.round(100*b)/100)&&(a.firedOut=!0,a.firedIn=!1,a.fireEvent("out"),a.wavesurfer.fireEvent("region-out",a)),!a.firedIn&&a.start<=b&&a.end>b&&(a.firedIn=!0,a.firedOut=!1,a.fireEvent("in"),a.wavesurfer.fireEvent("region-in",a))};this.wavesurfer.backend.on("audioprocess",b),this.on("remove",function(){a.wavesurfer.backend.un("audioprocess",b)}),this.on("out",function(){a.loop&&a.wavesurfer.play(a.start)})},bindEvents:function(){var a=this;this.element.addEventListener("mouseenter",function(b){a.fireEvent("mouseenter",b),a.wavesurfer.fireEvent("region-mouseenter",a,b)}),this.element.addEventListener("mouseleave",function(b){a.fireEvent("mouseleave",b),a.wavesurfer.fireEvent("region-mouseleave",a,b)}),this.element.addEventListener("click",function(b){b.preventDefault(),a.fireEvent("click",b),a.wavesurfer.fireEvent("region-click",a,b)}),this.element.addEventListener("dblclick",function(b){b.stopPropagation(),b.preventDefault(),a.fireEvent("dblclick",b),a.wavesurfer.fireEvent("region-dblclick",a,b)}),(this.drag||this.resize)&&function(){var b,c,d,e,f=a.wavesurfer.getDuration(),g=function(g){g.touches&&g.touches.length>1||(e=g.targetTouches?g.targetTouches[0].identifier:null,g.stopPropagation(),d=a.wavesurfer.drawer.handleEvent(g,!0)*f,"handle"==g.target.tagName.toLowerCase()?c=g.target.classList.contains("wavesurfer-handle-start")?"start":"end":(b=!0,c=!1))},h=function(d){d.touches&&d.touches.length>1||(b||c)&&(b=!1,c=!1,a.fireEvent("update-end",d),a.wavesurfer.fireEvent("region-update-end",a,d))},i=function(g){if(!(g.touches&&g.touches.length>1)&&(!g.targetTouches||g.targetTouches[0].identifier==e)&&(b||c)){var h=a.wavesurfer.drawer.handleEvent(g)*f,i=h-d;d=h,a.drag&&b&&a.onDrag(i),a.resize&&c&&a.onResize(i,c)}};a.element.addEventListener("mousedown",g),a.element.addEventListener("touchstart",g),a.wrapper.addEventListener("mousemove",i),a.wrapper.addEventListener("touchmove",i),document.body.addEventListener("mouseup",h),document.body.addEventListener("touchend",h),a.on("remove",function(){document.body.removeEventListener("mouseup",h),document.body.removeEventListener("touchend",h),a.wrapper.removeEventListener("mousemove",i),a.wrapper.removeEventListener("touchmove",i)}),a.wavesurfer.on("destroy",function(){document.body.removeEventListener("mouseup",h),document.body.removeEventListener("touchend",h)})}()},onDrag:function(a){var b=this.wavesurfer.getDuration();this.end+a>b||this.start+a<0||this.update({start:this.start+a,end:this.end+a})},onResize:function(a,b){"start"==b?this.update({start:Math.min(this.start+a,this.end),end:Math.max(this.start+a,this.end)}):this.update({start:Math.min(this.end+a,this.start),end:Math.max(this.end+a,this.start)})}},a.util.extend(a.Region,a.Observer),a.initRegions=function(){this.regions||(this.regions=Object.create(a.Regions),this.regions.init(this))},a.addRegion=function(a){return this.initRegions(),this.regions.add(a)},a.clearRegions=function(){this.regions&&this.regions.clear()},a.enableDragSelection=function(a){this.initRegions(),this.regions.enableDragSelection(a)},a.disableDragSelection=function(){this.regions.disableDragSelection()}}),!function(a,b){"function"==typeof define&&define.amd?define(["wavesurfer"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("wavesurfer.js")):b(WaveSurfer)}(this,function(a){"use strict";a.Timeline={init:function(a){this.params=a;var b=this.wavesurfer=a.wavesurfer;if(!this.wavesurfer)throw Error("No WaveSurfer intance provided");var c=this.drawer=this.wavesurfer.drawer;if(this.container="string"==typeof a.container?document.querySelector(a.container):a.container,!this.container)throw Error("No container for WaveSurfer timeline");this.width=c.width,this.pixelRatio=this.drawer.params.pixelRatio,this.maxCanvasWidth=c.maxCanvasWidth||this.width,this.maxCanvasElementWidth=c.maxCanvasElementWidth||Math.round(this.maxCanvasWidth/this.pixelRatio),this.height=this.params.height||20,this.notchPercentHeight=this.params.notchPercentHeight||90,this.primaryColor=this.params.primaryColor||"#000",this.secondaryColor=this.params.secondaryColor||"#c0c0c0",this.primaryFontColor=this.params.primaryFontColor||"#000",this.secondaryFontColor=this.params.secondaryFontColor||"#000",this.fontFamily=this.params.fontFamily||"Arial",this.fontSize=this.params.fontSize||10,this.timeInterval=this.params.timeInterval,this.primaryLabelInterval=this.params.primaryLabelInterval,this.secondaryLabelInterval=this.params.secondaryLabelInterval,this.formatTimeCallback=this.params.formatTimeCallback,this.canvases=[],this.createWrapper(),this.render(),c.wrapper.addEventListener("scroll",function(a){this.updateScroll(a)}.bind(this)),b.on("redraw",this.render.bind(this)),b.on("destroy",this.destroy.bind(this))},destroy:function(){this.unAll(),this.wrapper&&this.wrapper.parentNode&&(this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)},createWrapper:function(){var a=this.container.querySelector("timeline");a&&this.container.removeChild(a);var b=this.wavesurfer.params;this.wrapper=this.container.appendChild(document.createElement("timeline")),this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.height+"px"}),(b.fillParent||b.scrollParent)&&this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"});var c=this;this.wrapper.addEventListener("click",function(a){a.preventDefault();var b="offsetX"in a?a.offsetX:a.layerX;c.fireEvent("click",b/c.wrapper.scrollWidth||0)})},removeOldCanvases:function(){for(;this.canvases.length>0;){var a=this.canvases.pop();a.parentElement.removeChild(a)}},createCanvases:function(){this.removeOldCanvases();for(var a,b=Math.round(this.drawer.wrapper.scrollWidth),c=Math.ceil(b/this.maxCanvasElementWidth),d=0;d<c;d++)a=this.wrapper.appendChild(document.createElement("canvas")),this.canvases.push(a),this.drawer.style(a,{position:"absolute",zIndex:4})},render:function(){this.createCanvases(),this.updateCanvasStyle(),this.drawTimeCanvases()},updateCanvasStyle:function(){for(var a=this.canvases.length,b=0;b<a;b++){var c=this.canvases[b],d=this.maxCanvasElementWidth;b===a-1&&(d=this.drawer.wrapper.scrollWidth-this.maxCanvasElementWidth*(a-1)),c.width=d*this.pixelRatio,c.height=this.height*this.pixelRatio,c.style.width=d+"px",c.style.height=this.height+"px",c.style.left=b*this.maxCanvasElementWidth+"px"}},drawTimeCanvases:function(){var a=this.wavesurfer.backend,b=this.wavesurfer.params,c=a.getDuration(),d=this;if(b.fillParent&&!b.scrollParent)var e=this.drawer.getWidth();else e=this.drawer.wrapper.scrollWidth*b.pixelRatio;var f=e/c;if(!(c<=0)){var g=0,h=0,i=parseInt(c,10)+1,j=function(a){if("function"==typeof d.formatTimeCallback)return d.formatTimeCallback(a);if(a/60>1){var b=parseInt(a/60),a=parseInt(a%60);return a=a<10?"0"+a:a,""+b+":"+a}return a};if(1*f>=25)var k=1,l=10,m=5;else if(5*f>=25)var k=5,l=6,m=2;else if(15*f>=25)var k=15,l=4,m=2;else var k=60,l=4,m=2;k=this.timeInterval||k,l=this.primaryLabelInterval||l,m=this.secondaryLabelInterval||m;for(var n=this.height-4,o=this.height*(this.notchPercentHeight/100)-4,p=this.fontSize*b.pixelRatio,q=0;q<i/k;q++)q%l==0?(this.setFillStyles(this.primaryColor),this.fillRect(g,0,1,n),this.setFonts(p+"px "+this.fontFamily),this.setFillStyles(this.primaryFontColor),this.fillText(j(h),g+5,n)):q%m==0?(this.setFillStyles(this.secondaryColor),this.fillRect(g,0,1,n),this.setFonts(p+"px "+this.fontFamily),this.setFillStyles(this.secondaryFontColor),this.fillText(j(h),g+5,n)):(this.setFillStyles(this.secondaryColor),this.fillRect(g,0,1,o)),h+=k,g+=f*k}},setFillStyles:function(a){for(var b in this.canvases)this.canvases[b].getContext("2d").fillStyle=a},setFonts:function(a){for(var b in this.canvases)this.canvases[b].getContext("2d").font=a},fillRect:function(a,b,c,d){for(var e in this.canvases){var f=this.canvases[e],g=e*this.maxCanvasWidth,h={x1:Math.max(a,e*this.maxCanvasWidth),y1:b,x2:Math.min(a+c,e*this.maxCanvasWidth+f.width),y2:b+d};h.x1<h.x2&&f.getContext("2d").fillRect(h.x1-g,h.y1,h.x2-h.x1,h.y2-h.y1)}},fillText:function(a,b,c){var d,e=0;for(var f in this.canvases){var g=this.canvases[f].getContext("2d"),h=g.canvas.width;if(e>b+d)break;e+h>b&&(d=g.measureText(a).width,g.fillText(a,b-e,c)),e+=h}},updateScroll:function(){this.wrapper.scrollLeft=this.drawer.wrapper.scrollLeft}},a.util.extend(a.Timeline,a.Observer)}),function(a){a.fn.divtotable=function(){var b=a('<div class="row">'),c=a('<h2 align="center"></h2>'),d=a('<strong style="font-size:16px"></strong>');d.html(a(this).find("#titre").html()),d.append('<a href="show_metadatas.php?id='+a(this).find("#crdo_id").html()+"&amp;lg="+a(this).find("#langue").html()+'" target="_blank"><img class="sansBordure" src="http://lacito.vjf.cnrs.fr/images/icones/info_marron.jpg"></a>'),c.append(d);var e=a("<a></a>");e.append(a(this).find("#langue").html());var f=a('<table width="100%"></table>'),g=a("<tbody></tbody>"),h=a("<tr></tr>"),i=a('<td align="left"></td>'),j=a('<td align="right"></td>');i.html("Chercheur(s) : ");var k=a('<span style="color:#333"></span>');k.append(a(this).find("#chercheurs").html()),i.append(k),j.html("Locuteur(s) : ");var k=a('<span style="color:#333"></span>');k.append(a(this).find("#locuteurs").html()),j.append(k),h.append(i).append(j),g.append(h),f.append(g),c.append("<br>").append(messages("Langue")+" : ").append(e).append("<br><br>").append(f);var l=a('<div class="sixteen wide column"></div>');l.append(a(this).find("audio")),l.append('<span style="margin-left:10px">Lecture en continu :</span>'),l.append('<input id="karaoke" name="karaoke" checked="checked" type="checkbox">'),b.append(c).append("<br>").append(l);var m=new Array,n=new Array;a(this).find(".transcription").each(function(){var b=a(this).attr("class").replace("transcription ","");a.inArray(b,m)<0&&m.push(b)}),a(this).find(".traduction").each(function(){
var b=a(this).attr("class").replace("traduction ","");a.inArray(b,n)<0&&n.push(b)});var o=a('<div class="sixteen wide column"></div>'),p=a('<table width="100%"></table>'),q=a("<tbody></tbody>"),r=a("<tr></tr>"),s=a("<td></td>"),t=a("<table></table>"),u=a("<tbody></tbody>");u.append("<tr><th>"+messages("Transcription par phrase")+"</th></tr>");var v=a("<tr></tr>"),w=a("<td></td>");a.each(m,function(){var b="transcription_"+this,c=a('<input type="checkbox" checked="checked" name="'+b+'">');w.append(c).append(this)}),u.append(v.append(w)),u.append("<tr> </tr>").append("<tr> </tr>").append("<tr> </tr>").append("<tr> </tr>").append("<tr><td><br></td></tr>"),u.append("<tr><th>"+messages("Traduction par phrase")+"</th></tr>");var x=a("<tr></tr>"),y=a("<td></td>");a.each(n,function(){var b="translation_"+this,c=a('<input type="checkbox" checked="checked" name="'+b+'">');y.append(c).append(this.toUpperCase())}),u.append(x.append(y)),s.append(t.append(u));var z=a("<td></td>"),A=a("<table></table>"),B=a("<tbody></tbody>");B.append("<tr><th>"+messages("Transcription du texte complet")+"</th></tr>");var v=a("<tr></tr>"),w=a("<td></td>");a.each(m,function(){var b="trans_text_"+this,c=a('<input type="checkbox" name="'+b+'">');w.append(c).append(this)}),B.append(v.append(w)),B.append("<tr><td><br></td></tr>"),B.append("<tr><th>"+messages("Traduction du texte complet")+"</th></tr>");var x=a("<tr></tr>"),y=a("<td></td>");a.each(n,function(){var b="trad_text_"+this,c=a('<input type="checkbox" name="'+b+'">');y.append(c).append(this.toUpperCase())}),B.append(x.append(y)),z.append(A.append(B));var C=a("<td></td>");C.append("<table><tbody><tr><th>"+messages("Mot à mot")+'</th><td><input checked="checked" name="interlinear" type="checkbox"></td></tr><tr><td><br></td></tr><tr><td><br></td></tr></tbody></table>'),b.append(o.append(p.append(q.append(r.append(s).append(z).append(C))))),a(this).parent().append(b);var D=a('<table xmlns:php="http://php.net/xsl" xmlns:crdo="http://crdo.risc.cnrs.fr/schemas/" xmlns:annot="http://crdo.risc.fr/schemas/annotation" width="100%" border="1" bordercolor="#993300" cellspacing="0" cellpadding="0"></table>'),E=a("<tbody></tbody>"),F=a("<tr></tr>"),G=a("<td></td>"),H=a('<table width="100%" border="0" cellpadding="5" cellspacing="0" bordercolor="#993300" class="it"></table>'),I=a("<tbody></tbody>"),J=0;a(this).find("#sentences .sentence").each(function(){var b=a('<tr class="transcriptTable"></tr>'),c=a('<td class="segmentInfo"></td>');c.attr("width","25"),J++,c.html("S"+J),b.append(c);var d=a('<td class="segmentContent"></td>'),e=a(this).attr("id");d.attr("id",e),d.append(a(this).find(".map").parent()),d.append('<a href="#" class="boutonStop"><img src="http://lacito.vjf.cnrs.fr/images/icones/stop.gif" alt="stop"></a>'),d.append('<a href="#" class="playFrom"><img src="http://lacito.vjf.cnrs.fr/images/icones/play.gif" alt="écouter"></a>'),b.append(d);var f=a('<div class="word_sentence"></div>');a(this).find(".transcription").each(function(){var b=a(this).attr("class").replace(" ","_"),c=a('<div class="'+b+'"></div>');c.html(a(this).html()),f.append(c)}),d.append(f),d.append("<br>"),a(this).find(".words > .word").each(function(){var b=a('<table class="word" link="'+a(this).attr("link")+'"></table>'),c=a("<tbody></tbody>"),e=a("<tr></tr>"),f=a('<td class="word_form"></td>');f.html(a(this).find(".word_transcription").html()),e.append(f),c.append(e);var g=a("<tr></tr>"),h=a('<td class="word_transl" valign="top"></td>');h.html(a(this).find(".word_traduction").first().html()),g.append(h),c.append(g),b.append(c),d.append(b)}),d.append("<br><br>"),a(this).find(".traduction").each(function(){var b=a(this).attr("class").replace(" ","_").replace("traduction","translation"),c=a('<div class="'+b+'"></div>');c.html(a(this).html()),c.append("<br><br>"),d.append(c)}),d.append('<div class="note_info></div>'),I.append(b)}),H.append(I),G.append(H),F.append(G),E.append(F),D.append(E),a(this).parent().append(D),a.each(n,function(){var b=a('<tr class="transcriptTable"></tr>');b.append('<td class="segmentInfo"></td>');var c=a('<td class="segmentContent"></td>'),d=a('<div style="display:none;" class="trans_text trad_text_'+this+'"></div>');a(".translation_"+this).each(function(){d.append(a(this).html().replace(/<br>/g,"")),d.append("<br>")}),I.prepend(b.append(c.append(d)))}),a.each(m,function(){var b=a('<tr class="transcriptTable"></tr>');b.append('<td class="segmentInfo"></td>');var c=a('<td class="segmentContent"></td>'),d=a('<div class="trans_text trans_text_'+this+'"></div>');a(".word_sentence > .transcription_"+this).each(function(){d.append(a(this).html()),d.append("<br>")}),I.prepend(b.append(c.append(d)))}),a("input[name^='trans_text_']").bind("click",function(){var b=a(this).attr("name");a(this).is(":checked")?a("."+b).css("display","block"):a("."+b).css("display","none")}),a("input[name^='trad_text_']").bind("click",function(){var b=a(this).attr("name");a(this).is(":checked")?a("."+b).css("display","block"):a("."+b).css("display","none")}),a("input[name^='transcription_'], input[name^='translation_']").bind("click",function(){var b=a(this).attr("name");a(this).is(":checked")?a("."+b).each(function(){this.style.setProperty("display","block","important")}):a("."+b).each(function(){this.style.setProperty("display","none","important")})}),a("input[name='interlinear']").bind("click",function(){a(this).is(":checked")?a(".word").css("display","inline-block"):a(".word").css("display","none")}),a("a.playFrom").bind("click",function(){var b=a(this).parent().attr("id");playFrom(b)}),a("a.boutonStop").bind("click",function(){boutonStop(),console.log("click stop")}),a(this).css("display","none")}}(jQuery);var idlist=new Array,timelist_starts=new Array,timelist_ends=new Array,idwordlist=new Array,timewordlist_starts=new Array,timewordlist_ends=new Array,idwordlist2=new Array,timewordlist_starts2=new Array,timewordlist_ends2=new Array,highlight_color="blue";!function(a){a.fn.eastlingplayer=function(b){function c(b,c,d,e,g){var h="",i=(new Array,new Array,new Array,0);g.attr("src",e);var j=(h.split("_")[1],a('<div id="info"></div>')),k=a('<div id="titre"></div>'),l=a('<div id="chercheurs"></div>'),m=a('<div id="langue"></div>'),n=a('<div id="locuteurs"></div>'),o=a('<div id="date"></div>'),p=a('<div id="crdo_id"></div>'),q=new Array,r=new Array;a.each(c.contributors,function(){switch(this.code){case"researcher":q.push(this.contributor);break;case"speaker":r.push(this.contributor)}}),k.html(c.title.title),l.html(q.join(";")),m.html(c.subject[0].subject),n.html(r.join(",")),o.html(c.date),f.local||p.html(c.crdo_id_audio),j.append(k).append(l).append(m),j.append(n).append(o).append(p),g.before(j);var s=-120,t=a('<div id="sentences"></div>'),u=1;a.each(b,function(){s+=120,i++;var b=99999,c=0,e=99999,h=0;a.each(this.areas,function(){this.y2>h&&(h=this.y2),this.y1<e&&(e=this.y1),this.x2>c&&(c=this.x2),this.x1<b&&(b=this.x1)}),image_scope=h-e,image_width=c-b;var j=0;j=parseInt(e);var k=a('<div class="sentence"></div>');k.attr("id",this.id),idlist.push(this.id),timelist_starts.push(1e3*this.startPosition),timelist_ends.push(1e3*this.endPosition);var l=a("<div class='map'></div>"),m=a("<img>"),n=a("<map></map>"),o=a("<div></div>");image_id=this.areas[0].image;var p="";a.each(d,function(){this.indexOf(image_id)>0&&(p=this)}),m.attr("src",p),m.attr("width",image_width),m.attr("height",image_scope),m.attr("usemap","#map"+i),m.attr("id","ligne"+i),m.attr("class","map maphilighted");var q=b,r=e;m.css("background-position","-"+q+"px -"+r+"px"),l.append(m),l.css("background","url("+p+") -"+q+"px -"+r+"px"),l.css("width",image_width),l.css("height",image_scope),n.attr("id","map"+i),n.attr("name","map"+i),o.append(l),k.append(o),a.each(this.transcriptions,function(){var b=a('<div class="transcription '+this.lang+'">'+this.transcription+"</div>");k.append(b)});var v=a('<div class="words"></div>'),w=!0,x=0,y=0,z=new Array;z=f.local?this.children:this.words,z.length>0&&a.each(z,function(){var b=this.id;w&&(x=this.areas[0].x1,y=this.areas[0].y1,w=!1),this.areas[0].x1-=q,this.areas[0].y1-=r,this.areas[0].x2-=q,this.areas[0].y2-=r;var c=a('<div class="word" link="'+this.id+'"></div>');a.each(this.transcriptions,function(){c.append('<div class="word_transcription '+this.lang+'">'+this.transcription+"</div>")}),a.each(this.traductions,function(){c.append('<div class="word_traduction '+this.lang+'">'+this.traduction+"</div>")}),v.append(c);var d=a("<area>");idwordlist.push(b),timewordlist_starts.push(1e3*this.startPosition),timewordlist_ends.push(1e3*this.endPosition),d.attr("id",b),d.attr("shape","rect"),d.attr("coords",this.areas[0].x1+","+this.areas[0].y1+","+this.areas[0].x2+","+this.areas[0].y2),d.attr("title",this.transcriptions[0].transcription),d.attr("href","#"),d.attr("data-maphilight",'{"strokeColor":"'+f.strokeColor+'","strokeWidth":'+f.strokeWidth+',"fillColor":"'+f.fillColor+'","fillOpacity":'+f.fillOpacity+"}"),d.appendTo(n)}),o.append(n),k.append(v),a.each(this.traductions,function(){var b=a('<div class="traduction '+this.lang+'">'+this.traduction+"</div>");k.append(b)}),u++,t.append(k),g.parent().append(t)}),a("#player").on("play",function(){console.log(this.currentTime),0===this.currentTime&&a("a.playFrom:first").click()})}function d(b,c,d,e,g){var h="",i=(new Array,new Array,new Array,0);g.attr("src",e);var j=(h.split("_")[1],a('<div id="info"></div>')),k=a('<div id="titre"></div>'),l=a('<div id="chercheurs"></div>'),m=a('<div id="langue"></div>'),n=a('<div id="locuteurs"></div>'),o=a('<div id="date"></div>'),p=a('<div id="crdo_id"></div>'),q=new Array,r=new Array;a.each(c.contributors,function(){switch(this.code){case"researcher":q.push(this.contributor);break;case"speaker":r.push(this.contributor)}}),k.html(c.title.title),l.html(q.join(";")),m.html(c.subject[0].subject),n.html(r.join(",")),o.html(c.date),f.local||p.html(c.crdo_id_audio),j.append(k).append(l).append(m),j.append(n).append(o).append(p),g.before(j);var s=-120,t=a('<div id="sentences"></div>'),u=1;a.each(b,function(){var b=this.id;idwordlist2[b]=new Array,timewordlist_starts2[b]=new Array,timewordlist_ends2[b]=new Array,s+=120,i++;var c=99999,e=0,h=99999,j=0;a.each(this.areas,function(){this.y2>j&&(j=this.y2),this.y1<h&&(h=this.y1),this.x2>e&&(e=this.x2),this.x1<c&&(c=this.x1)}),image_scope=j-h,image_width=e-c;var k=0;k=parseInt(h);var l=a('<div class="sentence"></div>');l.attr("id",b),idlist.push(b),timelist_starts.push(1e3*this.startPosition),timelist_ends.push(1e3*this.endPosition);var m=a("<div class='map'></div>"),n=a("<img>"),o=a("<map></map>"),p=a("<div></div>");image_id=this.areas[0].image;var q="";a.each(d,function(){this.id==image_id&&(q=this.url)}),n.attr("src",q),n.attr("width",image_width),n.attr("height",image_scope),n.attr("usemap","#map"+i),n.attr("id","ligne"+i),n.attr("class","map maphilighted");var r=c,v=h;n.css("background-position","-"+r+"px -"+v+"px"),m.append(n),m.css("background","url("+q+") -"+r+"px -"+v+"px"),m.css("width",image_width),m.css("height",image_scope),o.attr("id","map"+i),o.attr("name","map"+i),p.append(m),l.append(p),a.each(this.transcriptions,function(){var b=a('<div class="transcription '+this.lang+'">'+this.transcription+"</div>");l.append(b)});var w=a('<div class="words"></div>'),x=!0,y=0,z=0,A=new Array;A=this.children,A.length>0&&a.each(A,function(){0==this.areas.length&&this.areas.push({x1:0,x2:0,y1:0,y2:0});var c=this.id;x&&(y=this.areas[0].x1,z=this.areas[0].y1,x=!1);var d={x1:this.areas[0].x1-r,x2:this.areas[0].x2-r,y1:this.areas[0].y1-v,y2:this.areas[0].y2-v},e=a('<div class="word" link="'+this.id+'"></div>');a.each(this.transcriptions,function(){e.append('<div class="word_transcription '+this.lang+'">'+this.transcription+"</div>")}),a.each(this.traductions,function(){e.append('<div class="word_traduction '+this.lang+'">'+this.traduction+"</div>")}),w.append(e);var g=a("<area>");idwordlist.push(c),timewordlist_starts.push(1e3*this.startPosition),timewordlist_ends.push(1e3*this.endPosition),idwordlist2[b].push(c),timewordlist_starts2[b].push(1e3*this.startPosition),timewordlist_ends2[b].push(1e3*this.endPosition),g.attr("id",c),g.attr("shape","rect"),g.attr("coords",d.x1+","+d.y1+","+d.x2+","+d.y2),g.attr("title",this.transcriptions[0].transcription),g.attr("href","#"),g.attr("data-maphilight",'{"strokeColor":"'+f.strokeColor+'","strokeWidth":'+f.strokeWidth+',"fillColor":"'+f.fillColor+'","fillOpacity":'+f.fillOpacity+"}"),g.appendTo(o)}),p.append(o),l.append(w),a.each(this.traductions,function(){var b=a('<div class="traduction '+this.lang+'">'+this.traduction+"</div>");l.append(b)}),u++,t.append(l),g.parent().append(t)}),a("#player").on("play",function(){console.log(this.currentTime),0===this.currentTime&&a("a.playFrom:first").click()})}var e={idref:null,url:null,local:!1,localDocument:null,callback:null,strokeColor:"0088cc",strokeWidth:4,fillColor:"ffffff",fillOpacity:0},f=a.extend(e,b);return highlight_color="#"+f.strokeColor,this.each(function(){var b=a('<audio class="eastlingplayer" id="player" src="" controls></audio>');a(this).empty(),a(this).append(b);var e,g,h,i=new Array;if(f.local){var j=f.localDocument;h=j.annotations,e=j.metadata,i=j.url_images,g=j.url_audio,d(h,e,i,g,b),f.callback&&f.callback()}else f.url||a.ajax({type:"POST",url:"getDocument.php",data:{idref:f.idref},dataType:"json",success:function(a){h=a.annotations,e=a.metadata,i=a.url_image,g=a.url_audio,c(h,e,i,g,b),f.callback&&f.callback()},error:function(a,b,c){console.log(a),console.log(c)}})}),!0}}(jQuery),function(a){a.fn.eastlingShape=function(){var b=a('<div class="row ui one column doubling grid">'),c=a('<div class="row ui three column doubling grid">'),d=a('<div class="row ui two column doubling grid">'),e=a('<div class="row ui three column doubling grid">');a(this).parent().append(b),a(this).parent().append(c),a(this).parent().append(d),a(this).parent().append(e);var f=(a('<h2 align="center"></h2>'),a('<h1 class="ui header aligned center"></h1>'));b.append(f),f.html(a(this).find("#titre").html());var g=a("<a></a>");g.append(a(this).find("#langue").html());var h=a('<div class="column"></div>');h.html("Langue : "),h.append(a(this).find("#langue").html());var i=a('<div class="column"></div>');i.html("Chercheur(s) : "),i.append(a(this).find("#chercheurs").html());var j=a('<div class="column"></div>');j.html("Locuteur(s) : "),j.append(a(this).find("#locuteurs").html()),c.append(messages("Langue")+" : ").append(h).append(i).append(j);var k=a('<div class="column"></div>');k.append(a(this).find("audio")),d.append(k),d.append('<div class="column checkbox"><label>Lecture en continu</label> : <input id="karaoke" name="karaoke" checked="checked" type="checkbox"></div>');var l=new Array,m=new Array;a(this).find(".transcription").each(function(){var b=a(this).attr("class").replace("transcription ","");a.inArray(b,l)<0&&l.push(b)}),a(this).find(".traduction").each(function(){var b=a(this).attr("class").replace("traduction ","");a.inArray(b,m)<0&&m.push(b)});var n=a('<div class="column"></div>'),o=a('<div class="column"></div>'),p=a('<div class="column"></div>'),q=a('<div class="column"></div>'),r=a('<div class="column"></div>'),s=["zero","one","two","three","four","five","six","seven","eight","nine","ten"];e.append(o).append(p).append(n),e.append(q).append(r),o.append('<h3 class="ui header">'+messages("Transcription par phrase")+"</h3>");var t=a('<div class="ui '+s[l.length]+' column grid"></div>');o.append(t);a('<div class="ui form"></div>');a.each(l,function(){var b=a('<div class="column inline field"><div class = "ui checkbox"></div></div>'),c="transcription_"+this,d=a('<input type="checkbox" checked="checked" name="'+c+'">');b.append(d).append("<label>"+this+"</label>"),t.append(b)}),q.append('<h3 class="ui header">'+messages("Traduction par phrase")+"</h3>");var u=a('<div class="ui '+s[m.length]+' column grid"></div>');q.append(u),a.each(m,function(){var b=a('<div class="column inline field"><div class = "ui checkbox"></div></div>'),c="translation_"+this,d=a('<input type="checkbox" checked="checked" name="'+c+'">');b.append(d).append("<label>"+this.toUpperCase()+"</label>"),u.append(b)}),p.append('<h3 class="ui header">'+messages("Transcription du texte complet")+"</div>");var v=a('<div class="ui '+s[l.length]+' column grid"></div>');p.append(v),a.each(l,function(){var b=a('<div class="column inline field"><div class = "ui checkbox"></div></div>'),c="trans_text_"+this,d=a('<input type="checkbox" name="'+c+'">');b.append(d).append("<label>"+this+"</label>"),v.append(b)}),r.append('<h3 class="ui header">'+messages("Traduction du texte complet")+"</div>");var w=a('<div class="ui '+s[m.length]+' column grid"></div>');r.append(w),a.each(m,function(){var b=a('<div class="column inline field"><div class = "ui checkbox"></div></div>'),c="trad_text_"+this,d=a('<input type="checkbox" name="'+c+'">');b.append(d).append("<label>"+this.toUpperCase()+"</label>"),w.append(b)});var x=a('<div class="inline field"><div class = "ui checkbox"></div></div>');x.append('<input checked="checked" name="interlinear" type="checkbox">').append("<label>"+messages("Mot à mot")+"</label>"),n.append(x);var y=a('<div class="ui"></div>'),z=0;a(this).find("#sentences .sentence").each(function(){var b=a('<div class=""></div>'),c=a('<div class="segmentInfo"></div>');c.attr("width","25"),z++,c.html("S"+z),b.append(c);var d=a('<div class="eastlingShape"></td>'),e=a(this).attr("id");d.attr("id",e),d.append(a(this).find(".map").parent()),d.append('<a href="#" class="boutonStop" style="font-size:12px;">⏹</a>'),d.append('<a href="#" class="playFrom" style="font-size:12px;">▶️</a>'),b.append(d);var f=a('<div class="word_sentence"></div>');a(this).find(".transcription").each(function(){var b=a(this).attr("class").replace(" ","_"),c=a('<div class="'+b+'"></div>');c.html(a(this).html()),f.append(c)}),d.append(f),d.append("<br>"),a(this).find(".words > .word").each(function(){var b=a('<div style="display:inline;" class="word ui basic accordion" link="'+a(this).attr("link")+'"></div>'),c=a('<div class="word_form title" style="padding:0px !important;"></div>');c.append('<i class="dropdown icon"></i>'),c.append(a(this).find(".word_transcription").html()),b.append(c);var e=a('<div class="content"></div>');b.append(e),a(this).find(".word_traduction").each(function(){var b=a(this).attr("class").split("word_traduction")[1].trim();e.append("<p>"+b+" : "+a(this).html()+"</p>")}),d.append(b),b.accordion()}),a(this).find(".traduction").each(function(){var b=a(this).attr("class").replace(" ","_").replace("traduction","translation"),c=a('<div class="'+b+'"></div>');c.html(a(this).html()),c.append("<br><br>"),d.append(c)}),d.append('<div class="note_info></div>'),y.append(b)}),a(this).parent().append(y),a.each(m,function(){var b=a('<div class="transcriptTable"></div>');b.append('<div class="segmentInfo"></div>');var c=a('<div class="segmentContent"></div>'),d=a('<div style="display:none;" class="trans_text trad_text_'+this+'"></div>');a(".translation_"+this).each(function(){d.append(a(this).html().replace(/<br>/g,"")),d.append("<br>")}),y.prepend(b.append(c.append(d)))}),a.each(l,function(){var b=a('<tr class="transcriptTable"></tr>');b.append('<td class="segmentInfo"></td>');var c=a('<td class="segmentContent"></td>'),d=a('<div class="trans_text trans_text_'+this+'"></div>');a(".word_sentence > .transcription_"+this).each(function(){d.append(a(this).html()),d.append("<br>")}),y.prepend(b.append(c.append(d)))}),a("input[name^='trans_text_']").bind("click",function(){var b=a(this).attr("name");a(this).is(":checked")?a("."+b).css("display","block"):a("."+b).css("display","none")}),a("input[name^='trad_text_']").bind("click",function(){var b=a(this).attr("name");a(this).is(":checked")?a("."+b).css("display","block"):a("."+b).css("display","none")}),a("input[name^='transcription_'], input[name^='translation_']").bind("click",function(){var b=a(this).attr("name");a(this).is(":checked")?a("."+b).css("display","block"):a("."+b).css("display","none")}),a("input[name='interlinear']").bind("click",function(){a(this).is(":checked")?a(".word").css("display","inline"):a(".word").css("display","none")}),a("a.playFrom").bind("click",function(){var b=a(this).parent().attr("id");playFrom(b)}),a("a.boutonStop").bind("click",function(){boutonStop(),console.log("click stop")}),a(this).css("display","none")}}(jQuery);var styleProperty="border",activateState="solid 1px #993300",inactivateState="solid 0px white",ns="Netscape"==navigator.appName,before=0,currentSentenceId=0;!function(a){var b,c,d,e,f,g,h,j,k,l,m;if(c=!!document.createElement("canvas").getContext,b=function(){var a=document.createElement("div");a.innerHTML='<v:shape id="vml_flag1" adj="1" />';var b=a.firstChild;return b.style.behavior="url(#default#VML)",!b||"object"==typeof b.adj}(),!c&&!b)return void(a.fn.maphilight=function(){return this});if(c){j=function(a){return Math.max(0,Math.min(parseInt(a,16),255))},k=function(a,b){return"rgba("+j(a.substr(0,2))+","+j(a.substr(2,2))+","+j(a.substr(4,2))+","+b+")"},d=function(b){var c=a('<canvas style="width:'+b.width+"px;height:"+b.height+'px;"></canvas>').get(0);return c.getContext("2d").clearRect(0,0,c.width,c.height),c};var n=function(a,b,c,d,e){if(d=d||0,e=e||0,a.beginPath(),"rect"==b)a.rect(c[0]+d,c[1]+e,c[2]-c[0],c[3]-c[1]);else if("poly"==b)for(a.moveTo(c[0]+d,c[1]+e),i=2;i<c.length;i+=2)a.lineTo(c[i]+d,c[i+1]+e);else"circ"==b&&a.arc(c[0]+d,c[1]+e,c[2],0,2*Math.PI,!1);a.closePath()};e=function(b,c,d,e,f){var g=b.getContext("2d");if(e.shadow){g.save(),"inside"==e.shadowPosition&&(n(g,c,d),g.clip());var h=100*b.width,i=100*b.height;n(g,c,d,h,i),g.shadowOffsetX=e.shadowX-h,g.shadowOffsetY=e.shadowY-i,g.shadowBlur=e.shadowRadius,g.shadowColor=k(e.shadowColor,e.shadowOpacity);var j=e.shadowFrom;j||(j="outside"==e.shadowPosition?"fill":"stroke"),"stroke"==j?(g.strokeStyle="rgba(0,0,0,1)",g.stroke()):"fill"==j&&(g.fillStyle="rgba(0,0,0,1)",g.fill()),g.restore(),"outside"==e.shadowPosition&&(g.save(),n(g,c,d),g.globalCompositeOperation="destination-out",g.fillStyle="rgba(0,0,0,1);",g.fill(),g.restore())}g.save(),n(g,c,d),e.fill&&(g.fillStyle=k(e.fillColor,e.fillOpacity),g.fill()),e.stroke&&(g.strokeStyle=k(e.strokeColor,e.strokeOpacity),g.lineWidth=e.strokeWidth,g.stroke()),g.restore(),e.fade&&a(b).css("opacity",0).animate({opacity:1},100)},f=function(a){a.getContext("2d").clearRect(0,0,a.width,a.height)}}else d=function(b){return a('<var style="zoom:1;overflow:hidden;display:block;width:'+b.width+"px;height:"+b.height+'px;"></var>').get(0)},e=function(b,c,d,e,f){var g,h,i,j;for(var k in d)d[k]=parseInt(d[k],10);g='<v:fill color="#'+e.fillColor+'" opacity="'+(e.fill?e.fillOpacity:0)+'" />',h=e.stroke?'strokeweight="'+e.strokeWidth+'" stroked="t" strokecolor="#'+e.strokeColor+'"':'stroked="f"',i='<v:stroke opacity="'+e.strokeOpacity+'"/>',"rect"==c?j=a('<v:rect name="'+f+'" filled="t" '+h+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+d[0]+"px;top:"+d[1]+"px;width:"+(d[2]-d[0])+"px;height:"+(d[3]-d[1])+'px;"></v:rect>'):"poly"==c?j=a('<v:shape name="'+f+'" filled="t" '+h+' coordorigin="0,0" coordsize="'+b.width+","+b.height+'" path="m '+d[0]+","+d[1]+" l "+d.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+b.width+"px;height:"+b.height+'px;"></v:shape>'):"circ"==c&&(j=a('<v:oval name="'+f+'" filled="t" '+h+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(d[0]-d[2])+"px;top:"+(d[1]-d[2])+"px;width:"+2*d[2]+"px;height:"+2*d[2]+'px;"></v:oval>')),j.get(0).innerHTML=g+i,a(b).append(j)},f=function(b){var c=a("<div>"+b.innerHTML+"</div>");c.children("[name=highlighted]").remove(),b.innerHTML=c.html()};g=function(a){var b,c=a.getAttribute("coords").split(",");for(b=0;b<c.length;b++)c[b]=parseFloat(c[b]);return[a.getAttribute("shape").toLowerCase().substr(0,4),c]},m=function(b,c){var d=a(b);return a.extend({},c,!!a.metadata&&d.metadata(),d.data("maphilight"))},l=function(a){return!!a.complete&&("undefined"==typeof a.naturalWidth||0!==a.naturalWidth)},h={position:"absolute",left:0,top:0,padding:0,border:0};var o=!1;a.fn.maphilight=function(i){return i=a.extend({},a.fn.maphilight.defaults,i),c||o||(a(window).ready(function(){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var b=document.createStyleSheet(),c=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];a.each(c,function(){b.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")})}),o=!0),this.each(function(){var j,k,n,o,p,q,r,s;if(j=a(this),!l(this))return window.setTimeout(function(){j.maphilight(i)},200);if(n=a.extend({},i,!!a.metadata&&j.metadata(),j.data("maphilight")),s=j.get(0).getAttribute("usemap"),s&&(o=a('map[name="'+s.substr(1)+'"]'),j.is('img,input[type="image"]')&&s&&o.size()>0)){if(j.hasClass("maphilighted")){var t=j.parent();j.insertBefore(t),t.remove(),a(o).unbind(".maphilight").find("area[coords]").unbind(".maphilight")}k=a("<div></div>").css({display:"block",background:'url("'+this.src+'")',position:"relative",padding:0,width:this.width,height:this.height}),n.wrapClass&&(n.wrapClass===!0?k.addClass(a(this).attr("class")):k.addClass(n.wrapClass)),j.before(k).css("opacity",0).css(h).remove(),b&&j.css("filter","Alpha(opacity=0)"),k.append(j),p=d(this),a(p).css(h),p.height=this.height,p.width=this.width,r=function(b){var d,f;if(f=m(this,n),!f.neverOn&&!f.alwaysOn){if(d=g(this),e(p,d[0],d[1],f,"highlighted"),f.groupBy){var h;h=/^[a-zA-Z][\-a-zA-Z]+$/.test(f.groupBy)?o.find("area["+f.groupBy+'="'+a(this).attr(f.groupBy)+'"]'):o.find(f.groupBy);var i=this;h.each(function(){if(this!=i){var a=m(this,n);if(!a.neverOn&&!a.alwaysOn){var b=g(this);e(p,b[0],b[1],a,"highlighted")}}})}c||a(p).append("<v:rect></v:rect>")}},a(o).bind("alwaysOn.maphilight",function(){q&&f(q),c||a(p).empty(),a(o).find("area[coords]").each(function(){var b,f;f=m(this,n),f.alwaysOn&&(!q&&c&&(q=d(j[0]),a(q).css(h),q.width=j[0].width,q.height=j[0].height,j.before(q)),f.fade=f.alwaysOnFade,b=g(this),c?e(q,b[0],b[1],f,""):e(p,b[0],b[1],f,""))})}),a(o).trigger("alwaysOn.maphilight").find("area[coords]").bind("mouseover.maphilight",r).bind("mouseout.maphilight",function(a){f(p)}),j.before(p),j.addClass("maphilighted"),j.parent().css("background-position",j.css("background-position"))}})},a.fn.maphilight.defaults={fill:!0,fillColor:"000000",fillOpacity:.2,stroke:!0,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:!0,alwaysOn:!1,neverOn:!1,groupBy:!1,wrapClass:!0,shadow:!1,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:.8,shadowPosition:"outside",shadowFrom:!1}}(jQuery),$(document).ready(function(){bindAutocomplete(),$(".autocomplete.isopays").each(function(){$(this);$(this).next("results_autocomplete").remove();var a=$("<div></div>");a.addClass("results_autocomplete"),a.css("position","absolute"),a.css("left","0"),a.css("-webkit-transform-origin","center top"),a.css("-ms-transform-origin","center top"),a.css("transform-origin","center top"),a.css("background","#fff"),a.css("z-index","998"),a.css("border-radius",".30rem"),a.css("border","1px solid #d4d4d5"),$(this).after(a),$(this).on("keyup",function(){$(this).next(".results_autocomplete").empty().show();var a=$(this),b=a.val(),c=$(this).attr("acin");$.post("getCountryFromISO",{YII_CSRF_TOKEN:token,search:b,in:c},function(b){var c=$.parseJSON(b);$.each(c,function(){a.next(".results_autocomplete").append('<a class="result"><div class="content"><div class="title">'+this.Name+" / "+this.Code+"</div></div></a>")}),$(".results_autocomplete .result").on("click",function(){var a=$(this).parent().parent().find("input"),b=a.attr("id"),c=a.attr("actarget"),d=a.attr("acin"),e=$(this).find(".title").html(),f=e.split(" / ")[0],g=e.split(" / ")[1];c===b?a.val(g):"Code"===d?(a.val(g),a.parent().parent().find("#"+c).val(f)):(a.val(f),a.parent().parent().find("#"+c).val(g)),$(this).parent().empty().hide(),$("input#codepays").change()})})})})}),$(document).ready(function(){console.log("eastling_menu"),$("#mainmenu").sidebar({exclusive:!1}).sidebar("attach events",".toggle-menu","toggle").sidebar("hide"),$("#lang_user").dropdown("setting","onChange",function(a){localStorage.setItem("langUser",a);var b=window.location.href,c=window.location.href.split("index.php/")[1].split("/")[0],d="index.php/"+c,e="index.php/"+a,f=b.replace(d,e);window.location.href=f});var a=window.location.href.split("index.php/")[1].split("/")[0];"fr"==a?($("#traduction_1_langue").val("fra"),$("#title_1_langue").val("fra")):"en"==a&&($("#traduction_1_langue").val("eng"),$("#title_1_langue").val("eng"))});var documents=new Array,user,currentDocument=localStorage.getItem("document"),currentLangue=localStorage.getItem("langue"),currentStep=localStorage.getItem("step"),langUser=localStorage.getItem("langUser"),langues_user=new Array,wavesurfer=WaveSurfer.create({container:"#waveform",scrollParent:!0,waveColor:"rgba(0,0,0,1)",height:100}),timeline=Object.create(WaveSurfer.Timeline),slider=document.querySelector("#slider");slider.oninput=function(){var a=Number(slider.value);wavesurfer.zoom(a)};var playerAction="",o_imgAreaSelect,rules_newdoc,rules_newselection,selected_areas=new Array,file_mp3="",file_wav="",images=new Array,o_Currentdocument,json_document,fileids=[],toload=[],loaded=[];$(document).ajaxStart(function(){$("#loading").addClass("active")}),$(document).ajaxStop(function(){$("#loading").removeClass("active")}),$(document).ready(function(){$("#btn-refresh-preview").on("click",function(){refreshPreview()}),$(".sortable").sortable(),$(".sortable").disableSelection(),$("#audio-compo").toggle(),$("#annotations").sidebar({exclusive:!1,onShow:function(){$("#open-annotations").css("right",$(this).width())},onHide:function(){$("#open-annotations").css("right",0)}}).sidebar("attach events","#open-annotations","toggle"),$("#metadata").sidebar({exclusive:!1,onShow:function(){$("#open-metadata").css("right",$(this).width())},onHide:function(){$("#open-metadata").css("right",0)}}).sidebar("attach events","#open-metadata","toggle"),$("#loading .loader").html(messages("Chargement du formulaire")),$("#loading").addClass("active"),$("#form-compo").formToWizard({submitButton:"Enregistrer"}),$("#loading").removeClass("active"),$("#form-compo").show(),$("#step0Next").hide(),$("#newdoc .fields .remove").hide(),$("#form-compo button[id^='step']").on("click",function(){"block"==$("#step2").css("display")?($("#audio-compo").show(),wavesurfer.drawBuffer()):$("#audio-compo").hide()}),$("[id^='stepDesc']").on("click",function(){localStorage.setItem("step",$(this).attr("id")),"block"==$("#step2").css("display")?($("#audio-compo").show(),wavesurfer.drawBuffer()):$("#audio-compo").hide()}),jQuery("#upload-wrapper").detach().insertAfter("#btn-add-crdo"),jQuery("#newdoc").detach().insertAfter("#btn-add-doc"),jQuery("#import-form").detach().insertAfter("#btn-import-doc"),user=$("#user").val(),localStorage.setItem("user",user),$("#uploaded-user").val(user),$("#import-user").val(user),$("#form-newdoc .field").each(function(){$(this).children("input").attr("placeholder",$(this).children("label").html()),$(this).addClass("ui small input")}),wavesurfer.on("loading",function(a){loaded[o_Currentdocument.resources.images.length]=1e4*a,$("progress").val(progressCompute(toload,loaded))}),wavesurfer.on("ready",function(){var a=$("#waveform").width(),b=Math.round(a/wavesurfer.getDuration()),c=Math.round(32e3/wavesurfer.getDuration());$("#slider").attr("min",b).attr("max",c),timeline.init({wavesurfer:wavesurfer,container:"#waveform-timeline"}),wavesurfer.enableDragSelection({color:"rgba(0,0,0,0.3)"}),wavesurfer.on("region-created",function(a){$('wave region[data-id!="'+$(a.element).attr("data-id")+'"]').remove()}),wavesurfer.on("region-updated",function(a){a.id;$("#startPosition").val(a.start),$("#endPosition").val(a.end),$("input.audio.start:enabled").val(a.start),$("input.audio.end:enabled").val(a.end)}),wavesurfer.on("region-dblclick",function(a){
a.remove()})}),wavesurfer.on("pause",function(){$(".play-selection i.stop").removeClass("stop").addClass("play"),$(".play-selection").removeClass("stop")}),wavesurfer.on("error",function(){$("#loading").removeClass("active"),$("#select-ressources .music").parent().parent().addClass("error"),notifier("Fichier audio introuvable.","error",$("#select-ressources .music").parent().parent().attr("id"))}),rules_newdoc={title:{identifier:"title_1",rules:[{type:"empty",prompt:"Veuillez saisir un titre"}]},titlelangue:{identifier:"title_1_langue",rules:[{type:"empty",prompt:"Veuillez saisir la langue du titre"}]},codelangue:{identifier:"codelangue_1",rules:[{type:"empty",prompt:"Veuillez saisir un code langue"},{type:"maxLength[3]",prompt:"Le code langue doit être sur 3 caractères"}]},codelanguerec:{identifier:"codelanguerec_1",rules:[{type:"empty",prompt:"Veuillez saisir un code langue"},{type:"maxLength[3]",prompt:"Le code langue doit être sur 3 caractères"}]},codepays:{identifier:"codepays",rules:[{type:"empty",prompt:"Veuillez saisir un code pays"},{type:"maxLength[2]",prompt:"Le code pays doit être sur 2 caractères"}]},lieu:{identifier:"spatial_1",rules:[{type:"empty",prompt:"Veuillez saisir un lieu"},{type:"length[2]",prompt:"Veuillez saisir au moins 2 caractères"}]},depositor:{identifier:"depositor_1",rules:[{type:"empty",prompt:"Veuillez saisir un dépositaire"},{type:"length[2]",prompt:"Veuillez saisir au moins 2 caractères"}]},researcher:{identifier:"researcher_1",rules:[{type:"empty",prompt:"Veuillez saisir un chercheur"},{type:"length[2]",prompt:"Veuillez saisir au moins 2 caractères"}]},sponsor:{identifier:"sponsor_1",rules:[{type:"empty",prompt:"Veuillez saisir un sponsor"}]},publisher:{identifier:"publisher_1",rules:[{type:"empty",prompt:"Veuillez saisir un éditeur"},{type:"length[2]",prompt:"Veuillez saisir au moins 2 caractères"}]}},$("#newdoc").form(rules_newdoc,{inline:!0,on:"blur"}),rules_newselection={transcription:{identifier:"transcription_1",rules:[{type:"empty",prompt:"Veuillez saisir une transcription"}]},transcriptionlangue:{identifier:"transcription_1_langue",rules:[{type:"empty",prompt:"Veuillez saisir la langue de la transcription"}]},traduction:{identifier:"traduction_1",rules:[{type:"empty",prompt:"Veuillez saisir une traduction"}]},traductionlangue:{identifier:"traduction_1_langue",rules:[{type:"empty",prompt:"Veuillez saisir la langue de la traduction"}]},startPosition:{identifier:"startPosition",rules:[{type:"empty",prompt:"Veuillez sélectionner une plage audio"}]},endPosition:{identifier:"endPosition",rules:[{type:"empty",prompt:"Veuillez sélectionner une plage audio"}]}},$("#newselection").form(rules_newselection,{inline:!0,on:"blur"}),refreshUserDoc(token),$(".btn-add-input-line").click(function(){var a=$(this).parent().parent().clone(!0,!0);$(this).parent().parent().after(a),a.find(".remove").show(),a.find("input").val("");var b=$(this).parent().parent().find("input:first").attr("id"),c=b.split("_"),d=parseInt(c[1])+1;a.find("input").each(function(){var a=$(this).attr("id"),b=a.split("_"),c=b[0]+"_"+d;$(this).attr("id",c),$(this).attr("name",c);var e=$(this).attr("actarget");if("undefined"!=typeof e&&e!==!1){var f=e.split("_"),g=f[0]+"_"+d;$(this).attr("actarget",g)}}),a.find(".ui.dropdown").each(function(){$(this).dropdown()})}),$(".remove, .btn-remove").click(function(){$(this).parent().parent().remove()}),$("input#codepays").on("change",function(){var a=document.getElementById("spatial_1"),b={componentRestrictions:{country:$(this).val()}},c=new google.maps.places.Autocomplete(a,b);google.maps.event.addListener(c,"place_changed",function(){var a=c.getPlace();$("input#spatial_lat").val(Math.round(100*a.geometry.location.lat())/100),$("input#spatial_long").val(Math.round(100*a.geometry.location.lng())/100)})}),$("#select_transcription").dropdown(),$(".ui.radio.checkbox").checkbox(),$("#creer-doc").click(function(){if($("#newdoc").form("validate form")){var a=new Array,b=new Array,c=new Array,d=new Array,e=new Array,f=new Array,g=new Array;$(".depositor").each(function(){a.push($(this).val())}),$(".researcher").each(function(){b.push($(this).val())}),$(".speaker").each(function(){c.push($(this).val())}),$(".recorder").each(function(){d.push($(this).val())}),$(".interviewer").each(function(){e.push($(this).val())}),$(".sponsor").each(function(){f.push($(this).val())}),$(".publisher").each(function(){g.push($(this).val())});var h={depositor:a,researcher:b,speaker:c,recorder:d,interviewer:e,sponsor:f},i=new Array;$(".doc-title").each(function(){var a=$(this).parent().parent().find(".doc-title-langue").val();i.push({title:$(this).val(),lang:a})});var j=new Array;$(".codelanguerec").each(function(){j.push($(this).val())});var k={place:$("#spatial_1").val(),geo:{east:$("#spatial_long").val(),north:$("#spatial_lat").val()},countrycode:$("#codepays").val(),lang:"en"},l=new Array;$(".codelangue").each(function(){l.push({codelangue:$(this).val(),subject:$(this).parent().next().find(".subject").val()})}),$.ajax({url:"createDocument",dataType:"json",data:{YII_CSRF_TOKEN:token,user:user,id:$("#identifier-doc").html(),title:i,languages:j,subject:l,spatial:k,contributors:h,publishers:g,format:$("#format").val(),type:$("#type").val(),conformsTo:"",identifier:$("#identifier-doc").html(),isFormatOf:$("#identifier-doc").html()+".xhtml",isPartOf:$("#ispartof").val(),collection:$("#collection").val(),accessRights:$("#accessrights").val(),license:$("#license").val(),rights:$("#rights").val()},type:"POST",success:function(a){$("#newdoc").hide(),currentLangue=$("#codelangue_1").val(),localStorage.setItem("document",currentDocument),localStorage.setItem("langue",currentLangue),location.reload(),notifier(messages("Création du document réussie."),"success")},error:function(a,b,c){console.log(b),console.log(c),notifier(messages("Erreur lors de la création du document (createDoc).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error"),refreshDocLang($("#codelangue").val())}})}else $("#newdoc").find(".field.error:first input").focus()}),$("#creer-selection").click(function(){if($("#newselection").form("validate form")){var a=new Array,b=new Array,c=new Array,d=new Array;if($.each(o_imgAreaSelect.getSelections(),function(){c.push({image:$(".images-tab a.item.active").attr("image"),area:this}),d.push({image:$(".images-tab a.item.active").attr("image"),h:this.height,w:this.width,x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2})}),$("#newselection .transcription").each(function(){var b=$(this).parent().parent().find(".transcription-langue").find(".item.active").attr("data-value");a.push({transcription:$(this).val(),lang:b})}),$("#newselection .traduction").each(function(){var a=$(this).parent().parent().find(".traduction-langue").val();b.push({traduction:$(this).val(),lang:a})}),""===$("#startPosition").val().trim())var e=0;else var e=parseFloat($("#startPosition").val());if(""===$("#endPosition").val().trim())var f=0;else var f=parseFloat($("#endPosition").val());var g=$("[name=motphrase]:checked").attr("id"),h={startPosition:e,endPosition:f,selectedAreas:d,transcriptions:a,traductions:b,motphrase:g},g="phrase"==h.motphrase?"S":"W",i=o_Currentdocument.id.replace("crdo-",""),j=0,k=0,l=0;$("#annotations-sentences > div > .title").each(function(){id=parseInt($(this).attr("id-selection").substr(i.length+2)),k=id>k?id:k}),$(".words > div > .title").each(function(){id=parseInt($(this).attr("id-selection").substr(i.length+2)),l=id>l?id:l}),o_Currentdocument.hasOwnProperty("annotations")?j="S"==g?k:l:(o_Currentdocument.annotations={},o_Currentdocument.annotations.sentences=[]),newId=generateNewId("S");var m=h.transcriptions[0].transcription.trim().split(" "),n=[];$.each(m,function(){l++,digit=l+1;var a=i+"_W"+digit;n.push({id:a,startPosition:h.startPosition,endPosition:h.endPosition,areas:h.selectedAreas,traductions:[{lang:"",traduction:""}],transcriptions:[{lang:h.transcriptions[0].lang,transcription:this}]})});var o={id:newId,startPosition:h.startPosition,endPosition:h.endPosition,areas:h.selectedAreas,traductions:h.traductions,transcriptions:h.transcriptions,children:n};$.ajax({url:"createAnnotation",dataType:"json",data:{YII_CSRF_TOKEN:token,user:user,iddoc:o_Currentdocument.id,annotation:o},type:"POST",success:function(a){notifier(messages("Création de l'annotation réussie."),"success"),o_Currentdocument.annotations.sentences.push(o),refreshAnnotations(),o_imgAreaSelect.cancelSelections(),$("wave region").remove(),checkMissingAnnotations()},error:function(a,b,c){notifier(messages("Erreur lors de la création de l'annotation (createAnnotation).")+" "+messages("Veuillez reporter cet incident à l'équipe informatique."),"error")}}),$("#audio-compo input:not(.traduction-langue):not(.transcription-langue)[type=text]").val("")}else $("#newdoc").find(".field.error:first input").focus()}),$("input#uploaded-file").change(function(){$("#selected-file").html($("#uploaded-file")[0].files[0].name),notifier(messages("Fichier importé avec succès.")+" ("+$("#uploaded-file")[0].files[0].name+")","success")}),$("input#annotation-file").change(function(){$("#selected-annotation-file").html($("#annotation-file")[0].files[0].name),notifier(messages("Fichier importé avec succès.")+" ("+$("#annotation-file")[0].files[0].name+")","success")}),$("#toggleSelections").checkbox({onEnable:function(){$('[id^="maskSelection"]').css("display","block"),$('[id^="maskSelection"]').bind("click",function(){var a=$(this).attr("id").replace("maskSelection_","");$("#annotations .title.active").click(),$('.title[id-selection^="'+a+'"]').click(),$('.content[id-selection^="'+a+'"] .play-selection').click()})},onDisable:function(){$('[id^="maskSelection"]').css("display","none")}})}),$("#btn-add-crdo").on("click",function(){$("#upload-wrapper").toggle()}),$("#btn-add-doc").on("click",function(){$("#newdoc").toggle()}),$("#btn-import-doc").on("click",function(){$("#import-form").toggle()}),$("form#upload").submit(function(){$("#upload-wrapper").hide(),$("#loading .loader").html(messages("Téléchargement en cours")),$("#loading").addClass("active"),$("#upload-target").unbind().load(function(){$("#upload-target").contents().find("#filename").html();$("#selected-file").html($("#upload-target body").html()),getJSON($("#select-document > tbody > tr.active").attr("id"),user)})}),$("form#import").submit(function(){$("#import-form").hide(),$("#loading .loader").html(messages("Téléchargement en cours")),$("#loading").addClass("active"),$("#import-target").unbind().load(function(){$("#import-target").contents().find("#filename").html();getJSON($("#select-document > tbody > tr.active").attr("id"),user)})}),$("#step2").show(function(){$("#audio-compo").show()}),$("#player-controls button[data-action=play]").click(function(){wavesurfer.playPause(),$(this).find("i").hasClass("play")?$(this).find("i").removeClass("play").addClass("pause"):$(this).find("i").removeClass("pause").addClass("play"),playerAction=$(this).attr("data-action")}),$("#player-controls button[data-action=playSelOnce]").click(function(){playerAction=$(this).attr("data-action");var a=wavesurfer.getSelection();a&&(wavesurfer.play(a.startPosition,a.endPosition),$("#player-controls button[data-action=play] i").removeClass("play").addClass("pause"))}),$("#player-controls button[data-action=rewind]").click(function(){playerAction=$(this).attr("data-action"),wavesurfer.stop(),wavesurfer.seekAndCenter(0),$("#player-controls button[data-action=play] i").removeClass("pause").addClass("play")}),$("#player-controls button[data-action=toggleScroll]").click(function(){wavesurfer.toggleScroll();var a=wavesurfer.getSelection(),b=a.startPercentage,c=a.endPercentage;wavesurfer.updateSelection({startPercentage:b,endPercentage:c}),wavesurfer.seekAndCenter(b),$(this).find("i").hasClass("in")?$(this).find("i").removeClass("in").addClass("out"):$(this).find("i").removeClass("out").addClass("in")}),$("#startPosition,#endPosition").change(function(){var a=parseFloat($("#startPosition").val()/wavesurfer.getDuration()),b=parseFloat($("#endPosition").val()/wavesurfer.getDuration());wavesurfer.updateSelection({startPercentage:a,endPercentage:b})}),$(function(){var a=window.jQuery;a.tablesort=function(b,c){var d=this;this.$table=b,this.$thead=this.$table.find("thead"),this.settings=a.extend({},a.tablesort.defaults,c),this.$table.find("th").bind("click.tablesort",function(){d.sort(a(this))}),this.index=null,this.$th=null,this.direction=null},a.tablesort.prototype={sort:function(b,c){var d=new Date,e=this,f=this.$table,g=this.$thead.length>0?f.find("tbody tr"):f.find("tr").has("td"),h=f.find("tr td:nth-of-type("+(b.index()+1)+")"),i=b.data().sortBy,j=[],k=h.map(function(c,d){return i?"function"==typeof i?i(a(b),a(d),e):i:null!=a(this).data().sortValue?a(this).data().sortValue:a(this).text()});if(0!==k.length){e.$table.find("th").removeClass(e.settings.asc+" "+e.settings.desc),"asc"!==c&&"desc"!==c?this.direction="asc"===this.direction?"desc":"asc":this.direction=c,c="asc"==this.direction?1:-1,e.$table.trigger("tablesort:start",[e]),e.log("Sorting by "+this.index+" "+this.direction);for(var l=0,m=k.length;l<m;l++)j.push({index:l,cell:h[l],row:g[l],value:k[l]});j.sort(function(a,b){return a.value>b.value?1*c:a.value<b.value?-1*c:0}),a.each(j,function(a,b){f.append(b.row)}),b.addClass(e.settings[e.direction]),e.log("Sort finished in "+((new Date).getTime()-d.getTime())+"ms"),e.$table.trigger("tablesort:complete",[e])}},log:function(b){(a.tablesort.DEBUG||this.settings.debug)&&console&&console.log&&console.log("[tablesort] "+b)},destroy:function(){return this.$table.find("th").unbind("click.tablesort"),this.$table.data("tablesort",null),null}},a.tablesort.DEBUG=!1,a.tablesort.defaults={debug:a.tablesort.DEBUG,asc:"sorted ascending",desc:"sorted descending"},a.fn.tablesort=function(b){var c,d;return this.each(function(){c=a(this),d=c.data("tablesort"),d&&d.destroy(),c.data("tablesort",new a.tablesort(c,b))})}}),jQuery.ajax=function(a){function b(a){return!e.test(a)&&/:\/\//.test(a)}var c=location.protocol,d=location.hostname,e=RegExp(c+"//"+d),f="http"+(/^https/.test(c)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?",g='select * from html where url="{URL}" and xpath="*"';return function(c){var d=c.url;return/get/i.test(c.type)&&!/json/i.test(c.dataType)&&b(d)&&(c.url=f,c.dataType="json",c.data={q:g.replace("{URL}",d+(c.data?(/\?/.test(d)?"&":"?")+jQuery.param(c.data):"")),format:"xml"},!c.success&&c.complete&&(c.success=c.complete,delete c.complete),c.success=function(a){return function(b){a&&a.call(this,{responseText:(b.results[0]||"").replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi,"")},"success")}}(c.success)),a.apply(this,arguments)}}(jQuery.ajax),jQuery.ajax=function(a){function b(a){return!e.test(a)&&/:\/\//.test(a)}var c=location.protocol,d=location.hostname,e=RegExp(c+"//"+d),f="http"+(/^https/.test(c)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?",g='select * from html where url="{URL}" and xpath="*"';return function(c){var d=c.url;return/get/i.test(c.type)&&!/json/i.test(c.dataType)&&b(d)&&(c.url=f,c.dataType="json",c.data={q:g.replace("{URL}",d+(c.data?(/\?/.test(d)?"&":"?")+jQuery.param(c.data):"")),format:"xml"},!c.success&&c.complete&&(c.success=c.complete,delete c.complete),c.success=function(a){return function(b){a&&a.call(this,{responseText:(b.results[0]||"").replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi,"")},"success")}}(c.success)),a.apply(this,arguments)}}(jQuery.ajax),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.4.4";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null!=a&&(s&&a.indexOf===s?a.indexOf(b)!=-1:A(a,function(a){return a===b}))},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?null:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;d.computed>g&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(b||x.identity);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;e>c.call(d,a[h])?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(i.apply(d,arguments))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=Array(b),d=0;b>d;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);d>e;)f[e++]=a,a+=c;return f},x.bind=function(a,b){if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));var c=h.call(arguments,2);return function(){return a.apply(b,c.concat(h.call(arguments)))}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);return 0===b.length&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},x.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return 0>=a?b():function(){return 1>--a?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var E=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==b+"";case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=E(a[g],b[g],c,d)););}else{var i=a.constructor,k=b.constructor;if(i!==k&&!(x.isFunction(i)&&i instanceof i&&x.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(x.has(a,l)&&(g++,!(h=x.has(b,l)&&E(a[l],b[l],c,d))))break;if(h){for(l in b)if(x.has(b,l)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return E(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=x.invert(F.escape);var G={escape:RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(G[a],function(b){return F[a][b]})}}),x.result=function(a,b){if(null==a)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),L.call(this,c.apply(x,a))}})};var H=0;x.uniqueId=function(a){var b=++H+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=RegExp([(c.escape||I).source,(c.interpolate||I).source,(c.evaluate||I).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(K,function(a){return"\\"+J[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=Function(c.variable||"obj","_",g)}catch(a){throw a.source=g,a}if(b)return d(b,x);var h=function(a){return d.call(this,a,x)};return h.source="function("+(c.variable||"obj")+"){\n"+g+"}",h},x.chain=function(a){return x(a).chain()};var L=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],L.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return L.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this);var WaveSurfer={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",selectionColor:"#0fc",selectionBorder:!1,selectionForeground:!1,selectionBorderColor:"#000",cursorWidth:1,markerWidth:2,skipLength:2,minPxPerSec:50,pixelRatio:window.devicePixelRatio,fillParent:!0,scrollParent:!1,hideScrollbar:!1,normalize:!1,audioContext:null,container:null,dragSelection:!0,loopSelection:!0,audioRate:1,interact:!0,renderer:"Canvas",backend:"WebAudioBuffer"},init:function(a){if(this.params=WaveSurfer.util.extend({},this.defaultParams,a),this.container="string"==typeof a.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("wavesurfer.js: container element not found");this.markers={},this.once("marked",this.bindMarks.bind(this)),this.once("region-created",this.bindRegions.bind(this)),this.regions={},this.savedVolume=0,this.isMuted=!1,this.bindUserAction(),this.createDrawer(),this.createBackend()},bindUserAction:function(){var a=this,b=function(){a.fireEvent("user-action")};document.addEventListener("mousedown",b),document.addEventListener("keydown",b),this.on("destroy",function(){document.removeEventListener("mousedown",b),document.removeEventListener("keydown",b)})},createMedia:function(a){var b=this,c=document.createElement("audio");c.controls=!1,c.autoplay=!1,c.src=a,c.addEventListener("error",function(){b.fireEvent("error","Error loading media element")}),c.addEventListener("canplay",function(){b.fireEvent("media-canplay")});var d=this.container.querySelector("audio");return d&&this.container.removeChild(d),this.container.appendChild(c),c},createDrawer:function(){var a=this;this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){a.drawBuffer(),a.drawer.progress(a.backend.getPlayedPercents())}),this.on("progress",function(b){a.drawer.progress(b)}),this.drawer.on("mousedown",function(b){setTimeout(function(){a.seekTo(b)},0)}),this.drawer.on("mark-dblclick",function(b){var c=a.markers[b];c&&c.remove()}),this.params.dragSelection&&(this.drawer.on("drag",function(b){a.dragging=!0,a.updateSelection(b)}),this.drawer.on("drag-clear",function(){a.clearSelection()})),this.drawer.on("drag-mark",function(a,b){b.fireEvent("drag",a)}),this.drawer.on("mouseup",function(b){a.fireEvent("mouseup",b),a.dragging=!1}),this.drawer.on("region-over",function(b,c){b.fireEvent("over",c),a.fireEvent("region-over",b,c)}),this.drawer.on("region-leave",function(b,c){b.fireEvent("leave",c),a.fireEvent("region-leave",b,c)}),this.drawer.on("region-click",function(b,c){b.fireEvent("click",c),a.fireEvent("region-click",b,c)}),this.drawer.on("mark-over",function(b,c){b.fireEvent("over",c),a.fireEvent("mark-over",b,c)}),this.drawer.on("mark-leave",function(b,c){b.fireEvent("leave",c),a.fireEvent("mark-leave",b,c)}),this.drawer.on("mark-click",function(b,c){b.fireEvent("click",c),a.fireEvent("mark-click",b,c)}),this.drawer.on("scroll",function(b){a.fireEvent("scroll",b)});
},createBackend:function(){var a=this;this.backend&&this.backend.destroy(),this.backend=Object.create(WaveSurfer[this.params.backend]),this.backend.on("play",function(){a.fireEvent("play"),a.restartAnimationLoop()}),this.backend.on("finish",function(){a.fireEvent("finish")});try{this.backend.init(this.params)}catch(a){"wavesurfer.js: your browser doesn't support WebAudio"==a.message&&(this.params.backend="AudioElement",this.backend=null,this.createBackend())}},restartAnimationLoop:function(){var a=this,b=window.requestAnimationFrame||window.webkitRequestAnimationFrame,c=function(){a.backend.isPaused()||(a.fireEvent("progress",a.backend.getPlayedPercents()),b(c))};c()},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(a,b){this.backend.play(a,b)},pause:function(){this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},playPauseSelection:function(){var a=this.getSelection();null!==a&&(this.seekTo(a.startPercentage),this.playPause())},skipBackward:function(a){this.skip(a||-this.params.skipLength)},skipForward:function(a){this.skip(a||this.params.skipLength)},skip:function(a){var b=this.timings(a),c=b[0]/b[1];this.seekTo(c)},seekAndCenter:function(a){this.seekTo(a),this.drawer.recenter(a)},seekTo:function(a){var b=this.backend.isPaused(),c=this.params.scrollParent;b&&(this.params.scrollParent=!1,this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0)),this.play(a*this.drawer.width/this.realPxPerSec),b&&(this.pause(),this.backend.setVolume(this.savedVolume)),this.params.scrollParent=c,this.fireEvent("seek",a)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(a){this.backend.setVolume(a)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},mark:function(a){var b=this,c=WaveSurfer.util.extend({id:WaveSurfer.util.getId(),width:this.params.markerWidth},a);if(c.percentage&&!c.position&&(c.position=c.percentage*this.getDuration()),c.percentage=c.position/this.getDuration(),c.id in this.markers)return this.markers[c.id].update(c);c.position||(c.position=this.getCurrentTime(),c.percentage=c.position/this.getDuration());var d=Object.create(WaveSurfer.Mark);return d.init(c),this.dragging?(d.type="selMark",d.on("drag",function(a){b.updateSelectionByMark(a,d)})):d.on("drag",function(a){b.moveMark(a,d)}),d.on("update",function(){b.drawer.updateMark(d),b.fireEvent("mark-updated",d)}),d.on("remove",function(){b.drawer.removeMark(d),delete b.markers[d.id],b.fireEvent("mark-removed",d)}),this.drawer.addMark(d),this.markers[d.id]=d,this.fireEvent("marked",d),d},clearMarks:function(){Object.keys(this.markers).forEach(function(a){this.markers[a].remove()},this),this.markers={}},redrawRegions:function(){Object.keys(this.regions).forEach(function(a){this.region(this.regions[a])},this)},clearRegions:function(){Object.keys(this.regions).forEach(function(a){this.regions[a].remove()},this),this.regions={}},region:function(a){var b=this,c=WaveSurfer.util.extend({id:WaveSurfer.util.getId()},a);if(c.startPercentage=c.startPosition/this.getDuration(),c.endPercentage=c.endPosition/this.getDuration(),c.id in this.regions)return this.regions[c.id].update(c);var d=Object.create(WaveSurfer.Region);return d.init(c),d.on("update",function(){b.drawer.updateRegion(d),b.fireEvent("region-updated",d)}),d.on("remove",function(){b.drawer.removeRegion(d),b.fireEvent("region-removed",d),delete b.regions[d.id]}),this.drawer.addRegion(d),this.regions[d.id]=d,this.fireEvent("region-created",d),d},timings:function(a){var b=this.getCurrentTime()||0,c=this.getDuration()||1;return b=Math.max(0,Math.min(c,b+(a||0))),[b,c]},drawBuffer:function(){if(this.params.fillParent&&!this.params.scrollParent)var a=this.drawer.getWidth();else a=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio);this.realPxPerSec=a/this.getDuration(),this.drawer.drawPeaks(this.backend.getPeaks(a),a),this.fireEvent("redraw")},drawAsItPlays:function(){var a=this;this.realPxPerSec=this.params.minPxPerSec*this.params.pixelRatio;var b,c=1/this.realPxPerSec,d=0;this.drawFrame=function(e){if(!(e>d&&c>e-d)){d=e;var f=a.getDuration();if(1/0>f){var g=Math.round(f*a.realPxPerSec);b=b||new Uint8Array(g)}else b=b||[],g=b.length;var h=~~(a.backend.getPlayedPercents()*g);b[h]||(b[h]=WaveSurfer.util.max(a.backend.waveform(),128),a.drawer.setWidth(g),a.drawer.clearWave(),a.drawer.drawWave(b,128))}},this.backend.on("audioprocess",this.drawFrame)},loadArrayBuffer:function(a){var b=this;this.backend.decodeArrayBuffer(a,function(a){b.loadDecodedBuffer(a)},function(){b.fireEvent("error","Error decoding audiobuffer")})},loadDecodedBuffer:function(a){this.empty(),"WebAudioBuffer"!=this.params.backend&&(this.params.backend="WebAudioBuffer",this.createBackend()),this.backend.load(a),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(a){var b=this,c=new FileReader;c.addEventListener("progress",function(a){b.onProgress(a)}),c.addEventListener("load",function(a){b.empty(),b.loadArrayBuffer(a.target.result)}),c.addEventListener("error",function(){b.fireEvent("error","Error reading file")}),c.readAsArrayBuffer(a)},load:function(a,b){switch(this.params.backend){case"WebAudioBuffer":return this.loadBuffer(a);case"WebAudioMedia":return this.loadStream(a);case"AudioElement":return this.loadAudioElement(a,b)}},loadBuffer:function(a){return this.empty(),this.downloadArrayBuffer(a,this.loadArrayBuffer.bind(this))},loadStream:function(a){var b=this;"WebAudioMedia"!=this.params.backend&&(this.params.backend="WebAudioMedia",this.createBackend()),this.empty(),this.drawAsItPlays(),this.media=this.createMedia(a),this.once("user-action",function(){b.backend.load(b.media)}),setTimeout(this.fireEvent.bind(this,"ready"),0)},loadAudioElement:function(a,b){var c=this;"AudioElement"!=this.params.backend&&(this.params.backend="AudioElement",this.createBackend()),this.empty(),this.media=this.createMedia(a),this.once("media-canplay",function(){c.backend.load(c.media,b),c.drawBuffer(),c.fireEvent("ready")})},downloadArrayBuffer:function(a,b){var c=this,d=WaveSurfer.util.ajax({url:a,responseType:"arraybuffer"});return d.on("progress",function(a){c.onProgress(a)}),d.on("success",b),d.on("error",function(a){c.fireEvent("error","XHR error: "+a.target.statusText)}),d},onProgress:function(a){if(a.lengthComputable)var b=a.loaded/a.total;else b=a.loaded/(a.loaded+1e6);this.fireEvent("loading",Math.round(100*b),a.target)},bindMarks:function(){var a=this,b=0;this.backend.on("play",function(){Object.keys(a.markers).forEach(function(b){a.markers[b].played=!1})}),this.backend.on("audioprocess",function(c){Object.keys(a.markers).forEach(function(d){var e=a.markers[d];e.played||e.position<=c&&e.position>=b&&(e.played=!0,a.fireEvent("mark",e),e.fireEvent("reached"))}),b=c})},bindRegions:function(){var a=this;this.backend.on("play",function(){Object.keys(a.regions).forEach(function(b){a.regions[b].firedIn=!1,a.regions[b].firedOut=!1})}),this.backend.on("audioprocess",function(b){Object.keys(a.regions).forEach(function(c){var d=a.regions[c];!d.firedIn&&d.startPosition<=b&&d.endPosition>=b&&(a.fireEvent("region-in",d),d.fireEvent("in"),d.firedIn=!0),!d.firedOut&&d.firedIn&&d.endPosition<b&&(a.fireEvent("region-out",d),d.fireEvent("out"),d.firedOut=!0)})})},empty:function(){this.drawFrame&&(this.un("progress",this.drawFrame),this.drawFrame=null),this.backend&&!this.backend.isPaused()&&(this.stop(),this.backend.disconnectSource()),this.clearMarks(),this.clearRegions(),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.clearMarks(),this.clearRegions(),this.unAll(),this.backend.destroy(),this.drawer.destroy(),this.media&&this.container.removeChild(this.media)},updateSelectionByMark:function(a,b){var c;c=b.id==this.selMark0.id?{startPercentage:a.endPercentage,endPercentage:this.selMark1.percentage}:{startPercentage:this.selMark0.percentage,endPercentage:a.endPercentage},this.updateSelection(c)},updateSelection:function(a){var b=this,c=a.startPercentage,d=a.endPercentage,e=this.params.selectionColor,f=0;if(this.params.selectionBorder&&(e=this.params.selectionBorderColor,f=2),c>d){var g=c;c=d,d=g}this.selMark0?this.selMark0.update({percentage:c,position:c*this.getDuration()}):this.selMark0=this.mark({width:f,percentage:c,position:c*this.getDuration(),color:e,draggable:b.params.selectionBorder}),this.selMark1?this.selMark1.update({percentage:d,position:d*this.getDuration()}):this.selMark1=this.mark({width:f,percentage:d,position:d*this.getDuration(),color:e,draggable:b.params.selectionBorder}),this.drawer.updateSelection(c,d),this.params.loopSelection&&this.backend.updateSelection(c,d),b.fireEvent("selection-update",this.getSelection())},moveMark:function(a,b){b.update({percentage:a.endPercentage,position:a.endPercentage*this.getDuration()}),this.markers[b.id]=b},clearSelection:function(){this.selMark0&&this.selMark1&&(this.drawer.clearSelection(this.selMark0,this.selMark1),this.selMark0.remove(),this.selMark0=null,this.selMark1.remove(),this.selMark1=null,this.params.loopSelection&&this.backend.clearSelection(),this.fireEvent("selection-update",this.getSelection()))},toggleLoopSelection:function(){this.params.loopSelection=!this.params.loopSelection,this.params.loopSelection?this.selMark0&&this.selMark1&&this.updateSelection({startPercentage:this.selMark0.percentage,endPercentage:this.selMark1.percentage}):this.backend.clearSelection()},getSelection:function(){return this.selMark0&&this.selMark1?{startPercentage:this.selMark0.percentage,startPosition:this.selMark0.position,endPercentage:this.selMark1.percentage,endPosition:this.selMark1.position,startTime:this.selMark0.getTitle(),endTime:this.selMark1.getTitle()}:null},enableInteraction:function(){this.params.interact=!0},disableInteraction:function(){this.params.interact=!1},toggleInteraction:function(){this.params.interact=!this.params.interact},enableDragSelection:function(){this.params.dragSelection=!0},disableDragSelection:function(){this.params.dragSelection=!1},toggleDragSelection:function(){this.params.dragSelection=!this.params.dragSelection}};WaveSurfer.Mark={defaultParams:{id:null,position:0,percentage:0,width:1,color:"#333",draggable:!1},init:function(a){return this.apply(WaveSurfer.util.extend({},this.defaultParams,a)),this},getTitle:function(){return[~~(this.position/60),("00"+~~(this.position%60)).slice(-2)].join(":")},apply:function(a){Object.keys(a).forEach(function(b){b in this.defaultParams&&(this[b]=a[b])},this)},update:function(a){this.apply(a),this.fireEvent("update")},remove:function(){this.fireEvent("remove"),this.unAll()}},WaveSurfer.Region={defaultParams:{id:null,startPosition:0,endPosition:0,startPercentage:0,endPercentage:0,color:"rgba(0, 0, 255, 0.2)"},init:function(a){return this.apply(WaveSurfer.util.extend({},this.defaultParams,a)),this},apply:function(a){Object.keys(a).forEach(function(b){b in this.defaultParams&&(this[b]=a[b])},this)},update:function(a){this.apply(a),this.fireEvent("update")},remove:function(){this.fireEvent("remove"),this.unAll()}},WaveSurfer.Observer={on:function(a,b){this.handlers||(this.handlers={});var c=this.handlers[a];c||(c=this.handlers[a]=[]),c.push(b)},un:function(a,b){if(this.handlers){var c=this.handlers[a];if(c)if(b)for(var d=c.length-1;d>=0;d--)c[d]==b&&c.splice(d,1);else c.length=0}},unAll:function(){this.handlers=null},once:function(a,b){var c=this,d=function(){b(),setTimeout(function(){c.un(a,d)},0)};this.on(a,d)},fireEvent:function(a){if(this.handlers){var b=this.handlers[a],c=Array.prototype.slice.call(arguments,1);b&&b.forEach(function(a){a.apply(null,c)})}}},WaveSurfer.util={extend:function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){Object.keys(b).forEach(function(c){a[c]=b[c]})}),a},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},max:function(a,b){for(var c=-1/0,d=0,e=a.length;e>d;d++){var f=a[d];null!=b&&(f=Math.abs(f-b)),f>c&&(c=f)}return c},ajax:function(a){var b=Object.create(WaveSurfer.Observer),c=new XMLHttpRequest,d=!1;return c.open(a.method||"GET",a.url,!0),c.responseType=a.responseType,c.addEventListener("progress",function(a){b.fireEvent("progress",a),a.lengthComputable&&a.loaded==a.total&&(d=!0)}),c.addEventListener("load",function(a){d||b.fireEvent("progress",a),b.fireEvent("load",a),200==c.status||206==c.status?b.fireEvent("success",c.response,a):b.fireEvent("error",a)}),c.addEventListener("error",function(a){b.fireEvent("error",a)}),c.send(),b.xhr=c,b},throttle:function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:Date.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=Date.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}}},WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer),WaveSurfer.util.extend(WaveSurfer.Mark,WaveSurfer.Observer),WaveSurfer.util.extend(WaveSurfer.Region,WaveSurfer.Observer),WaveSurfer.WebAudio={scriptBufferSize:256,fftSize:128,getAudioContext:function(){if(!window.AudioContext&&!window.webkitAudioContext)throw new Error("wavesurfer.js: your browser doesn't support WebAudio");return WaveSurfer.WebAudio.audioContext||(WaveSurfer.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),WaveSurfer.WebAudio.audioContext},init:function(a){this.params=a,this.ac=a.audioContext||this.getAudioContext(),this.loop=!1,this.prevFrameTime=0,this.scheduledPause=null,this.firedFinish=!1,this.postInit(),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setPlaybackRate(this.params.audioRate)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(a){a&&a.disconnect()}),this.filters=null)},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(a){this.disconnectFilters(),a&&a.length?(this.filters=a,a.reduce(function(a,b){return a.connect(b),b},this.analyser).connect(this.gainNode)):this.analyser.connect(this.gainNode)},createScriptNode:function(){var a=this,b=this.scriptBufferSize;this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(b):this.ac.createJavaScriptNode(b),this.scriptNode.connect(this.ac.destination),this.scriptNode.onaudioprocess=function(){var b=a.getCurrentTime();!a.firedFinish&&a.buffer&&b>=a.getDuration()&&(a.firedFinish=!0,a.fireEvent("finish")),a.isPaused()||(a.onPlayFrame(b),a.fireEvent("audioprocess",b))}},onPlayFrame:function(a){null!=this.scheduledPause&&this.prevFrameTime>=this.scheduledPause&&this.pause(),this.loop&&this.prevFrameTime>this.loopStart&&this.prevFrameTime<=this.loopEnd&&a>this.loopEnd&&this.play(this.loopStart),this.prevFrameTime=a},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.fftSize=this.fftSize,this.analyserData=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(a){this.gainNode.gain.value=a},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(a,b,c){var d=this;this.ac.decodeAudioData(a,function(a){d.buffer=a,b(a)},c)},getPeaks:function(a){for(var b=this.buffer,c=b.length/a,d=~~(c/10)||1,e=b.numberOfChannels,f=new Float32Array(a),g=0;e>g;g++)for(var h=b.getChannelData(g),i=0;a>i;i++){for(var j=~~(i*c),k=~~(j+c),l=0,m=j;k>m;m+=d){var n=h[m];n>l?l=n:-n>l&&(l=-n)}(0==g||l>f[i])&&(f[i]=l)}return f},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},disconnectSource:function(){this.firedFinish=!1,this.source&&this.source.disconnect()},destroy:function(){this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect()},updateSelection:function(a,b){var c=this.getDuration();this.loop=!0,this.loopStart=c*a,this.loopEnd=c*b},clearSelection:function(){this.loop=!1,this.loopStart=0,this.loopEnd=0},waveform:function(){return this.analyser.getByteTimeDomainData(this.analyserData),this.analyserData},postInit:function(){},load:function(){},getCurrentTime:function(){return 0},isPaused:function(){return!0},getDuration:function(){return 0},setPlaybackRate:function(a){this.playbackRate=a||1},play:function(){},pause:function(){}},WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer),WaveSurfer.WebAudioBuffer=Object.create(WaveSurfer.WebAudio),WaveSurfer.util.extend(WaveSurfer.WebAudioBuffer,{postInit:function(){this.lastStartPosition=0,this.lastPlay=this.lastPause=this.nextPause=this.ac.currentTime},load:function(a){this.lastStartPosition=0,this.lastPlay=this.lastPause=this.nextPause=this.ac.currentTime,this.buffer=a,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.nextPause<=this.ac.currentTime},getDuration:function(){return this.buffer.duration},play:function(a,b){this.createSource(),null==a&&(a=this.getCurrentTime()),null==b&&(b=null!=this.scheduledPause?this.scheduledPause:this.getDuration()),this.lastPlay=this.ac.currentTime,this.lastStartPosition=a,this.lastPause=this.nextPause=this.ac.currentTime+(b-a),this.prevFrameTime=-1,this.source.start?this.source.start(0,a,b-a):this.source.noteGrainOn(0,a,b-a),this.fireEvent("play")},pause:function(){this.scheduledPause=null,this.lastPause=this.nextPause=this.ac.currentTime,this.source&&(this.source.stop?this.source.stop(0):this.source.noteOff(0)),this.fireEvent("pause")},getCurrentTime:function(){return this.isPaused()?this.lastStartPosition+(this.lastPause-this.lastPlay)*this.playbackRate:this.lastStartPosition+(this.ac.currentTime-this.lastPlay)*this.playbackRate},setPlaybackRate:function(a){this.playbackRate=a||1,this.source&&(this.source.playbackRate.value=this.playbackRate)}}),WaveSurfer.WebAudioMedia=Object.create(WaveSurfer.WebAudio),WaveSurfer.util.extend(WaveSurfer.WebAudioMedia,{postInit:function(){var a=this;this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.maxCurrentTime=0,this.on("audioprocess",function(b){b>a.maxCurrentTime&&(a.maxCurrentTime=b)})},load:function(a){this.disconnectSource(),this.media=a,this.maxCurrentTime=0,this.source=this.ac.createMediaElementSource(this.media),this.media.playbackRate=this.playbackRate,this.source.connect(this.analyser)},isPaused:function(){return this.media.paused},getDuration:function(){return this.media.duration},getCurrentTime:function(){return this.media.currentTime},getPlayedPercents:function(){var a=this.getDuration(),b=this.getCurrentTime();return a>=1/0&&(a=this.maxCurrentTime),b/a||0},setPlaybackRate:function(a){this.playbackRate=a||1,this.media.playbackRate=this.playbackRate},play:function(a,b){null!=a&&(this.media.currentTime=a),this.scheduledPause=null==b?null:b,this.media.play(),this.fireEvent("play")},pause:function(){this.scheduledPause=null,this.media.pause(),this.fireEvent("pause")}}),WaveSurfer.AudioElement=Object.create(WaveSurfer.WebAudioMedia),WaveSurfer.util.extend(WaveSurfer.AudioElement,{init:function(a){this.params=a,this.loop=!1,this.prevFrameTime=0,this.scheduledPause=null,this.postInit(),this.setPlaybackRate(this.params.audioRate)},load:function(a,b){this.media=a,this.peaks=b,this.maxCurrentTime=0,this.setPlaybackRate(this.playbackRate)},getPeaks:function(){return this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(a){this.media.volume=a},destroy:function(){this.pause(),this.unAll(),this.media=null}}),WaveSurfer.Drawer={init:function(a,b){this.container=a,this.params=b,this.width=0,this.height=b.height*this.params.pixelRatio,this.lastPos=0,this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(a){a.preventDefault();var b=this.wrapper.getBoundingClientRect();return(a.clientX-b.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0},setupWrapperEvents:function(){var a=this,b={};this.wrapper.addEventListener("mousedown",function(c){var d=a.wrapper.offsetHeight-a.wrapper.clientHeight;if(0!=d){var e=a.wrapper.getBoundingClientRect();if(c.clientY>=e.bottom-d)return}a.params.interact&&a.fireEvent("mousedown",a.handleEvent(c),c),b.startPercentage=a.handleEvent(c)}),this.wrapper.addEventListener("mouseup",function(b){a.params.interact&&a.fireEvent("mouseup",b)}),this.wrapper.addEventListener("dblclick",function(b){(a.params.interact||a.params.dragSelection)&&("handler"!=b.target.tagName.toLowerCase()||b.target.classList.contains("selection-wavesurfer-handler")?a.fireEvent("drag-clear"):a.fireEvent("mark-dblclick",b.target.parentNode.id))});var c=function(){b.startPercentage=b.endPercentage=null};document.addEventListener("mouseup",c),this.on("destroy",function(){document.removeEventListener("mouseup",c)}),this.wrapper.addEventListener("mousemove",WaveSurfer.util.throttle(function(c){c.stopPropagation(),null!=b.startPercentage&&(b.endPercentage=a.handleEvent(c),a.params.interact&&a.params.dragSelection&&a.fireEvent("drag",b))},30))},drawPeaks:function(a,b){if(this.resetScroll(),this.setWidth(b),this.params.normalize)var c=WaveSurfer.util.max(a);else c=1;this.drawWave(a,c)},style:function(a,b){return Object.keys(b).forEach(function(c){a.style[c]!=b[c]&&(a.style[c]=b[c])}),a},resetScroll:function(){this.wrapper.scrollLeft=0},recenter:function(a){var b=this.wrapper.scrollWidth*a;this.recenterOnPosition(b,!0)},recenterOnPosition:function(a,b){var c=this.wrapper.scrollLeft,d=~~(this.containerWidth/2),e=a-d,f=e-c,g=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=g){if(!b&&f>=-d&&d>f){var h=5;f=Math.max(-h,Math.min(h,f)),e=c+f}e=Math.max(0,Math.min(g,e)),e!=c&&(this.wrapper.scrollLeft=e)}},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(a){a!=this.width&&(this.width=a,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateWidth())},progress:function(a){var b=1/this.params.pixelRatio,c=Math.round(a*this.width)*b;if(c<this.lastPos||c-this.lastPos>=b){if(this.lastPos=c,this.params.scrollParent){var d=~~(this.wrapper.scrollWidth*a);this.recenterOnPosition(d)}this.updateProgress(a)}},destroy:function(){this.unAll(),this.container.removeChild(this.wrapper),this.wrapper=null},updateSelection:function(a,b){this.startPercent=a,this.endPercent=b,this.drawSelection()},clearSelection:function(a,b){this.startPercent=null,this.endPercent=null,this.eraseSelection(),this.eraseSelectionMarks(a,b)},createElements:function(){},updateWidth:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){},addMark:function(){},removeMark:function(){},updateMark:function(){},addRegion:function(){},removeRegion:function(){},updateRegion:function(){},drawSelection:function(){},eraseSelection:function(){},eraseSelectionMarks:function(){}},WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer),WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer),WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){var a=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1}));this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,overflow:"hidden",width:"0",height:this.params.height+"px",borderRight:[this.params.cursorWidth+"px","solid",this.params.cursorColor].join(" ")}));var b=this.progressWave.appendChild(document.createElement("canvas")),c=0;this.params.selectionForeground&&(c=3);var d=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:c}));this.waveCc=a.getContext("2d"),this.progressCc=b.getContext("2d"),this.selectionCc=d.getContext("2d")},updateWidth:function(){var a=Math.round(this.width/this.params.pixelRatio);[this.waveCc,this.progressCc,this.selectionCc].forEach(function(b){b.canvas.width=this.width,b.canvas.height=this.height,this.style(b.canvas,{width:a+"px"})},this),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc.clearRect(0,0,this.width,this.height)},drawWave:function(a,b){var c=.5/this.params.pixelRatio;this.waveCc.fillStyle=this.params.waveColor,this.progressCc.fillStyle=this.params.progressColor;var d=this.height/2,e=d/b,f=1;this.params.fillParent&&this.width>a.length&&(f=this.width/a.length);var g=a.length;this.waveCc.beginPath(),this.waveCc.moveTo(c,d),this.progressCc.beginPath(),this.progressCc.moveTo(c,d);for(var h=0;g>h;h++){var i=Math.round(a[h]*e);this.waveCc.lineTo(h*f+c,d+i),this.progressCc.lineTo(h*f+c,d+i)}this.waveCc.lineTo(this.width+c,d),this.progressCc.lineTo(this.width+c,d),this.waveCc.moveTo(c,d),this.progressCc.moveTo(c,d);for(var h=0;g>h;h++){var i=Math.round(a[h]*e);this.waveCc.lineTo(h*f+c,d-i),this.progressCc.lineTo(h*f+c,d-i)}this.waveCc.lineTo(this.width+c,d),this.waveCc.fill(),this.progressCc.lineTo(this.width+c,d),this.progressCc.fill(),this.waveCc.fillRect(0,d-c,this.width,c)},updateProgress:function(a){var b=Math.round(this.width*a)/this.params.pixelRatio;this.style(this.progressWave,{width:b+"px"})},addMark:function(a){var b=this,c=document.createElement("mark");c.id=a.id,a.type&&"selMark"===a.type&&(c.className="selection-mark"),this.wrapper.appendChild(c);var d;a.draggable&&(d=document.createElement("handler"),d.id=a.id+"-handler",d.className="selMark"===a.type?"selection-wavesurfer-handler":"wavesurfer-handler",c.appendChild(d)),c.addEventListener("mouseover",function(c){b.fireEvent("mark-over",a,c)}),c.addEventListener("mouseleave",function(c){b.fireEvent("mark-leave",a,c)}),c.addEventListener("click",function(c){b.fireEvent("mark-click",a,c)}),a.draggable&&function(){var c={},e=function(a){a.stopPropagation(),c.startPercentage=c.endPercentage=null};document.addEventListener("mouseup",e),b.on("destroy",function(){document.removeEventListener("mouseup",e)}),d.addEventListener("mousedown",function(a){a.stopPropagation(),c.startPercentage=b.handleEvent(a)}),b.wrapper.addEventListener("mousemove",WaveSurfer.util.throttle(function(d){d.stopPropagation(),null!=c.startPercentage&&(c.endPercentage=b.handleEvent(d),b.fireEvent("drag-mark",c,a))},30))}(),this.updateMark(a),a.draggable&&(this.style(d,{position:"absolute",cursor:"col-resize",width:"12px",height:"15px"}),this.style(d,{left:d.offsetWidth/2*-1+"px",top:c.offsetHeight/2-d.offsetHeight/2+"px",backgroundColor:a.color}))},updateMark:function(a){var b=document.getElementById(a.id);b.title=a.getTitle(),this.style(b,{height:"100%",position:"absolute",zIndex:4,width:a.width+"px",left:Math.max(0,Math.round(a.percentage*this.wrapper.scrollWidth-a.width/2))+"px",backgroundColor:a.color})},removeMark:function(a){var b=document.getElementById(a.id);b&&this.wrapper.removeChild(b)},addRegion:function(a){var b=this,c=document.createElement("region");c.id=a.id,this.wrapper.appendChild(c),c.addEventListener("mouseover",function(c){b.fireEvent("region-over",a,c)}),c.addEventListener("mouseleave",function(c){b.fireEvent("region-leave",a,c)}),c.addEventListener("click",function(c){b.fireEvent("region-click",a,c)}),this.updateRegion(a)},updateRegion:function(a){var b=document.getElementById(a.id),c=Math.max(0,Math.round(a.startPercentage*this.wrapper.scrollWidth)),d=Math.max(0,Math.round(a.endPercentage*this.wrapper.scrollWidth))-c;this.style(b,{height:"100%",position:"absolute",zIndex:4,left:c+"px",top:"0px",width:d+"px",backgroundColor:a.color})},removeRegion:function(a){var b=document.getElementById(a.id);b&&this.wrapper.removeChild(b)},drawSelection:function(){this.eraseSelection(),this.selectionCc.fillStyle=this.params.selectionColor;var a=this.startPercent*this.width,b=this.endPercent*this.width-a;this.selectionCc.fillRect(a,0,b,this.height)},eraseSelection:function(){this.selectionCc.clearRect(0,0,this.width,this.height)},eraseSelectionMarks:function(a,b){this.removeMark(a),this.removeMark(b)}});